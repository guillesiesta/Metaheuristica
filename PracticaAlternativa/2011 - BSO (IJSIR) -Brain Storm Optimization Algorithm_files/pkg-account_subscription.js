define("modules/clean/account_page/tabs/billing",["require","exports","tslib","modules/clean/event_handler","modules/core/browser","modules/clean/payments/billing_info_modal","modules/clean/dbmodal_stack","modules/clean/deprecated/dbmodal_loading","external/react","external/react-redux","modules/clean/react/css","modules/core/i18n","modules/clean/web_timing_logger","modules/clean/account_page/util","modules/clean/teams/admin/lib/billing_history","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/billing/action_creators","modules/clean/account_page/widgets/plan/action_creators","modules/clean/account_page/widgets/plan/add_ons/action_creators","modules/clean/teams/admin/widgets/billing_history/billing_history_table","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/account_page/widgets/plan/views/change_schedule_modal","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader","modules/constants/account_page","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/account_page/components/key_value_block","modules/clean/account_page/widgets/billing/views/license_keys","modules/clean/account_page/components/loading","modules/clean/payments/skus/constants","modules/constants/account_page","modules/constants/trademark","modules/clean/analytics","modules/clean/payments/validation","modules/clean/payments/skus/subscription_status"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N,I,x,L,k,A,D,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var B=function(e){return{billingInfo:e.billingInfo.billingInfo,loadingState:e.billingInfo.loadingState,dataLoadedForTTI:"ready"===e.billingInfo.loadingState}},O=function(e){return{loadBillingInfo:function(t){return void 0===t&&(t=!1),e(g.loadDataIfNecessary(t))},loadPlanDataIfNecessary:function(t){return void 0===t&&(t=!1),e(f.loadDataIfNecessary(t))},loadEvhInfoIfNecessary:function(t){return void 0===t&&(t=!1),e(b.loadEvhInfoIfNecessary(t))}}},R=(function(e){function t(t){var a=e.call(this,t)||this;return a.handlePaymentUpdate=function(){A.ProEventsLogger.log("de_billing_tab_update_payment_method_click"),a.props.billingInfo.scheduled_for_downgrade?S.CancelChangesModalConfirmation.showInstance({transitionPerformed:a.reloadData,subStatus:a.subStatus}):C.INDIVIDUAL_UPDATE_BILLING_MODAL_REFACTOR?w.IndividualUpdateBillingModalLoader.showInstance():l.DBModalStack.push(new o({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{}}))},a.handlePaymentAdd=function(){A.ProEventsLogger.log("de_billing_tab_add_payment_method_click"),l.DBModalStack.push(new o({element_id:"add_billing_info",endpoint_url:"/add_billing_info_modal",html_in_error_msg:!0}))},a.handlePaymentAddToResubscribe=function(){A.ProEventsLogger.log("de_billing_tab_add_payment_method_resubscribe_click"),l.DBModalStack.push(new o({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{resubscribe:!0}}))},a.reloadData=function(){var e=a.props,t=e.loadBillingInfo,n=e.loadPlanDataIfNecessary,i=e.loadEvhInfoIfNecessary;t(!0),i(!0),n(!0)},a.handleBillingChange=function(){A.ProEventsLogger.log("de_billing_tab_change_billing_modal_open");var e=a.props.billingInfo,t=e.payment_info,n=e.scheduled_for_downgrade;if(L.NO_RESET_INTERVAL_FOR_USERS&&L.DE_DISABLE_STACKED_TRANSITIONS&&a.pendingScheduledChange())return void E.DisableStackedTransitionsModal.showInstance();n?S.CancelChangesModalConfirmation.showInstance({transitionPerformed:a.reloadData,subStatus:a.subStatus}):v.ChangeScheduleModalView.showInstance({transitionPerformed:a.reloadData,paymentInfo:t})},a.onEditInvoiceDetailsClick=function(){A.ProEventsLogger.log("de_billing_tab_edit_invoice_modal_open"),P.EditInvoiceAddressModalLoader.showUpdateTaxProfileModal(!1,a.onInvoiceDetailsUpdated)},a.onInvoiceDetailsUpdated=function(){a.props.loadBillingInfo(!0)},a.renderLicenseKeys=function(){return s.createElement("div",{className:"account-page-block"},s.createElement(N.LicenseKeys,{licenseKeys:a.props.billingInfo.license_keys}))},a.renderBillingHistory=function(){var e=a.props.billingInfo,t=e.transactions,n=e.show_edit_invoice_modal,i=e.edit_past_invoices,r=[],l=!1;return null!==t&&t.transactions.length>0&&(r=h.getHistoryData(t.transactions),l=r.length>3,r=r.slice(0,3)),s.createElement("div",{className:"account-page-block"},s.createElement("span",{className:"account-page-block__heading"},d._("Billing history")),s.createElement("p",{className:"account-page-block__subtext"},d._("View invoices and receipts for all payments made on your Dropbox account.")),s.createElement("div",{className:"billing-table-container"},s.createElement(y.BillingHistoryTable,{billingHistoryRecords:r,amountLabel:d._("Amount"),displayNoTransactionsOnEmptyRecords:!0,showEditInvoiceModal:n&&i,noTransactionLabel:d._("No transaction history"),footer:a.buildFooter(l),logAccountBillingTabEvents:!0,isTeam:!1})))},a.buildFooter=function(e){if(e)return s.createElement("tr",{className:"billing-history-row"},s.createElement("td",{colSpan:4,className:"billing-history-col"},s.createElement("a",{href:"/payments",target:"_blank",rel:"noopener noreferrer",onClick:a.logViewAll},d._("View all billing history"))))},a.logViewAll=function(){A.ProEventsLogger.log("de_billing_tab_view_all_click")},a.renderPaymentMethod=function(){if(a.user.paid){var e=a.props.billingInfo.payment_info,t=e.gateway_id,n=e.expiration_date,i=e.description,r=e.is_external_billing,l=e.end_date,o=e.deactivated,c=e.is_on_trial,u=e.reseller_name,p=e.reseller_link;if(r){var m=d._("Go to %(reseller_name)s to view or make changes to your account details").format({reseller_name:u}),h=s.createElement("a",{href:p,target:"_blank",rel:"noopener noreferrer"},m);return s.createElement(T.KeyValueBlock,{keyText:h})}if(t!==-1){if(!_.shouldHidePaymentMethod(t)&&!a.props.billingInfo.payment_method)return s.createElement(T.KeyValueBlock,{className:"add-payment",keyText:d._("You can add your payment information now to have           your subscription automatically renew when it expires"),linkText:d._("Add"),onLinkClick:a.handlePaymentAddToResubscribe});if(_.isLicenseKey(t))return s.createElement("div",{className:"account-page-block"},s.createElement(T.KeyValueBlock,{keyText:d._("Payment method"),subtext:d._("Add your payment information now to have           your subscription automatically renew when it expires"),linkText:d._("Add payment method"),onLinkClick:a.handlePaymentAdd}));if(_.shouldHidePaymentMethod(t)){var g=_.getPaymentMethodDisabledMessage(t,r,k.TRADEMARK_PLUS,l,o,c);return s.createElement(T.KeyValueBlock,{keyText:g})}var f=i;return null!==n&&(f=d._("%(payment_description)s, exp: %(expiration_date)s").format({payment_description:i,expiration_date:n,comment:'Payment description is a card information, already translated           (ex> Visa ending in 2543). Date is in format MM / YYYY ( ex> 08 / 2017 ).           An example translated string is "Visa ending in 2543, exp: 08 / 2017 ).'})),s.createElement(T.KeyValueBlock,{keyText:d._("Payment method"),valueText:f,linkText:d._("Update"),onLinkClick:a.handlePaymentUpdate})}}},a.renderBillingPeriod=function(){if(a.user.paid){var e=a.props.billingInfo,t=e.payment_info,n=e.scheduled_for_downgrade;if(!_.shouldHideBillingChange(t.gateway_id,t.is_external_billing)&&t.period){if(!t.schedule_switchable&&!n&&!a.isProfessionalTrialPlan)return s.createElement(T.KeyValueBlock,{keyText:d._("Sorry, you cannot change your billing schedule at this time.")});var i=d._("Plan billed %(period)s").format({period:t.period});return s.createElement(T.KeyValueBlock,{keyText:d._("Billing period"),valueText:i,linkText:d._("Change"),onLinkClick:a.handleBillingChange})}}},a.renderInvoiceDetails=function(){var e=a.props.billingInfo,t=e.show_edit_invoice_modal,n=e.payment_info,i=e.payment_method,r=e.has_invoice_details;if(a.user.paid&&t&&!_.shouldHideBillingChange(n.gateway_id,n.is_external_billing)&&n.period){var l=d._("Add details to your invoice, such as company name and address."),o=null;void 0!==i&&(o=i.country_code),o&&D.hasVat(o)&&(l=d._("Add details to your invoice, such as company name, address, and VAT ID."));var c=d._("Update");return r||(c=d._("Add invoice details")),s.createElement(T.KeyValueBlock,{keyText:d._("Invoice details"),linkText:c,subtext:l,onLinkClick:a.onEditInvoiceDetailsClick})}},a.user=m.getCurrentUser(),l.DBModalStack.register(r.BILLING_INFO_UPDATED,function(){A.ProEventsLogger.log("de_payment_modal_save_click"),a.props.loadBillingInfo(!0),a.props.loadPlanDataIfNecessary(!0)}),a}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.loadBillingInfo(),this.checkTTIstate(),A.ProEventsLogger.log("de_billing_tab_view"),this.events.on(window,"hashchange",function(){e.displayResubscribeBillingModal(),e.displayUpdateBillingModal()}),this.displayResubscribeBillingModal(),this.displayUpdateBillingModal()},t.prototype.componentDidUpdate=function(){this.checkTTIstate()},t.prototype.displayUpdateBillingModal=function(){var e=i.get_hash();void 0!==e&&e.search("billing_info")!==-1&&e.search("resubscribe_billing_info")===-1&&(C.INDIVIDUAL_UPDATE_BILLING_MODAL_REFACTOR?w.IndividualUpdateBillingModalLoader.showInstance():l.DBModalStack.push(new o({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{}})))},t.prototype.displayResubscribeBillingModal=function(){var e=i.get_hash();void 0!==e&&e.search("resubscribe_billing_info")!==-1&&(C.INDIVIDUAL_UPDATE_BILLING_MODAL_REFACTOR?w.IndividualUpdateBillingModalLoader.showInstance():l.DBModalStack.push(new o({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{resubscribe:!0}})))},Object.defineProperty(t.prototype,"subStatus",{get:function(){var e=this.props.billingInfo.serialized_sub_status;if(e)return M.SubscriptionStatus.deserialize(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&this.subStatus.subState.plan.productType===x.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isPlanScheduledToChange=function(){var e=this.subStatus;return!!this.props.billingInfo||!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.checkTTIstate=function(){this.props.dataLoadedForTTI&&(p.mark_time_to_view(),p.mark_time_to_interactive())},t.prototype.isLoading=function(){return"ready"!==this.props.loadingState},t.prototype.render=function(){return this.isLoading()?s.createElement(I.Loading,null):s.createElement("div",{className:"account-page-tab"},this.renderPaymentMethod(),this.renderBillingPeriod(),this.renderInvoiceDetails(),this.renderLicenseKeys(),this.renderBillingHistory())},t=a.__decorate([n.eventHandler],t)})(s.Component),U=c.connect(B,O)(R);t.BillingTab=u(U,["/static/css/account/pagelet/billing_tab-vflb68jtJ.css","/static/css/plan_management-vfl04dPHk.css"])}),define("modules/clean/account_page/tabs/plan",["require","exports","tslib","external/react","modules/clean/account_page/widgets/plan/views/plan_container"],function(e,t,a,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return n.createElement(i.PlanContainer,null)},t})(n.Component);t.PlanTab=r}),define("modules/clean/account_page/widgets/billing/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/billing/api","modules/clean/account_page/util"],function(e,t,a,n,i){"use strict";function r(e){var t=this;return void 0===e&&(e=!1),function(r,l){return a.__awaiter(t,void 0,void 0,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return"never_loaded"===l().billingInfo.loadingState||e?(r({type:"billing_info_load"}),[4,n.getBillingInfo(i.getCurrentUser().id)]):[3,2];case 1:return t=a.sent(),r({type:"billing_info_loaded",billingInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=r}),define("modules/clean/account_page/widgets/billing/api",["require","exports","modules/clean/ajax_as_promised"],function(e,t,a){"use strict";function n(e){return a.WebRequest({url:"/account/ajax_billing_tab_model",subject_user:e,dataType:"json"})}Object.defineProperty(t,"__esModule",{value:!0}),t.getBillingInfo=n}),define("modules/clean/account_page/widgets/billing/views/license_keys",["require","exports","tslib","modules/core/i18n","modules/core/browser","external/react","modules/clean/react/css","modules/clean/account_page/components/account_table","modules/clean/account_page/components/key_value_block"],function(e,t,a,n,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var a=e.call(this,t)||this;return a.licenseRowsIncrement=3,a.handleRedeemClick=function(){i.redirect("/pro/redeem_key")},a.buildLicenseFooter=function(){if(a.state.showViewMore)return r.createElement("tr",{className:"license-footer-row"},r.createElement("td",{colSpan:4},r.createElement("a",{onClick:a.showMoreLicense,href:"",rel:"noopener noreferrer"},n._("View more license keys"))))},a.showMoreLicense=function(e){e.preventDefault(),a.setState(function(e,t){var n=e.maxShow+a.licenseRowsIncrement;return{maxShow:n,showViewMore:n<t.licenseKeys.length}})},a.buildStatus=function(e){return e.activated?n._("Activated on %(activated_date)s").format({activated_date:e.activated_date}):n._("Scheduled for future use")},a.buildDuration=function(e){return e.duration?e.duration:n._("N/A")},a.buildLicenseKeyTable=function(){var e=a.props.licenseKeys;if(0!==e.length)return r.createElement("div",{className:"license-table-container"},r.createElement(o.Table,{className:"license-table"},r.createElement(o.TableHead,null,r.createElement(o.HeaderRow,{className:"license-header-row"},r.createElement(o.HeaderCell,{className:"license-key-header"},n._("Key")),r.createElement(o.HeaderCell,{className:"license-redeemed-header"},n._("Redeemed")),r.createElement(o.HeaderCell,{className:"license-duration-header"},n._("Duration")),r.createElement(o.HeaderCell,{className:"license-status-header"},n._("Status")))),r.createElement(o.TableFooter,{className:"license-footer"},a.buildLicenseFooter()),r.createElement(o.TableBody,null,e.map(function(e,t){if(!(t>=a.state.maxShow))return r.createElement(o.BodyRow,{className:"license-body-row "+(e.activated?"activated":"unused"),key:e.key},r.createElement(o.BodyCell,{className:"license-key"},e.key),r.createElement(o.BodyCell,{className:"license-redeemded"},e.redeemed_date),r.createElement(o.BodyCell,{className:"license-duration"},a.buildDuration(e)),r.createElement(o.BodyCell,{className:"license-status"},a.buildStatus(e)))}))))},a.state={maxShow:3,showViewMore:!1},a}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.setState(function(e,t){return{showViewMore:e.maxShow<t.licenseKeys.length}})},t.prototype.render=function(){return r.createElement("div",{className:"license-keys"},r.createElement(s.KeyValueBlock,{className:"redeem-license-key",keyText:n._("License keys"),linkText:n._("Redeem a license key"),onLinkClick:this.handleRedeemClick,subtext:n._("License keys will be applied before any other form of payment method")}),this.buildLicenseKeyTable())},t})(r.Component);t.LicenseKeys=l(c,["/static/css/account/pagelet/license_keys-vfltd2Jh8.css"])}),define("modules/clean/account_page/widgets/plan/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/plan/api","modules/clean/account_page/util"],function(e,t,a,n,i){"use strict";function r(e){var t=this;return function(r,l){return a.__awaiter(t,void 0,void 0,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return"never_loaded"===l().planTab.loadingState||e?(r({type:"plan_tab_load_info"}),[4,n.getPlanInfo(i.getCurrentUser().id)]):[3,2];case 1:return t=a.sent(),r({type:"plan_tab_info_loaded",planInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=r}),define("modules/clean/account_page/widgets/plan/add_ons/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/add_ons/api"],function(e,t,a,n,i){"use strict";function r(e){var t=this;return function(r,l){return a.__awaiter(t,void 0,void 0,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return"never_loaded"===l().planTab.evhLoadingState||e?(r({type:"load_evh_info"}),[4,i.getEvhInfo(n.getCurrentUser().id)]):[3,2];case 1:return t=a.sent(),r({type:"evh_info_loaded",evhInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadEvhInfoIfNecessary=r}),define("modules/clean/account_page/widgets/plan/add_ons/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,a,n){"use strict";function i(e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(t){return[2,n.WebRequest({url:"/account/ajax_get_evh_info",subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getEvhInfo=i}),define("modules/clean/account_page/widgets/plan/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,a,n){"use strict";function i(e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(t){return[2,n.WebRequest({url:"/account/ajax_plan_tab_model",subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getPlanInfo=i}),define("modules/clean/account_page/widgets/plan/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_IND_PLAN_MODAL_UPDATED="change_inv_plan_modal:updated"}),define("modules/clean/account_page/widgets/plan/plan_spectrum/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/growth/gating"],function(e,t,a,n,i){"use strict";function r(e){var t=this;return function(r,l){return a.__awaiter(t,void 0,void 0,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return"never_loaded"===l().planTab.planSpectrumLoadingState||e?(r({type:"plan_spectrum_load_info"}),[4,i.growthCheckGating(n.getCurrentUser(),"uj_plan_spectrum_upsell")]):[3,2];case 1:return t=a.sent(),r({type:"plan_spectrum_info_loaded",planSpectrumInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadPlanSpectrum=r}),define("modules/clean/account_page/widgets/plan/plan_spectrum/types",["require","exports","tslib","modules/clean/growth/user_action/tracker"],function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.BasicView="uj_plan_spectrum_upsell_basic_user_view",e.BasicPlusClick="uj_plan_spectrum_upsell_basic_user_plus_click",e.BasicProClick="uj_plan_spectrum_upsell_basic_user_pro_click",e.BasicUpgradeClick="uj_plan_spectrum_upsell_basic_user_upgrade_click",e.PlusView="uj_plan_spectrum_upsell_plus_user_view",e.PlusProClick="uj_plan_spectrum_upsell_plus_user_pro_click",e.PlusChangePlanClick="uj_plan_spectrum_upsell_plus_user_change_plan_click"})(t.PlanSpectrumActions||(t.PlanSpectrumActions={}));(function(e){e.Basic="basic",e.Plus="plus",e.Professional="pro"})(t.PlanType||(t.PlanType={}));var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.project="uj_plan_spectrum_upsell",t}return a.__extends(t,e),t})(n.GrowthUserActionTracker);t.PlanSpectrumTracker=i}),define("modules/clean/account_page/widgets/plan/referral_history/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/referral_history/api"],function(e,t,a,n,i){"use strict";function r(e,t){var r=this;return function(l,o){return a.__awaiter(r,void 0,void 0,function(){var r;return a.__generator(this,function(a){switch(a.label){case 0:return"never_loaded"===o().planTab.referralLoadingState||e?(l({type:"load_referral_history"}),[4,i.getReferralHistory(n.getCurrentUser().id,t)]):[3,2];case 1:return r=a.sent(),l({type:"referral_history_loaded",history:r}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadReferralHistoryIfNecessary=r}),define("modules/clean/account_page/widgets/plan/referral_history/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,a,n){"use strict";function i(e,t){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,n.WebRequest({url:"/account/bonus_page/"+t,subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getReferralHistory=i}),define("modules/clean/account_page/widgets/plan/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.MONTHLY=1]="MONTHLY",e[e.YEARLY=2]="YEARLY",e[e.PLUS=3]="PLUS",e[e.PROFESSIONAL=4]="PROFESSIONAL",e[e.ADD_EVH=5]="ADD_EVH",e[e.REMOVE_EVH=6]="REMOVE_EVH"})(t.PerformPlanTransition||(t.PerformPlanTransition={}))}),define("modules/clean/account_page/widgets/plan/views/add_ons",["require","exports","tslib","modules/core/i18n","modules/clean/react/css","external/react","modules/clean/static_urls","modules/constants/account_page","modules/clean/payments/skus/constants","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/clean/account_page/widgets/plan/views/evh_modal","modules/constants/account_page","modules/clean/analytics"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openEvhModal=function(e){var n=t.props.scheduledForDowngrade;if(e.stopPropagation(),p.NO_RESET_INTERVAL_FOR_USERS&&p.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return void u.DisableStackedTransitionsModal.showInstance();n?c.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.transitionPerformed,subStatus:t.props.subStatus}):d.EvhModalView.showInstance(a.__assign({},t.props))},t}return a.__extends(t,e),Object.defineProperty(t.prototype,"evhTitle",{get:function(){return this.props.evhInfo.is_unlimited_evh?n._("Unlimited version history"):n._("Extended version history")},enumerable:!0,configurable:!0}),t.prototype.isLoading=function(){return"ready"!==this.props.evhLoadingState},t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isPlanScheduledToChange=function(){var e=this.props,t=e.subStatus;return!!e.scheduledForDowngrade||!!(t&&t.subState.plan&&t.finalSubState.plan)&&t.subState.plan.productType!==t.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.evhLink=function(){var e=this.props.evhInfo,t=e.purchased,a=e.scheduled_to_remove,i=e.is_free_evh;if(!a&&!i){var l=t?n._("Remove EVH"):n._("Add EVH");return t?m.ProEventsLogger.log("de_plan_tab_evh_remove_link_click"):m.ProEventsLogger.log("de_plan_tab_evh_add_link_click"),r.createElement("a",{className:"evh-link",href:"#",onClick:this.openEvhModal},l)}},t.prototype.showExtendedVersionHistory=function(){var e=this.props,t=e.subStatus,a=e.evhInfo;if(t.subState.billingSchedule){var i=n._("One year file version history for %(evh_price)s per %(billing_period)s").format({evh_price:a.evh_price,billing_period:t.subState.billingSchedule.scheduleDescriptionNoun});if(t.subState.addons.peekSkus())switch(t.subState.addons.sku.adminCxId){case s.AdminCxId.UNLIMITED_FREE_VERSION_HISTORY:i=n._("Free unlimited file version history");break;case s.AdminCxId.UNLIMITED_MONTHLY_VERSION_HISTORY:case s.AdminCxId.UNLIMITED_YEARLY_VERSION_HISTORY:case s.AdminCxId.UNLIMITED_PAID_VERSION_HISTORY:i=n._("Unlimited file version history for %(evh_price)s per %(billing_period)s").format({evh_price:a.evh_price,billing_period:t.subState.billingSchedule.scheduleDescriptionNoun});break;case s.AdminCxId.ONE_YEAR_PAID_VERSION_HISTORY:i=n._("One year file version history for %(evh_price)s per %(billing_period)s").format({evh_price:a.evh_price,billing_period:t.subState.billingSchedule.scheduleDescriptionNoun});break;case s.AdminCxId.ONE_YEAR_FREE_VERSION_HISTORY:i=n._("Free one year file version history");break;case s.AdminCxId.FREE_120_DAYS_VERSION_HISTORY:i=n._("Free 120 days file version history");break;default:throw new Error("Unknown extended version history add-on")}return r.createElement("div",{className:"evh-container"},r.createElement("div",{className:"evh-body"},r.createElement("div",{className:"evh-text"},r.createElement("p",{className:"evh-title"},this.evhTitle),r.createElement("p",{className:"evh-content"},i)),this.evhLink()))}},t.prototype.render=function(){var e=this.props.evhInfo.is_available;return o.ACCOUNT_TAURUS_PLANS&&!e?r.createElement("noscript",null):this.isLoading()?r.createElement("div",{className:"loading-indicator"},r.createElement("img",{src:l.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:n._("Loading")})):r.createElement("div",{className:"add-ons"},r.createElement("p",{className:"header"},n._("Available add-ons")),r.createElement("p",{className:"context"},n._("Extend the functionality of your Dropbox plan with add-ons")),this.showExtendedVersionHistory())},t})(r.Component);t.AddOns=i(h,["/static/css/account/pagelet/add_ons-vflZFLEQS.css"])}),define("modules/clean/account_page/widgets/plan/views/cancel_changes_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/account_page/widgets/plan/constants","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/react/modal","modules/clean/analytics","modules/clean/payments/skus/subscription_service","modules/constants/trademark","modules/core/i18n","modules/clean/dbmodal_stack","modules/clean/account_page/util","modules/core/notify"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){var e=a.props.cancellationType;a.cancelScheduledChange(e)},new c.SubscriptionService,a.state={submitting:!1},a}return a.__extends(t,e),t.showInstance=function(e){o.Modal.showInstance(n.createElement(t,a.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelScheduledChange=function(e){var t=this,a=this.props.transitionPerformed;this.submittingRequest(),i.WebRequest({url:"/account/ajax_cancel_scheduled_change",data:{scheduled_change_type:e},subject_user:m.getCurrentUser().id,success:function(n){h.Notify.success(d._("You’ve cancelled your change!")),e===l.CancellationType.SCHEDULE&&s.ProEventsLogger.log("de_change_billing_cancel_change"),e===l.CancellationType.EVH_ADDON&&s.ProEventsLogger.log("de_evh_modal_cancel_change"),a&&a(),t.doneSubmittingRequest(),o.Modal.close(),t.props.reOpenModalDialogAfterCancellation&&p.DBModalStack.trigger(r.CHANGE_IND_PLAN_MODAL_UPDATED,null)},error:function(){h.Notify.error(d._("Failed to cancel changes.")),t.doneSubmittingRequest(),o.Modal.close(),t.props.reOpenModalDialogAfterCancellation&&p.DBModalStack.trigger(r.CHANGE_IND_PLAN_MODAL_UPDATED,null)}})},t.prototype.render=function(){var e=this.props,t=e.cancellationType,a=e.subStatus;if(!a.subState.plan||!a.subState.billingSchedule)return n.createElement("noscript",null);var i,r=d._("Confirm cancelling change");switch(t){case l.CancellationType.PLAN:i=d._("You’re cancelling your scheduled plan change. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_plus:u.TRADEMARK_PLUS,plan:a.subState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.finalSubState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.SCHEDULE:i=d._("You’re cancelling your scheduled billing change. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({plan:a.finalSubState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.subState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.EVH_ADDON:i=d._("You’re cancelling your EVH changes. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({plan:a.finalSubState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.finalSubState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.IND_SUBSCRIPTION:r=d._("Confirmation"),i=d._("By confirming, your downgrade to Dropbox Basic scheduled change will be cancelled.");break;case l.CancellationType.ALL:r=d._("Confirmation"),i=d._("By confirming, all existing scheduled changes will be cancelled.");break;default:r=d._("Confirmation"),i=d._("By confirming, the scheduled change will be cancelled.")}return n.createElement(o.Modal,{acceptButtonDisabled:this.state.submitting,acceptButtonText:d._("Confirm"),autoClose:!1,dismissButtonText:d._("Don’t cancel"),onAccept:this.onAccept,title:r,submitting:this.state.submitting},n.createElement("p",null,i))},t})(n.Component);t.CancelChangesModalConfirmationView=_}),define("modules/clean/account_page/widgets/plan/views/cancel_plan",["require","exports","tslib","external/react","modules/core/uri","modules/core/i18n","modules/clean/display_format","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/constants/account_page","modules/clean/payments/skus/constants","modules/clean/analytics"],function(e,t,a,n,i,r,l,o,s,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cancelPlanClick=function(e){if(u.ProEventsLogger.log("de_cancel_plan_subscription_click"),s.NO_RESET_INTERVAL_FOR_USERS&&s.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return e.preventDefault(),void o.DisableStackedTransitionsModal.showInstance()},t}return a.__extends(t,e),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cancelURL",{get:function(){return new i.URI({path:"/downgrade",query:{oqa:"acc_cancel"}}).toString()},enumerable:!0,configurable:!0}),
t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isPlanScheduledToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.render=function(){var e=this.props,t=e.subStatus,a=e.eligibleFor1tb;return t&&t.subState.plan&&t.subState.plan.productType!==c.ProductPlanType.FREE?n.createElement("div",{className:"cancel-plan"},n.createElement("span",{className:"cancel-plan__header"},r._("Cancel %(plan)s plan").format({plan:t.subState.plan.displayName(a)})),n.createElement("div",null,n.createElement("p",{className:"cancel-plan__desc"},r._("If you cancel your plan, your account will drop from %(quota)s             to 2 GB of space (plus any bonus space earned previously)").format({quota:l.format_bytes(this.quota)})),n.createElement("span",{className:"cancel-plan__downgrade-link"},n.createElement("a",{href:this.cancelURL,onClick:this.cancelPlanClick},r._("Cancel plan"))))):n.createElement("noscript",null)},t})(n.Component);t.CancelPlan=d}),define("modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal",["require","exports","tslib","modules/clean/ajax","modules/clean/react/css","modules/core/notify","external/react","modules/core/i18n","modules/clean/account_page/util","modules/clean/static_urls","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/react/modal","spectrum/button"],function(e,t,a,n,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var a=e.call(this,t)||this;return a.onDismiss=function(e){e.preventDefault(),d.Modal.close()},a.onAccept=function(){a.cancelScheduledChange()},a.state={submitting:!1},a}return a.__extends(t,e),t.showInstance=function(e){d.Modal.showInstance(l.createElement(t.cancelChangesModalConfirmationView,a.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelScheduledChange=function(){var e=this,t=this.props,a=t.transitionPerformed,i=t.userIdOverride,l=null;l=i?i:s.getCurrentUser().id,this.submittingRequest(),n.WebRequest({url:"/account/ajax_cancel_scheduled_change",data:{scheduled_change_type:u.CancellationType.IND_SUBSCRIPTION},subject_user:l,success:function(t){r.Notify.success(o._("You’ve cancelled your change!")),a&&a(),e.doneSubmittingRequest(),d.Modal.close()},error:function(){r.Notify.error(o._("Failed to cancel changes.")),e.doneSubmittingRequest(),d.Modal.close()}})},t.prototype.render=function(){var e=this.props.subStatus,t=this.state.submitting;if(!e)return l.createElement("noscript",null);var a=l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:o._("Loading")})),n=t?a:l.createElement("div",null,l.createElement("div",{className:"cancel-subscription-warning-modal__cancel-btn"},l.createElement(p.Button,{variant:"primary",onClick:this.onAccept,disabled:t},o._("Cancel downgrade"))),l.createElement("div",{className:"cancel-subscription-warning-modal__dismiss-btn"},l.createElement("a",{href:"#",onClick:this.onDismiss},o._("Dismiss"))));return l.createElement(d.Modal,{acceptButtonDisabled:this.state.submitting,autoClose:!1,className:"cancel-subscription-warning-modal",buttonComponent:l.createElement(d.ModalButtons,null),submitting:this.state.submitting},l.createElement("div",null,l.createElement("p",{className:"cancel-subscription-warning-modal__title"},o._("Plan downgrade scheduled")),l.createElement("p",{className:"cancel-subscription-warning-modal__desc"},o._("Your plan is scheduled to be downgraded to Dropbox Basic on %(date)s.               If you want to make any changes, first cancel your scheduled downgrade.").format({date:e.subState.formattedNextBillingDate})),n))},t.cancelChangesModalConfirmationView=i(t,["/static/css/account/pagelet/cancel_subs_warning-vfl-s2mqh.css"]),t})(l.Component);t.CancelChangesModalConfirmation=m}),define("modules/clean/account_page/widgets/plan/views/cancellable_notifications_view",["require","exports","tslib","external/react","external/react-dom-factories","modules/clean/react/css","modules/core/i18n","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/teams/admin/widgets/billing_notifications/cancellable_item","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/skus/constants","modules/clean/react_format","modules/constants/trademark","modules/clean/account_page/widgets/plan/views/cancel_changes_modal"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCancelSubscriptionAction=function(){t.handleCancelActions(c.CancellationType.IND_SUBSCRIPTION)},t.handleCancelPlanAction=function(){t.handleCancelActions(c.CancellationType.PLAN)},t.handleCancelScheduleAction=function(){t.handleCancelActions(c.CancellationType.SCHEDULE)},t.handleCancelEvhAction=function(){t.handleCancelActions(c.CancellationType.EVH_ADDON)},t.handleCancelActions=function(e){var a=t.props,n=a.subStatus,i=a.transitionPerformed,r=a.reOpenModalDialogAfterCancellation;n&&m.CancelChangesModalConfirmationView.showInstance({subStatus:n,transitionPerformed:i,cancellationType:e,reOpenModalDialogAfterCancellation:r})},t}return a.__extends(t,e),t.prototype.renderCancelSubscriptionNotification=function(){var e=this.props,t=e.subStatus,a=e.scheduledForDowngrade;if(t)return a?n.createElement(s.CancellableItemView,{title:l._("Scheduled plan change"),description:l._("Dropbox Basic"),handleAction:this.handleCancelSubscriptionAction,useSingleCancelLink:!1}):void 0},t.prototype.renderDowngradePlanNotification=function(){var e=this.props,t=e.subStatus,a=e.scheduledForDowngrade;if(t&&!a){var i=t.scheduledSubState;if(i){var r=t.subState.plan,o=i.plan;if(r&&o&&(r.productType!==o.productType||r.productType===o.productType&&r.productSpec!==o.productSpec)){var c=l._("Dropbox %(scheduled_plan)s").format({trademark_plus:p.TRADEMARK_PLUS,scheduled_plan:o.displayName()});return n.createElement(s.CancellableItemView,{title:l._("Scheduled plan change"),description:c,handleAction:this.handleCancelPlanAction,useSingleCancelLink:!1,className:"cancel-plan-schedule"})}}}},t.prototype.renderScheduledChange=function(){var e=this.props,t=e.subStatus,a=e.scheduledForDowngrade;if(t&&!a){var i=t.scheduledSubState;if(i&&i.billingSchedule&&t.subState.billingSchedule&&t.subState.billingSchedule.id!==i.billingSchedule.id){var r=i.billingSchedule.scheduleDescriptionAdjective;return n.createElement(s.CancellableItemView,{title:l._("Scheduled billing period"),description:l._("%(billing)s billing").format({billing:r.charAt(0).toUpperCase()+r.slice(1)}),handleAction:this.handleCancelScheduleAction,useSingleCancelLink:!1,className:"cancel-billing-schedule"})}}},t.prototype.renderEvhChange=function(){var e=this.props,t=e.subStatus,a=e.scheduledForDowngrade;if(t&&!a){var i=t.scheduledSubState;if(i)return t.subState.addons.skus.length>0&&1===t.subState.quantityForEvhAddOn()&&0===i.quantityForEvhAddOn()?n.createElement(s.CancellableItemView,{title:l._("Scheduled add-on change"),description:l._("Remove extended version history"),handleAction:this.handleCancelEvhAction,useSingleCancelLink:!1,className:"cancel-evh-schedule"}):void 0}},t.prototype.appendAllCancellationTypes=function(e){e.push(this.renderCancelSubscriptionNotification()),e.push(this.renderDowngradePlanNotification()),e.push(this.renderScheduledChange()),e.push(this.renderEvhChange())},t.prototype.render=function(){var e=this.props,t=e.displaySingleChangeCancellationItem,a=e.scheduledForDowngrade,r=e.subStatus,s=e.paymentInfo,p=e.hasLicenseKey,m=e.displayNewTotal;if(!r)return n.createElement("noscript",null);if(!s||o.shouldHideBillingChange(s.gateway_id,s.is_external_billing))return n.createElement("noscript",null);var h=[];if(!r.finalSubState.plan)return n.createElement("noscript",null);if(t)switch(t){case c.CancellationType.IND_SUBSCRIPTION:h.push(this.renderCancelSubscriptionNotification());break;case c.CancellationType.PLAN:h.push(this.renderDowngradePlanNotification());break;case c.CancellationType.SCHEDULE:h.push(this.renderScheduledChange());break;case c.CancellationType.EVH_ADDON:h.push(this.renderEvhChange());break;case c.CancellationType.ALL:this.appendAllCancellationTypes(h)}if(h=h.filter(function(e){return void 0!==e}),!h.length)return n.createElement("noscript",null);var _="";!a&&m&&(_=l._("Your new %(schedule)s total will be %(total)s.").format({schedule:u.productScheduleToProductScheduleDescription(r.finalSubState.plan.schedule),total:r.nextBillingSummary.total}));var g=n.createElement("div",{className:"cancellable-scheduled-notifications cancellable-scheduled-notifications__header"},d.reactFormat(l._("Changes are scheduled for <strong>%(date)s</strong>.").format({date:r.subState.formattedNextBillingDate}),{strong:i.strong()})," ",_);return n.createElement("div",{className:"cancellable-scheduled-notifications personal-cancellable-scheduled-notifications"},g,!p&&n.createElement("div",{className:"cancellable-scheduled-notifications cancellable-scheduled-notifications__items"},h))},t})(n.Component);t.CancellableNotificationsViewControl=h,t.CancellableNotificationsView=r(h,["/static/css/teams/admin/widgets/billing_notifications/cancellable_scheduled_notifications-vflQdegLi.css"])}),define("modules/clean/account_page/widgets/plan/views/change_plan_modal",["require","exports","tslib","modules/core/browser","modules/clean/react/image","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item","modules/clean/account_page/widgets/plan/constants","modules/constants/individual_invoice_modal","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/payments/validation","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/cash","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/react/modal","modules/constants/account_page","modules/clean/analytics","modules/clean/payments/skus/constants","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_status","modules/constants/trademark","modules/core/i18n","modules/clean/account_page/util","modules/clean/react_format","modules/clean/static_urls","modules/clean/react/arbor/elements/arbor_inputs","modules/clean/account_page/widgets/plan/views/pro_upsell_modal_content"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N,I,x,L,k,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var D;(function(e){e[e.MONTHLY=1]="MONTHLY",e[e.YEARLY=2]="YEARLY",e[e.PLUS=3]="PLUS",e[e.PROFESSIONAL=4]="PROFESSIONAL"})(D=t.PerformPlanTransition||(t.PerformPlanTransition={}));var M=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){var e,t,i=a.getSubChangePlan();if(i){i.finalSubState.planSku.productType!==P.ProductPlanType.PLUS&&i.finalSubState.planSku.productType!==P.ProductPlanType.STANDARD||(t=D.PROFESSIONAL,e=D.PLUS),i.finalSubState.planSku.productType===P.ProductPlanType.PROFESSIONAL&&(t=D.PLUS,e=D.PROFESSIONAL),a.setState(function(e){return{showErrors:!0}});var l=a.state,s=l.vat,c=l.paymentMethod;if(c&&c.country_code&&a.vatValidator(c.country_code,s))if(E.ProEventsLogger.log("de_change_plan_modal_confirm_change_click"),e&&t){a.setState(function(e){return{submitting:!0}});var u={transition_change_type:e};s&&(u.vat=s,E.ProEventsLogger.log("vat_provided_on_upgrade")),o.WebRequest({url:"/account/perform_personal_transition",data:u,subject_user:a.getUserId(),success:function(l){if(r.Notify.success(N._("You’ve changed your plan!")),a.removeShowModalParams(),a.logChangePlan(t,e),a.props.transitionPerformed&&a.props.transitionPerformed(),i.finalSubState.planSku.productType===P.ProductPlanType.PROFESSIONAL){if(a.state.expSubgrowthProConfirmationPage)return n.redirect("/professional_onboarding");a.setState({displayUpgradedToProfessionalContent:!0,loadingContent:!1,submitting:!1})}else S.Modal.close()},error:function(){r.Notify.error(N._("There was an error changing the plan!")),a.setState(function(e){return{submitting:!1}})}})}else r.Notify.error(N._("There was an error changing the plan!"))}},a.onDismiss=function(){E.ProEventsLogger.log("de_change_plan_modal_cancel_click")},a.onVatChange=function(e,t,n){var i=n;a.setState(function(e){return{vat:i,loadingChangeSummary:!0,showErrors:!1}});var r=a.state.paymentMethod;r&&r.country_code&&a.repriceTransitions(h.validateVat(r.country_code,i)?i:"")},a.handleCancelScheduleAction=function(e){a.handleCancelActions(g.CancellationType.SCHEDULE),e.preventDefault()},a.handleCancelActions=function(e){var t=a.state.subStatus;return t&&m.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:a.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},a.transitionPerformedClosure=function(e){if(a.props.transitionPerformed)return a.props.transitionPerformed()},a.getStartedClick=function(){n.redirect("/professional_onboarding")},a.state={loadingContent:!0,schedule:P.ScheduleId.MONTHLY,subChangePlans:[],submitting:!1,type:P.ProductPlanType.STANDARD,displayUpgradedToProfessionalContent:!1,showErrors:!1,vat:"",loadingChangeSummary:!1},a}return a.__extends(t,e),t.prototype.getUrlOption=function(e){var t=e,a=n.get_href().match(/option=([a-zA-Z_]*)/);if(a&&a.length>1){var i=a[1];"plus"===i&&(t=e===P.ProductPlanType.PROFESSIONAL?P.ProductPlanType.PLUS:e),"pro"===i&&(t=P.ProductPlanType.PROFESSIONAL)}return t},t.showInstance=function(e){S.Modal.showInstance(l.createElement(t.ChangePlanModal,a.__assign({},e)))},t.prototype.componentDidMount=function(){this.loadPlanTransitions()},t.prototype.onLoadPlanTransitions=function(e){var t=this;this.setState(function(a){var n=w.SubscriptionStatus.deserialize(e.serializedSubStatus),i=e.paymentMethod,r=n.finalSubState;if(!r.billingSchedule||!r.plan)throw"A base plan is required, in order to change it.";var l=n.subState.billingSchedule.id,o=e.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),s=o.map(function(e){return e});s.push(n);var c=t.getUrlOption(n.subState.plan.productType),u=e.exp_subgrowth_pro_plans_modal_simplification||"OFF";return["V1","V2","V3"].indexOf(u)>-1&&(c=P.ProductPlanType.PROFESSIONAL),{loadingContent:!1,subStatus:n,paymentMethod:i,schedule:l,subChangePlans:o,allSubStatuses:s,type:c,expProPlansModal:u,expSubgrowthProConfirmationPage:e.exp_subgrowth_pro_confirmation_page||!1}})},t.prototype.loadPlanTransitions=function(){var e=this;this.retrieveViewModel(function(t){e.onLoadPlanTransitions(t)},this.onLoadTransitionsError)},t.prototype.onLoadTransitionsError=function(){r.Notify.error(N._("Failed to load modal.")),S.Modal.close()},t.prototype.onRepriceTransitions=function(e){this.setState(function(t){var a=w.SubscriptionStatus.deserialize(e.serializedSubStatus),n=e.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),i=n.map(function(e){return e});i.push(a);return{subStatus:a,subChangePlans:n,allSubStatuses:i,loadingChangeSummary:!1}})},t.prototype.onRepriceError=function(){r.Notify.error(N._("Request failed")),S.Modal.close()},t.prototype.repriceTransitions=function(e){var t=this;this.retrieveViewModel(function(e){t.onRepriceTransitions(e)},this.onRepriceError,e)},t.prototype.getUserId=function(){return this.props.userIdOverride?this.props.userIdOverride:I.getCurrentUser().id},t.prototype.retrieveViewModel=function(e,t,a){var n=this,i=this.state,r=i.withVat,l=i.withoutVat,s=a?{vat:a}:void 0,c=a?r:l;c?e(c):o.WebRequest({url:"/account/ajax_change_plan",data:s,subject_user:this.getUserId(),success:function(t){var i=JSON.parse(t);n.setState(function(e){return a?{withVat:i}:{withoutVat:i}}),e(i)},error:t})},t.prototype.getSubChangePlan=function(e){return void 0===e&&(e=this.state.type),this.state.subChangePlans.filter(function(t){var a=t.finalSubState;return!(!a.plan||!a.billingSchedule)&&a.plan.productType===e}).pop()},Object.defineProperty(t.prototype,"hasTypeChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.plan&&e.finalSubState.plan.productType!==this.state.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentPlanChanged",{get:function(){return this.hasTypeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatusScheduleId",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id:P.ScheduleId.MONTHLY},enumerable:!0,configurable:!0}),t.prototype.logChangePlan=function(e,t){var a=this.state.subStatus;a&&a.subState.billingSchedule&&E.ProEventsLogger.log("de_change_plan_modal_change_plan",{from:e===D.PLUS?T.TRADEMARK_PLUS:"Professional",to:t===D.PROFESSIONAL?"Professional":T.TRADEMARK_PLUS})},t.prototype.removeShowModalParams=function(){var e=n.get_href().match(/modal=([a-zA-Z_]*)/);if(e&&e.length>1){"plan"===e[1]&&window.history.replaceState({},document.title,n.get_href().split("?")[0])}},t.prototype.changeProductPlanAndScheduleType=function(e,t){e===P.ProductPlanType.PROFESSIONAL?E.ProEventsLogger.log("de_change_plan_modal_professional_section_click"):E.ProEventsLogger.log("de_change_plan_modal_plus_section_click"),this.setState(function(a){return{type:e,schedule:t}})},t.prototype.getPlanDescription=function(e){switch(e.productType){case P.ProductPlanType.STANDARD:case P.ProductPlanType.PLUS:return N._("Stress-free sharing, offline folders on mobile, and %(plan_space)s storage.").format({plan_space:e.formattedSpecQuotaGb});case P.ProductPlanType.PROFESSIONAL:return N._("Smart Sync, Showcase, shared link controls, and %(plan_space)s storage.").format({plan_space:e.formattedSpecQuotaGb})}return""},t.prototype.changeProductPlanAndScheduleTypeClosure=function(e,t){var a=this;return function(){a.changeProductPlanAndScheduleType(e,t)}},t.prototype.renderPlanItems=function(){var e=this,t=this.state,a=t.type,n=t.allSubStatuses,i=t.subStatus,r=[P.ProductPlanType.STANDARD,P.ProductPlanType.PLUS,P.ProductPlanType.PROFESSIONAL];if(n&&i)return n.filter(function(t){return!!(t.finalSubState.plan&&i.subState.plan&&i.finalSubState.plan&&i.subState.planSku&&i.finalSubState.planSku&&i.subState.billingSchedule&&t.finalSubState.billingSchedule)&&(!e.isBillingScheduleToChange()||t.subState.billingSchedule.id===i.subState.billingSchedule.id)}).sort(function(e,t){return e.finalSubState.plan&&t.finalSubState.plan?r.indexOf(e.finalSubState.plan.productType)-r.indexOf(t.finalSubState.plan.productType):0}).map(function(t){var n=t.finalSubState.plan,r=t.finalSubState.billingSchedule;if(n&&r&&!(i&&i.subState&&i.subState.plan&&i.subState.plan.isLegacyPlan&&n.isAdvancePlan)&&i.scheduledSubState&&i.scheduledSubState.billingSchedule&&t&&t.subState.billingSchedule&&t.finalSubState.plan&&t.finalSubState.billingSchedule&&i.subState.billingSchedule&&i.subState.plan){var o,s=void 0,c=i.isOnTrial?i.finalSubState.plan:i.subState.plan;c&&n.productType===c.productType&&(o=N._("(current plan)"));var d=l.createElement("span",null,l.createElement("br",null),l.createElement("a",{href:"/plans/individual",target:"_blank",rel:"noreferrer noopener"},N._("See plan details"))),p=N._("Dropbox %(plan_name)s").format({plan_name:n.displayName()});return l.createElement(u.AdminPricedListItem,{key:n.code,isSelected:a===n.productType,title:p,titleWarningText:s,titleSecondaryText:o,description:e.getPlanDescription(n),detailsLink:d,price:n.displayCost,unit:n.billingSchedule.id===P.ScheduleId.MONTHLY?N._("per month"):N._("per year"),onClick:e.changeProductPlanAndScheduleTypeClosure(n.productType,r.id),disableItem:e.isPlanScheduledToChange()})}})},t.prototype.renderSubgrowthProPlansModalSimplificationExperiment=function(){var e=this,t=this.state,a=t.expProPlansModal,n=t.allSubStatuses,i=t.subStatus;if(!n||!i||!a)return null;for(var r,o=n.filter(function(t){return!!(t.finalSubState.plan&&i.subState.plan&&i.finalSubState.plan&&i.subState.planSku&&i.finalSubState.planSku&&i.subState.billingSchedule&&t.finalSubState.billingSchedule)&&(!e.isBillingScheduleToChange()||t.subState.billingSchedule.id===i.subState.billingSchedule.id)}),s=0,c=o;s<c.length;s++){var u=c[s];u.finalSubState.plan.productType===P.ProductPlanType.PROFESSIONAL&&(r=u)}if(!r||!r.finalSubState.plan)return null;var d=r.finalSubState.plan;return l.createElement(A.ProUpsellModalContent,{variant:a,price:d.displayCost,unit:d.billingSchedule.id===P.ScheduleId.MONTHLY?N._("per month"):N._("per year")})},t.prototype.renderBillingSection=function(){return l.createElement("div",null,this.state.expProPlansModal&&["V1","V2","V3"].indexOf(this.state.expProPlansModal)>-1?this.renderSubgrowthProPlansModalSimplificationExperiment():l.createElement(c.AdminPricedList,null,this.renderPlanItems()),this.renderVat())},t.prototype.renderVat=function(){var e=null;if(!this.vatDisplayEnabled)return e;var t=this.state,a=t.vat,n=t.paymentMethod,i=t.showErrors,r=n&&n.country_code?n.country_code:void 0;if(r){var o=h.getVatPrefix(r),s=N._("Please enter a valid VAT number, e.g. %(examples)s.").format({examples:h.getVatExamples(r).join(", ")});e=l.createElement(k.ArborTextInput,{name:"vat",placeholderText:o,labelText:N._("VAT number (optional)"),isValid:!i||this.vatValidator(r,a),errorText:s,value:a,onChange:this.onVatChange})}return e},t.prototype.vatValidator=function(e,t){return!t||h.validateVat(e,t)},t.prototype.renderPaymentMethod=function(){var e=this.state.paymentMethod;if(e&&!this.isPlanScheduledToChange())return l.createElement("div",{className:"upgrade-payment-method-link"},l.createElement(y.IndividualInlinePaymentMethodView,{paymentMethod:e,showModal:this.showModalClosure(this.props)}))},t.prototype.showModalClosure=function(e){return function(){t.showInstance(e)}},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.state.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isPlanScheduledToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isBillingScheduleToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.getPlanNameWithEvhText=function(e){var t=this.state.subStatus;return t&&t.scheduledSubState&&t.scheduledSubState.quantityForEvhAddOn()>0?e+" "+N._("+ extended version history"):e},t.prototype.renderScheduleTransitionText=function(){var e=this.state.subStatus,t=this.getSubChangePlan();if(e&&e.subState.plan){var a=l.createElement("a",{href:"#",onClick:this.handleCancelScheduleAction},N._("Cancel change"));if(this.isPlanScheduledToChange())return l.createElement("span",{className:"plan-transition"},N._("You’ve already requested a change to your plan. If you want           to choose a different plan or billing period, first cancel your pending change.")," ",a);if((!t||e.subState.planSku.productType===t.finalSubState.planSku.productType)&&e.subState.billingSchedule&&e.currentBillingSummary){if(!this.isScheduledToChange()||!v.NO_RESET_INTERVAL_FOR_USERS)return l.createElement("span",{className:"plan-transition"},N._("Your Dropbox %(plan)s plan will renew on %(date)s.                 Your current %(schedule)s total is %(recurring_total)s.").format({plan:this.getPlanNameWithEvhText(e.subState.plan.displayName()),schedule:e.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:f.Cash.formatWithTaxLabels(e.currentBillingSummary.total,e.currentBillingSummary),date:e.subState.formattedNextBillingDate}));if(e.scheduledSubState&&e.scheduledSubState.plan)return l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},x.reactFormat(N._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your Dropbox                     %(plan)s. Your new %(schedule)s total will be %(scheduled_total)s.").format({plan:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:f.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:l.createElement("strong",null)})))}if(t&&t.finalSubState.plan){var n=void 0!==t.tvm;return t&&t.tvm&&n?l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},x.reactFormat(N._("You’re upgrading your plan to Dropbox %(plan)s.                 <strong>We’ll charge you %(prorated_price)s now</strong>, which is prorated for the current                 billing period. Starting on %(date)s and until you <cancelLink>cancel</cancelLink>, we’ll bill you once a %(schedule_noun)s and your new                 %(schedule)s total will be %(scheduled_total)s. If you cancel, previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan:this.getPlanNameWithEvhText(t.finalSubState.plan.displayName()),prorated_price:f.Cash.formatWithTaxLabels(t.tvm.getTotalPrice(),t.nextBillingSummary),date:t.subState.formattedNextBillingDate,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:f.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:l.createElement("strong",null),cancelLink:l.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:l.createElement("a",{href:"/help/billing/plus-refund"})}))):n?void 0:l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},x.reactFormat(N._("Starting on %(date)s, your plan will be downgraded to Dropbox %(plan)s                 and your new %(schedule)s total will be %(scheduled_total)s. Charges will                 continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan:this.getPlanNameWithEvhText(t.finalSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:f.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:l.createElement("strong",null),cancelLink:l.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:l.createElement("a",{href:"/help/billing/plus-refund"})})))}}},t.prototype.renderChangeFooter=function(){var e;return this.state.loadingChangeSummary?l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:L.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N._("Loading")})):(this.isPlanScheduledToChange()||(e=this.renderPaymentMethod()),l.createElement("div",{className:"plan-footer u-font-meta"},this.renderScheduleTransitionText(),e))},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.state.paymentMethod,t=this.state,a=t.loadingContent,n=t.loadingChangeSummary,i=t.submitting;return!(!(a||n||i)&&e)||!this.hasUserSelectedDifferentPlan()},enumerable:!0,configurable:!0}),t.prototype.isValidVatCountry=function(){var e=this.state.paymentMethod;return e&&e.country_code&&h.hasVat(e.country_code)},t.prototype.isUserOnPlus=function(){var e=this.state.subStatus;return e&&e.subState&&e.subState.plan&&e.subState.plan.productType===P.ProductPlanType.PLUS},t.prototype.hasUserSelectedDifferentPlan=function(){return!this.isPlanScheduledToChange()&&this.hasTypeChanged},Object.defineProperty(t.prototype,"vatDisplayEnabled",{get:function(){var e=this.state,t=e.loadingContent,a=e.submitting;return p.INDIVIDUAL_INVOICE_MODAL&&!t&&!a&&this.isValidVatCountry()&&this.isUserOnPlus()&&this.hasUserSelectedDifferentPlan()},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,a=this,n=this.props,r=n.transitionPerformed,o=n.paymentInfo,s=this.state,c=s.subStatus,u=s.displayUpgradedToProfessionalContent,p=s.loadingContent,m=s.submitting,h=N._("Change plan"),f=N._("Cancel"),y=N._("Confirm change");if(c&&u)y="",f="",e=l.createElement("div",{className:"upgrade-to-professional"},l.createElement(i.Image,{className:"upgrade-to-professional__img",src:L.static_url("/static/images/account_page/successful-upgrade-conf-vfljF71a-.png"),srcHiRes:L.static_url("/static/images/account_page/successful-upgrade-conf@2x-vflKbwL4c.png"),alt:N._("")}),l.createElement("h3",{className:"upgrade-to-professional__title"},N._("Congrats! You’ve upgraded to Dropbox Professional")),l.createElement("p",{className:"upgrade-to-professional__desc"},N._("Get ready to take advantage of advanced features like Smart Sync, Showcase, and more support options.")),l.createElement("button",{className:"button-primary upgrade-to-professional_cta_btn",onClick:this.getStartedClick},N._("Got it")));else if(p)e=l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:L.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N._("Loading")}));else{var v=void 0;if(c&&r){b.DBModalStack.clear(),b.DBModalStack.register(d.CHANGE_IND_PLAN_MODAL_UPDATED,function(){t.showInstance({transitionPerformed:a.transitionPerformedClosure})}),v=l.createElement(_.CancellableNotificationsView,{subStatus:c,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:g.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:o,displayNewTotal:!1})}this.state.expProPlansModal&&["V1","V2","V3"].indexOf(this.state.expProPlansModal)>-1&&(h=N._("Upgrade account"),y=N._("Upgrade now")),e=l.createElement("div",null,v,this.renderBillingSection(),this.renderChangeFooter())}return l.createElement(S.Modal,{acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:y,className:"change-plan-modal",dismissButtonText:f,autoClose:!1,onAccept:this.onAccept,onDismiss:this.onDismiss,submitting:m,title:h},e)},t.ChangePlanModal=s(t,["/static/css/teams/admin/widgets/change_plan_modal/change_plan_modal-vflOA5abp.css"]),t})(l.Component);t.ChangePlanModalView=M}),
define("modules/clean/account_page/widgets/plan/views/change_schedule_modal",["require","exports","tslib","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item","modules/clean/account_page/widgets/plan/constants","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/cash","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/react/modal","modules/constants/account_page","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/analytics","modules/clean/payments/skus/constants","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_status","modules/core/i18n","modules/clean/account_page/util","modules/clean/react_format","modules/clean/static_urls"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){var e,t,i=a.getSubChangePlan();i&&(i.finalSubState.billingSchedule.id===v.ScheduleId.MONTHLY&&(t=y.PerformPlanTransition.YEARLY,e=y.PerformPlanTransition.MONTHLY),i.finalSubState.billingSchedule.id===v.ScheduleId.YEARLY&&(t=y.PerformPlanTransition.MONTHLY,e=y.PerformPlanTransition.YEARLY),e&&t?(a.setState(function(e){return e.submitting=!0,e}),r.WebRequest({url:"/account/perform_personal_transition",data:{transition_change_type:e},subject_user:w.getCurrentUser().id,success:function(e){n.Notify.success(C._("You’ve changed your billing period!")),a.logChangeSchedule(),a.props.transitionPerformed&&a.props.transitionPerformed(),f.Modal.close()},error:function(){n.Notify.error(C._("There was an error changing the billing period!")),a.setState(function(e){return e.submitting=!1,e})}})):n.Notify.error(C._("There was an error changing the billing period!")))},a.handleCancelScheduleAction=function(){return a.handleCancelActions(p.CancellationType.SCHEDULE),!1},a.handleCancelActions=function(e){var t=a.state.subStatus;return t&&u.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:a.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},a.transitionPerformedClosure=function(e){if(a.props.transitionPerformed)return a.props.transitionPerformed()},a.onDismissModal=function(){S.ProEventsLogger.log("de_cancel_billing_change_modal")},a.state={loadingContent:!0,schedule:v.ScheduleId.MONTHLY,subChangePlans:[],submitting:!1,type:v.ProductPlanType.STANDARD,hasLicenseKey:!1},a}return a.__extends(t,e),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){var e=this.state.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===v.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),t.showInstance=function(e){f.Modal.showInstance(i.createElement(t.ChangeScheduleModal,a.__assign({},e)))},t.prototype.componentDidMount=function(){this.loadPlanTransitions()},t.prototype.loadPlanTransitions=function(){var e=this;r.WebRequest({url:"/account/ajax_change_plan_schedule",subject_user:w.getCurrentUser().id,success:function(t){var a=JSON.parse(t);e.setState(function(e){e.loadingContent=!1,e.subStatus=P.SubscriptionStatus.deserialize(a.serializedSubStatus),e.paymentMethod=a.paymentMethod,e.hasLicenseKey=a.hasLicenseKey;var t=e.subStatus.finalSubState;if(!t.billingSchedule||!t.plan)throw"A base plan is required, in order to change it.";return e.hasLicenseKey?e.schedule=e.subStatus.scheduledSubState.billingSchedule.id:e.schedule=e.subStatus.subState.billingSchedule.id,e.subChangePlans=a.serializedSubChangePlans.map(function(e){return E.SubscriptionChangePlan.deserialize(e)}),e.allSubStatuses=e.subChangePlans.map(function(e){return e}),e.allSubStatuses.push(e.subStatus),e.type=e.subStatus.subState.plan.productType,e})},error:function(){n.Notify.error(C._("Failed to load modal.")),f.Modal.close()}})},t.prototype.getSubChangePlan=function(e,t){return void 0===e&&(e=this.state.type),void 0===t&&(t=this.state.schedule),this.state.subChangePlans.filter(function(a){var n=a.finalSubState;return!(!n.plan||!n.billingSchedule)&&(n.plan.productType===e&&n.billingSchedule.id===t)}).pop()},Object.defineProperty(t.prototype,"hasTypeChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.plan&&e.finalSubState.plan.productType!==this.state.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasScheduleChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule&&e.finalSubState.billingSchedule.id!==this.state.schedule},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentPlanChanged",{get:function(){return this.hasTypeChanged||this.hasScheduleChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatusScheduleId",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id:v.ScheduleId.MONTHLY},enumerable:!0,configurable:!0}),t.prototype.logChangeSchedule=function(){var e=this.state.subStatus;e&&e.subState.billingSchedule&&S.ProEventsLogger.log("de_change_billing_change_schedule",{from:e.subState.billingSchedule.id===v.ScheduleId.MONTHLY?"yearly":"monthly",to:e.subState.billingSchedule.id===v.ScheduleId.MONTHLY?"monthly":"yearly"})},t.prototype.changeProductPlanAndScheduleType=function(e,t){this.setState(function(a){return a.type=e,a.schedule=t,a})},t.prototype.changeProductPlanAndScheduleTypeClosure=function(e,t){var a=this;return function(){a.changeProductPlanAndScheduleType(e,t)}},t.prototype.getScheduleDescription=function(e,t,a){var n=this.state.subStatus;if(!(e.finalSubState.billingSchedule&&e.finalSubState.plan&&n&&n.scheduledSubState&&n.scheduledSubState.plan&&n.subState.plan))return"";var i=this.getOriginalStatusForCurrentStatus(n.subState.plan.productType,v.ScheduleId.MONTHLY);if(this.isPlanScheduledToChange()&&this.isBillingScheduleToChange()&&(i=this.getSubStatusFromSubChangePlans(n.subState.plan.productType,v.ScheduleId.MONTHLY)),!i||!i.subState.planSku||!i.finalSubState.planSku)return"";var r;r=this.isPlanScheduledToChange()?i.finalSubState.planSku.displayCost.multiply(12):n.subState.billingSchedule.id===v.ScheduleId.MONTHLY?i.subState.planSku.displayCost.multiply(12):i.finalSubState.planSku.displayCost.multiply(12);var l="";switch(l=this.isPlanScheduledToChange()&&this.isBillingScheduleToChange()?n.subState.plan.displayName():n.scheduledSubState.plan.displayName(),e.finalSubState.billingSchedule.id){case v.ScheduleId.YEARLY:var o=a.amount,s=r.amount,c=C.format_percent(Math.round(100*(1-o/s)));return C._("Dropbox %(plan_name)s is %(price_per_year)s per year.           You’ll save %(save_percentage)s over monthly billing.").format({plan_name:l,price_per_year:a,save_percentage:c});case v.ScheduleId.MONTHLY:return C._("Dropbox %(plan_name)s is %(price_per_month)s per month.           You’ll spend %(price_per_year)s per year.").format({plan_name:l,price_per_month:t,price_per_year:a})}return""},t.prototype.getBillingItemTitle=function(e){switch(e){case v.ScheduleId.YEARLY:return C._("Billed yearly");case v.ScheduleId.MONTHLY:return C._("Billed monthly")}return""},t.prototype.getOriginalStatusForCurrentStatus=function(e,t){var a=this,n=this.state,i=n.allSubStatuses,r=n.subStatus;if(i&&r)return i.filter(function(n){return!!(n.finalSubState.plan&&r.finalSubState.plan&&n.finalSubState.billingSchedule)&&((n.subState.plan.productType===e||a.isProfessionalTrialPlan)&&n.finalSubState.billingSchedule.id===t)}).pop()},t.prototype.getSubStatusFromSubChangePlans=function(e,t){var a=this.state,n=a.subChangePlans,i=a.subStatus;if(n&&i)return n.filter(function(a){return!!(a.finalSubState.plan&&i.finalSubState.plan&&a.finalSubState.billingSchedule)&&(a.finalSubState.plan.productType===e&&a.finalSubState.billingSchedule.id===t)}).pop()},t.prototype.renderBillingScheduleItems=function(){var e=this,t=this.state,a=t.allSubStatuses,n=t.subStatus,r=t.schedule,l=t.hasLicenseKey;if(a&&n)return a.filter(function(t){return!!(t.finalSubState.plan&&n.subState.plan&&n.finalSubState.plan)&&(!e.isPlanScheduledToChange()||!e.isBillingScheduleToChange()||t.finalSubState.plan.productType===n.subState.plan.productType)}).sort(function(e,t){return e.finalSubState.billingSchedule&&t.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id-t.finalSubState.billingSchedule.id:0}).map(function(t){var a=t.finalSubState.plan,o=t.finalSubState.billingSchedule;if(a&&o&&n.subState.billingSchedule&&n.subState.plan&&t.finalSubState.billingSchedule){var c=e.getOriginalStatusForCurrentStatus(n.subState.plan.productType,t.finalSubState.billingSchedule.id);if(c&&c.finalSubState.billingSchedule&&t.subState.billingSchedule){var u,d=a.displayCost,p=a.displayCost,m=a.displayCost,h=t.finalSubState.billingSchedule.id,_=n.subState.billingSchedule.id;switch(l&&n.scheduledSubState&&n.scheduledSubState.billingSchedule&&(_=n.scheduledSubState.billingSchedule.id),_){case v.ScheduleId.MONTHLY:u=C._("per month"),h===v.ScheduleId.YEARLY&&(p=d.divide(12),d=p),h===v.ScheduleId.MONTHLY&&(m=p.multiply(12));break;case v.ScheduleId.YEARLY:u=C._("per year"),h===v.ScheduleId.YEARLY&&(p=d.divide(12)),h===v.ScheduleId.MONTHLY&&(m=d.multiply(12),d=m)}var g,f,b=void 0,y=o.id===r;e.isPlanScheduledToChange()&&!e.isProfessionalTrialPlan&&(f=i.createElement("span",null,i.createElement("br",null),i.createElement("a",{href:"/plans/individual",target:"_blank",rel:"noreferrer noopener"},C._("See other plans"))));return n.subState.billingSchedule.id===o.id&&(g=C._("(current billing period)")),i.createElement(s.AdminPricedListItem,{key:a.code,isSelected:y,title:e.getBillingItemTitle(o.id),titleWarningText:b,titleSecondaryText:g,description:e.getScheduleDescription(c,p,m),price:d,detailsLink:f,unit:u,onClick:e.changeProductPlanAndScheduleTypeClosure(a.productType,o.id),disableItem:e.isBillingScheduleToChange()})}}})},t.prototype.renderBillingSection=function(){return i.createElement("div",null,i.createElement(o.AdminPricedList,null,this.renderBillingScheduleItems()))},t.prototype.renderPaymentMethod=function(){var e=this.state.paymentMethod;if(e&&!this.isBillingScheduleToChange())return i.createElement("div",{className:"upgrade-payment-method-link"},i.createElement(g.IndividualInlinePaymentMethodView,{paymentMethod:e,showModal:this.showModalClosure(this.props)}))},t.prototype.showModalClosure=function(e){return function(){t.showInstance(e)}},t.prototype.isPlanScheduledToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.state.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.state,t=e.subStatus;return!e.hasLicenseKey&&!!(t&&t.subState.billingSchedule&&t.finalSubState.billingSchedule)&&t.subState.billingSchedule.id!==t.finalSubState.billingSchedule.id},t.prototype.getPlanNameWithEvhText=function(e){var t=this.state.subStatus;return t&&t.scheduledSubState&&t.scheduledSubState.quantityForEvhAddOn()>0?e+" "+C._("+ extended version history"):e},t.prototype.renderScheduleTransitionText=function(){var e=this.state.subStatus,t=this.getSubChangePlan();if(e&&e.subState.plan){var a=i.createElement("a",{href:"#",onClick:this.handleCancelScheduleAction},C._("Cancel change"));if(this.isBillingScheduleToChange())return i.createElement("span",{className:"plan-transition"},C._("You’ve already requested a change to your billing period. If you want             to choose a different billing period, first cancel your pending change.")," ",a);if(this.isProfessionalTrialPlan&&!this.hasScheduleChanged)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},_.getProfessionalTrialScheduleDescription(e)));if((!t||this.isBillingScheduleToChange())&&e.currentBillingSummary)return b.NO_RESET_INTERVAL_FOR_USERS&&this.isScheduledToChange()&&e.scheduledSubState&&e.scheduledSubState.plan?i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                   Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:i.createElement("strong",null)}))):i.createElement("div",null,i.createElement("p",{className:"plan-transition"},C._("Your Dropbox %(plan)s plan will renew on %(date)s.                 Your current %(schedule)s total is %(recurring_total)s.").format({plan:this.getPlanNameWithEvhText(e.subState.plan.displayName()),schedule:e.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:m.Cash.formatWithTaxLabels(e.currentBillingSummary.total,e.currentBillingSummary),date:e.subState.formattedNextBillingDate})));if(e.scheduledSubState&&e.scheduledSubState.plan){if(!t||!t.finalSubState.plan)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.                 Charges will continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:i.createElement("strong",null),cancelLink:i.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:i.createElement("a",{href:"/help/billing/plus-refund"})})));if(b.NO_RESET_INTERVAL_FOR_USERS)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.                 Charges will continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:i.createElement("strong",null),cancelLink:i.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:i.createElement("a",{href:"/help/billing/plus-refund"})})));var n=void 0!==t.tvm;if(t&&t.tvm&&n){var r="",l="";return this.isPlanScheduledToChange()&&(r=" "+C._("Upgrading will cancel all scheduled changes.")),this.isEvhScheduledForDowngrade()&&(l=" "+C._("Your scheduled add-on change will take place immediately.")),i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("You’re changing to %(schedule)s billing.%(evh_upgrade_warning)s                 <strong>We’ll charge you %(prorated_price)s now</strong>, which is prorated for the current                 billing period. Your plan will renew on %(date)s. Your new %(schedule)s total                 will be %(scheduled_total)s.%(upgrade_warning)s").format({prorated_price:m.Cash.formatWithTaxLabels(t.tvm.getTotalPrice(),t.nextBillingSummary),date:t.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:m.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary),upgrade_warning:r,evh_upgrade_warning:l}),{strong:i.createElement("strong",null)})))}return n?void 0:i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("You’re changing to %(schedule)s billing.                 Starting on %(date)s, we’ll bill you once a %(schedule_noun)s.                 Your new %(schedule)s total will be %(scheduled_total)s.").format({date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:i.createElement("strong",null)})))}}},t.prototype.renderFooter=function(){return this.renderScheduleChangeFooter()},t.prototype.renderScheduleChangeFooter=function(){var e;return this.isBillingScheduleToChange()||(e=this.renderPaymentMethod()),i.createElement("div",{className:"plan-footer u-font-meta"},this.renderScheduleTransitionText(),e)},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.state.paymentMethod,t=this.state,a=t.loadingContent,n=t.submitting;return!(!a&&!n&&e)||(!this.hasScheduleChanged||this.isBillingScheduleToChange())},enumerable:!0,configurable:!0}),t.prototype.isEvhScheduledForDowngrade=function(){var e=this.state.subStatus;if(!e)return!1;var t=e.scheduledSubState;return!!t&&(e.subState.addons.skus.length>0&&1===e.subState.quantityForEvhAddOn()&&0===t.quantityForEvhAddOn())},t.prototype.render=function(){var e,a=this,n=this.state.subStatus,r=this.props,l=r.transitionPerformed,o=r.paymentInfo,s=this.state,u=s.loadingContent,m=s.submitting,_=s.hasLicenseKey;if(u)e=i.createElement("div",{className:"loading-indicator"},i.createElement("img",{src:N.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:C._("Loading")}));else{var g=void 0;if(n&&l&&!this.isProfessionalTrialPlan){h.DBModalStack.clear(),h.DBModalStack.register(c.CHANGE_IND_PLAN_MODAL_UPDATED,function(){t.showInstance({transitionPerformed:a.transitionPerformedClosure})}),g=i.createElement(d.CancellableNotificationsView,{subStatus:n,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:p.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:o,hasLicenseKey:_,displayNewTotal:!1})}e=i.createElement("div",null,g,this.renderBillingSection(),this.renderFooter())}return i.createElement(f.Modal,{acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:C._("Confirm change"),className:"change-plan-modal",dismissButtonText:C._("Cancel"),onDismiss:this.onDismissModal,autoClose:!1,onAccept:this.onAccept,submitting:m,title:C._("Change billing period")},e)},t.ChangeScheduleModal=l(t,["/static/css/teams/admin/widgets/change_plan_modal/change_plan_modal-vflOA5abp.css"]),t})(i.Component);t.ChangeScheduleModalView=I}),define("modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal",["require","exports","tslib","modules/clean/react/css","external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,a,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAccept=function(){l.Modal.close()},t}return a.__extends(t,e),t.showInstance=function(){l.Modal.showInstance(i.createElement(t.DisableStackedTransitionsModalView,null))},t.prototype.render=function(){return i.createElement(l.Modal,{title:r._("Cancel scheduled changes"),autoClose:!1,dismissButtonText:r._(""),onAccept:this.onAccept,className:"evh-removal-warning-modal"},i.createElement("div",null,i.createElement("p",{className:"evh-removal-warning-modal__desc"},r._("You’ll need to cancel your scheduled changes before making further changes.").format({}))))},t.DisableStackedTransitionsModalView=n(t,["/static/css/account/pagelet/evh_removal_warning-vfloW5p1U.css"]),t})(i.Component);t.DisableStackedTransitionsModal=o}),define("modules/clean/account_page/widgets/plan/views/evh_modal",["require","exports","tslib","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","external/classnames","modules/core/i18n","modules/clean/react_format","modules/clean/payments/skus/constants","modules/constants/account_page","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/payments/cash","spectrum/checkbox","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/evh_removal_warning","modules/clean/react/modal","modules/constants/account_page","modules/clean/account_page/widgets/plan/types","modules/clean/analytics","modules/clean/payments/skus/subscription_service","modules/clean/payments/skus/subscription_change_plan","modules/clean/account_page/util"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var N=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){var e=a.props.evhInfo.purchased,t=e?E.PerformPlanTransition.REMOVE_EVH:E.PerformPlanTransition.ADD_EVH;a.setState(function(e){return e.submitting=!0,e}),r.WebRequest({url:"/account/perform_personal_transition",data:{transition_change_type:t},subject_user:T.getCurrentUser().id,success:function(e){n.Notify.success(s._("You’ve changed your plan!")),P.ProEventsLogger.log("de_evh_modal_toggle_evh"),a.props.transitionPerformed&&a.props.transitionPerformed(),S.Modal.close()},error:function(){n.Notify.error(s._("There was an error updating your plan!")),a.setState(function(e){return e.submitting=!1,e})}})},a.toggleEvh=function(){var e=a.props.evhInfo,t=a.state.isEvhSelected;e.scheduled_to_remove||(P.ProEventsLogger.log("de_evh_modal_change_evh_election",{from:t?"evh_on":"evh_off",to:t?"evh_off":"evh_on"}),a.setState({isEvhSelected:!t}))},a.cancelEvhChange=function(){return a.handleCancelActions(m.CancellationType.EVH_ADDON),!1},a.handleCancelActions=function(e){var t=a.props.subStatus;return t&&h.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:a.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},a.transitionPerformedClosure=function(){if(a.props.transitionPerformed)return a.props.transitionPerformed()},a.onAcceptEvhRemovalWarning=function(){y.EvhRemovalWarningModal.showInstance({evhInfo:a.props.evhInfo,transitionPerformed:a.props.transitionPerformed,subStatus:a.props.subStatus})},new C.SubscriptionService,a.state={isEvhSelected:t.evhInfo.purchased,submitting:!1},a}return a.__extends(t,e),t.showInstance=function(e){S.Modal.showInstance(i.createElement(t.EvhModalViewModal,a.__assign({},e)))},t.prototype.isProfessionalPlanScheduled=function(){var e=this.props.subStatus;return!!(e&&e.scheduledSubState&&e.scheduledSubState.plan)&&(e.scheduledSubState.plan.productType===u.ProductPlanType.PROFESSIONAL||e.scheduledSubState.plan.productType===u.ProductPlanType.PROFESSIONAL_TRIAL)},t.prototype.isPlanScheduledToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.renderFooter=function(){var e=this.props,t=e.evhInfo,a=e.subStatus,n=this.state.isEvhSelected;if(t.scheduled_to_remove)return i.createElement("p",{className:"evh-modal-footer"},s._("You’ve already requested a plan change. If you want to choose a different plan,           first cancel your pending change.")," ",i.createElement("a",{onClick:this.cancelEvhChange},s._("Cancel change")));if(t.evh_transition&&a.subState&&a.subState.plan&&a.scheduledSubState&&a.scheduledSubState.plan){var r=w.SubscriptionChangePlan.deserialize(t.evh_transition);if(n){if(t.purchased)return v.NO_RESET_INTERVAL_FOR_USERS&&this.isScheduledToChange()&&a.scheduledSubState&&a.scheduledSubState.plan?i.createElement("p",{className:"evh-modal-footer"},c.reactFormat(s._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan and your new %(schedule)s total will be %(scheduled_total)s.").format({plan_name:a.scheduledSubState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:a.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:_.Cash.formatWithTaxLabels(a.nextBillingSummary.total,a.nextBillingSummary)}),{strong:i.createElement("strong",null)})):i.createElement("p",{className:"evh-modal-footer"},s._("Your Dropbox %(plan_name)s + extended version history plan will renew on %(date)s.                 Your current %(billing_schedule)s total is %(total)s.").format({plan_name:a.subState.plan.displayName(),date:a.subState.formattedNextBillingDate,billing_schedule:a.subState.billingSchedule.scheduleDescriptionAdjective,total:a.currentBillingSummary?_.Cash.formatWithTaxLabels(a.currentBillingSummary.total,a.currentBillingSummary):""}));var l="";return r.tvm&&(l=_.Cash.formatWithTaxLabels(r.tvm.getTotalPrice(),r.nextBillingSummary)),i.createElement("div",{className:"evh-modal-footer"},i.createElement("span",{className:"change-summary"},s._("Change summary")),i.createElement("p",null,c.reactFormat(s._("You’re adding extended version history to your Dropbox %(plan_name)s plan.                   <strong>We’ll charge you %(prorated_price)s now</strong>, which has been prorated                   for the current billing period. Your plan will renew on %(date)s. Your new %(billing_schedule)s                   total will be %(recurring_total)s.").format({plan_name:a.scheduledSubState.plan.displayName(),prorated_price:l,date:a.subState.formattedNextBillingDate,billing_schedule:r.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:_.Cash.formatWithTaxLabels(r.nextBillingSummary.total,r.nextBillingSummary)}),{strong:i.createElement("strong",null)})))}return t.purchased&&r.scheduledSubState?i.createElement("div",{className:"evh-modal-footer"},i.createElement("span",{className:"change-summary"},s._("Change summary")),i.createElement("p",null,c.reactFormat(s._("Starting on %(date)s, your plan will be downgraded to Dropbox %(plan_name)s                 <strong>without</strong> extended version history. You will revert to %(days)s day version history.                 Your new %(billing_schedule)s total will be %(scheduled_total)s.").format({date:a.subState.formattedNextBillingDate,plan_name:a.scheduledSubState.plan.displayName(),days:this.isProfessionalPlanScheduled()?"120":"30",billing_schedule:r.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:_.Cash.formatWithTaxLabels(r.nextBillingSummary.total,r.nextBillingSummary)}),{strong:i.createElement("strong",null)}))):i.createElement("p",{className:"evh-modal-footer"},s._("Your Dropbox %(plan_name)s plan will renew on %(date)s.").format({plan_name:a.subState.plan.displayName(),date:a.subState.formattedNextBillingDate})," ",s._("Your current %(billing_schedule)s total is %(total)s.").format({billing_schedule:a.subState.billingSchedule.scheduleDescriptionAdjective,total:a.currentBillingSummary?_.Cash.formatWithTaxLabels(a.currentBillingSummary.total,a.currentBillingSummary):""}))}},t.prototype.showModalClosure=function(e){var t=this;return function(){t.props.transitionPerformed&&t.props.transitionPerformed()}},t.prototype.getModalContent=function(){var e=this.props,t=e.evhInfo,a=e.subStatus,n=e.paymentInfo,r=this.state.isEvhSelected,l=r,c=s._("year");a.subState.billingSchedule&&(c=a.subState.billingSchedule.scheduleDescriptionNoun);var d=o({"evh-modal-toggle-box-price-box__price":!0,"evh-modal-toggle-box-price-box__price--disabled":t.scheduled_to_remove}),h=s._("See all deletion and version history of your files for one year.");return a.subState.addons.peekSkus()&&a.subState.addons.sku.adminCxId===u.AdminCxId.UNLIMITED_PAID_VERSION_HISTORY&&(h=s._("See all deletion and version history of your files for unlimited time.")),i.createElement("div",null,i.createElement(p.CancellableNotificationsView,{subStatus:a,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:m.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:n,displayNewTotal:!1}),i.createElement("div",{className:"evh-modal-toggle-box"},i.createElement("div",{className:"evh-modal-toggle-box__toggle-btn"},i.createElement(g.Checkbox,{checked:l?"checked":"unchecked",onChange:this.toggleEvh,disabled:t.scheduled_to_remove})),i.createElement("div",{className:"evh-modal-toggle-box__desc"},i.createElement("label",{onClick:this.toggleEvh},i.createElement("p",{className:"evh-modal-toggle-box__desc-title"},s._("Extended version history"))),i.createElement("p",{className:"evh-modal-toggle-box__desc-description"},h),i.createElement("a",{className:"evh-modal-toggle-box__desc-link",href:"/help/security/extended-version-history",target:"_blank",rel:"noopener noreferrer"},s._("See EVH details"))),i.createElement("div",{className:"evh-modal-toggle-box-price-box"},i.createElement("p",{className:d},t.evh_price),i.createElement("span",{className:"evh-modal-toggle-box-price-box__price-desc"},s._("per %(schedule_noun)s").format({schedule_noun:c})))),this.renderFooter(),this.renderPaymentMethod())},t.prototype.renderPaymentMethod=function(){var e=this.props.paymentMethod;if(!this.acceptButtonDisabled&&e)return i.createElement("div",{className:"upgrade-payment-method-link"},i.createElement(f.IndividualInlinePaymentMethodView,{paymentMethod:e,showModal:this.showModalClosure(this.props)}))},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.props.evhInfo
;return this.state.isEvhSelected===e.purchased||e.scheduled_to_remove},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.subStatus,a=e.transitionPerformed,n=this.state,r=n.submitting,l=n.isEvhSelected;t&&a&&b.DBModalStack.clear();var o=this.onAccept;return d.ACCOUNT_TAURUS_PLANS&&!l&&(o=this.onAcceptEvhRemovalWarning),i.createElement(S.Modal,{autoClose:!1,acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:s._("Save change"),dismissButtonText:s._("Cancel"),onAccept:o,submitting:r,className:"evh-modal",title:s._("Edit EVH add-on")},this.getModalContent())},t.EvhModalViewModal=l(t,["/static/css/account/pagelet/evh_modal-vfltl8w3-.css"]),t})(i.Component);t.EvhModalView=N}),define("modules/clean/account_page/widgets/plan/views/evh_removal_warning",["require","exports","tslib","modules/clean/ajax","modules/clean/react/css","modules/core/notify","external/react","modules/core/i18n","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/types","modules/clean/react/modal","modules/clean/analytics","modules/clean/payments/skus/constants"],function(e,t,a,n,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){var e=a.props.evhInfo.purchased,t=e?c.PerformPlanTransition.REMOVE_EVH:c.PerformPlanTransition.ADD_EVH;a.setState(function(e){return e.submitting=!0,e}),n.WebRequest({url:"/account/perform_personal_transition",data:{transition_change_type:t},subject_user:s.getCurrentUser().id,success:function(e){r.Notify.success(o._("You’ve changed your plan!")),d.ProEventsLogger.log("de_evh_modal_toggle_evh"),a.props.transitionPerformed&&a.props.transitionPerformed(),u.Modal.close()},error:function(){r.Notify.error(o._("There was an error updating your plan!")),a.setState(function(e){return e.submitting=!1,e})}})},a.state={submitting:!1},a}return a.__extends(t,e),t.showInstance=function(e){u.Modal.showInstance(l.createElement(t.EvhRemovalWarningModalView,a.__assign({},e)))},t.prototype.render=function(){var e=this.props.subStatus,t=this.state.submitting;if(!e||!e.subState.plan)return l.createElement("noscript",null);var a=e.subState.plan.productType===p.ProductPlanType.PROFESSIONAL?"120":"30";return l.createElement(u.Modal,{title:o._("Removing EVH is permanent"),acceptButtonDisabled:this.state.submitting,autoClose:!1,acceptButtonText:o._("Confirm removal"),dismissButtonText:o._("Cancel change"),onAccept:this.onAccept,className:"evh-removal-warning-modal",submitting:t},l.createElement("div",null,l.createElement("p",{className:"evh-removal-warning-modal__desc"},o._("Are you sure you want to remove extended version history? Once you remove it,\n                  you won’t be able to add it back again. Your plan will change from one year of\n                  version history to the Dropbox %(plan)s length of %(days)s days\n                  of version history.").format({plan:e.subState.plan.displayName(!1,!0),days:a}))))},t.EvhRemovalWarningModalView=i(t,["/static/css/account/pagelet/evh_removal_warning-vfloW5p1U.css"]),t})(l.Component);t.EvhRemovalWarningModal=m}),define("modules/clean/account_page/widgets/plan/views/individual_inline_payment_method",["require","exports","tslib","modules/clean/payments/billing_info_modal","modules/clean/dbmodal_stack","modules/clean/deprecated/dbmodal_loading","external/react","modules/core/i18n","modules/clean/react_format","modules/clean/account_page/widgets/billing/payment_method_constants","modules/constants/account_page","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/react/modal"],function(e,t,a,n,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateBillingInfo=function(e){var a=t.props.showModal;e.stopPropagation(),e.preventDefault(),p.Modal.close(),i.DBModalStack.register(n.BILLING_INFO_UPDATED,function(){a&&a()}),u.INDIVIDUAL_UPDATE_BILLING_MODAL_REFACTOR?d.IndividualUpdateBillingModalLoader.showInstance():i.DBModalStack.push(new r({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{}}))},t}return a.__extends(t,e),t.prototype.renderCreditCard=function(){var e=this.props.paymentMethod;if(e){var t=e.account_short.slice(-4),a=o._("We’ll charge your card ending in %(last4)s.").format({last4:t});return l.createElement("span",null,a," ",this.renderUpdateLink())}return l.createElement("span",null)},t.prototype.renderDirectDebit=function(){var e=this.props.paymentMethod;if(e){var t=e.account_short.slice(-4),a=o._("We’ll charge your IBAN ending in %(last4)s.").format({last4:t});return l.createElement("span",null,a," ",this.renderUpdateLink())}return l.createElement("span",null)},t.prototype.renderPaypal=function(){return l.createElement("span",null,o._("We’ll charge your PayPal account.")," ",this.renderUpdateLink())},t.prototype.renderUpdateLink=function(){return s.reactFormat(o._("<a>Update billing information</a>"),{a:l.createElement("a",{key:"updateBillingInfo",href:"#",onClick:this.updateBillingInfo})})},t.prototype.render=function(){var e=this.props.paymentMethod;if(!e)return l.createElement("span",null);switch(e.gateway_id){case c.BRAINTREE:return this.renderCreditCard();case c.ADYEN_SEPA_GATEWAY:return this.renderDirectDebit();case c.PAYPAL:case c.PAYPAL_REFERENCE_TRANSACTION:return this.renderPaypal();default:return l.createElement("span",null)}},t})(l.Component);t.IndividualInlinePaymentMethodView=m}),define("modules/clean/account_page/widgets/plan/views/plan_container",["require","exports","tslib","modules/clean/payments/billing_info_modal","external/react","external/react-redux","modules/clean/react/css","modules/clean/web_timing_logger","modules/clean/account_page/util","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/plan/views/add_ons","modules/clean/account_page/widgets/plan/views/upsell_module","modules/clean/account_page/widgets/plan/views/cancel_plan","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/action_creators","modules/clean/account_page/widgets/billing/action_creators","modules/clean/account_page/widgets/plan/add_ons/action_creators","modules/clean/account_page/widgets/plan/plan_spectrum/action_creators","modules/clean/account_page/widgets/plan/referral_history/action_creators","modules/clean/account_page/widgets/plan/views/plan_status","modules/clean/account_page/widgets/plan/views/plan_spectrum","modules/clean/payments/skus/constants","modules/clean/account_page/widgets/plan/views/quota_usage","modules/clean/account_page/components/loading","modules/clean/account_page/widgets/plan/views/referral_space","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/analytics","modules/clean/payments/skus/subscription_status","modules/clean/stormcrow/experiment","modules/constants/trademark","modules/core/i18n"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N,I,x,L,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var A=function(e){return{evhInfo:e.planTab.evhInfo,evhLoadingState:e.planTab.evhLoadingState,planInfo:e.planTab.planInfo,planSpectrumInfo:e.planTab.planSpectrumInfo,planSpectrumLoadingState:e.planTab.planSpectrumLoadingState,loadingState:e.planTab.loadingState,referralHistory:e.planTab.referralHistory,referralLoadingState:e.planTab.referralLoadingState,dataLoadedForTTI:"ready"===e.planTab.evhLoadingState&&"ready"===e.planTab.loadingState&&"ready"===e.planTab.referralLoadingState}},D=function(e){return{loadPlanInfo:function(t){return e(_.loadDataIfNecessary(t))},loadEvhInfo:function(t){return e(f.loadEvhInfoIfNecessary(t))},loadReferralHistory:function(t,a){return void 0===t&&(t=!1),void 0===a&&(a=0),e(y.loadReferralHistoryIfNecessary(t,a))},forceLoadBillingTab:function(t){return e(g.loadDataIfNecessary(t))},loadPlanSpectrum:function(t){return e(b.loadPlanSpectrum(t))}}},M=(function(e){function t(t){var a=e.call(this,t)||this;return a.forceReload=function(){var e=a.props,t=e.loadEvhInfo,n=e.loadPlanInfo,i=e.forceLoadBillingTab,r=e.loadPlanSpectrum;t(!0),n(!0),i(!0),r(!0)},h.DBModalStack.register(n.BILLING_INFO_UPDATED,function(){N.ProEventsLogger.log("de_payment_modal_save_click"),a.props.loadPlanInfo(!0),a.props.forceLoadBillingTab(!0)}),a}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.props.loadPlanInfo(),this.props.loadReferralHistory(),this.props.loadEvhInfo(),this.props.loadPlanSpectrum(),this.checkTTIstate(),N.ProEventsLogger.log("de_plan_tab_view")},t.prototype.componentDidUpdate=function(){this.checkTTIstate()},t.prototype.checkTTIstate=function(){this.props.dataLoadedForTTI&&(o.mark_time_to_view(),o.mark_time_to_interactive())},Object.defineProperty(t.prototype,"isPersonalUser",{get:function(){return"personal"===s.getCurrentUser().role},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBusinessUser",{get:function(){return!this.isPersonalUser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLicensePlan",{get:function(){var e=this.props.planInfo;if(!e)return!1;var t=e.paymentInfo;return t&&c.isLicenseKey(t.gateway_id)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasLicenseKey",{get:function(){var e=this.props.planInfo;return!!e&&e.hasLicenseKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLimitedTeam",{get:function(){return this.props.planInfo.isLimitedTeam},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatus",{get:function(){var e=this.props.planInfo.serializedSubStatus;if(e)return I.SubscriptionStatus.deserialize(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExternallyBilled",{get:function(){return void 0===this.subStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlusTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&(this.subStatus.subState.plan.productType===E.ProductPlanType.TRIAL||this.subStatus.subState.plan.productType===E.ProductPlanType.PLUS_TRIAL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&this.subStatus.subState.plan.productType===E.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expSubgrowthBizWebClientUpsell",{get:function(){return x.Experiment(this.props.planInfo.expSubgrowthBizWebClientUpsell)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expUjPlanSpectrumUpsell",{get:function(){return x.Experiment(this.props.planSpectrumInfo.variant)},enumerable:!0,configurable:!0}),t.prototype.isLoading=function(){return"ready"!==this.props.loadingState},t.prototype.renderAddOnsIfAvailable=function(){var e=this.props,t=e.evhInfo,a=e.evhLoadingState,n=e.planInfo,r=this.props.planInfo,l=r.paymentMethod,o=r.paymentInfo;if(!this.isLicensePlan&&t.is_available&&this.subStatus&&this.subStatus.subState.plan&&this.subStatus.subState.plan.productType!==E.ProductPlanType.FREE&&(this.isPersonalUser||this.isLimitedTeam))return i.createElement(u.AddOns,{subStatus:this.subStatus,scheduledForDowngrade:n.scheduledForDowngrade,evhInfo:t,evhLoadingState:a,paymentInfo:o,paymentMethod:l,transitionPerformed:this.forceReload})},t.prototype.renderUsageBreakdown=function(){var e=this.props.planInfo,t=e.isMSLTeamMember,a=e.isMSLUserOn,n=e.usageBreakdown,r=e.isTeamAdmin;if(!t||a)return i.createElement(P.QuotaUsage,{subStatus:this.subStatus,usageBreakdown:n,isPersonalUser:this.isPersonalUser,isLimitedTeam:this.isLimitedTeam,isMSLTeamMember:t,isTeamAdmin:r})},t.prototype.renderTotalTeamUsageBreakdown=function(){var e=this.props.planInfo.teamUsageBreakdown;if(e)return i.createElement(P.QuotaUsage,{subStatus:this.subStatus,usageBreakdown:e,isPersonalUser:!1,isLimitedTeam:!1,isMSLTeamMember:!1})},t.prototype.renderUpsell=function(){var e,t,a,n=this.props.planInfo,r=n.bizQuota,l=n.bizTrialDays,o=n.ncctVariant,s=n.ncctVariantCoalesced,c=n.serializedSubStatus,u=n.paymentInfo;if(x.Experiment(o).variantIn("V10","V11","V12")&&!u)e=k._("Want to keep using Dropbox with your team?"),t=k._("Add your billing information so you don’t have to later. You’ll still get the         remaining days in your trial for free, and you won’t be charged until %(trial_end_date)s         after your free trial ends.").format({trial_end_date:c.scheduledSubState.formattedNextBillingDate}),a={text:k._("Keep %(trademark_business)s").format({trademark_business:L.TRADEMARK_BUSINESS}),link:"/business/billing"};else{if(!this.expSubgrowthBizWebClientUpsell.variantIn("V1","V2"))return null;e=k._("Interested in Dropbox for your team?"),t=k._("With %(trademark_business)s, get %(plan_size)s or more for your team to securely share,         sync, and collaborate. Enjoy advanced data protection, admin controls, and dedicated support.").format({trademark_business:L.TRADEMARK_BUSINESS,plan_size:r});a={text:x.Experiment(s).variantIs("V12")?k._("Try it free"):k._("Try free for %(trial_days)s days").format({trial_days:l}),link:"/business/try"}}return i.createElement(d.UpsellModule,{headline:e,text:t,cta:a})},t.prototype.render=function(){var e=this.props,t=e.evhInfo,a=e.planSpectrumInfo,n=this.props.planInfo,r=n.usageBreakdown,l=n.referralInfo,o=n.scheduledForDowngrade,u=n.paymentInfo,d=n.eligibleFor1tb,h=n.teamScheduledForDowngrade,_=n.isTeamAdmin,g=n.hasLicenseKey,f=n.hasUnusedLicenseKey,b=this.subStatus;if(this.isLoading())return i.createElement(C.Loading,null);var y=void 0;this.isExternallyBilled||o||this.isProfessionalTrialPlan||!this.isPersonalUser&&!this.isLimitedTeam||!u||c.shouldHideBillingChange(u.gateway_id,u.is_external_billing)||(y=i.createElement(p.CancelPlan,{usageBreakdown:r,subStatus:b,eligibleFor1tb:d}));var E,P=this.isBusinessUser&&!this.isLimitedTeam?void 0:i.createElement(w.ReferralSpace,{referralInfo:l,referralHistory:this.props.referralHistory,referralLoadingState:this.props.referralLoadingState}),N=this.isProfessionalTrialPlan?m.CancellationType.SCHEDULE:m.CancellationType.ALL;this.isExternallyBilled||this.isLicensePlan||this.isPlusTrialPlan||!this.isPersonalUser&&!this.isLimitedTeam||this.hasLicenseKey||(E=i.createElement(T.CancellableNotificationsView,{paymentInfo:u,subStatus:b,scheduledForDowngrade:o,transitionPerformed:this.forceReload,displaySingleChangeCancellationItem:N,reOpenModalDialogAfterCancellation:!1,displayNewTotal:!0}));var I=i.createElement(S.PlanStatus,{subStatus:b,scheduledForDowngrade:o,teamScheduledForDowngrade:h,showTeamScheduledForDowngrade:!1,evhInfo:t,onUpdate:this.forceReload,isPersonalUser:this.isPersonalUser,isLimitedTeam:this.isLimitedTeam,isExternallyBilled:this.isExternallyBilled,paymentInfo:u,isTeamAdmin:_,hasLicenseKey:g,hasUnusedLicenseKey:f,usageBreakdown:r,eligibleFor1tb:d,showCancelButton:!1,showChangeBillingPeriod:!0,isLoggedInUser:!0,isLoggedInAsTransactionOwner:!0,useSpecifiedRole:!1,planSpectrumVariant:a.variant});return i.createElement("div",{className:"account-plan-tab"},E,this.renderUpsell(),!this.expSubgrowthBizWebClientUpsell.variantIn("V1","V2","CONTROL")&&this.expUjPlanSpectrumUpsell.variantIs("ON")&&i.createElement(v.PlanSpectrum,{subStatus:b,user:s.getCurrentUser()}),this.expSubgrowthBizWebClientUpsell.variantIs("V2")?this.renderUsageBreakdown():I,this.renderAddOnsIfAvailable(),this.expSubgrowthBizWebClientUpsell.variantIs("V2")?I:this.renderUsageBreakdown(),this.renderTotalTeamUsageBreakdown(),P,y)},t})(i.Component);t.PlanContainerComponent=M;var B=r.connect(A,D)(M);t.PlanContainer=l(B,["/static/css/account/pagelet/plan_tab-vflaTDaRT.css"])}),define("modules/clean/account_page/widgets/plan/views/plan_spectrum",["require","exports","tslib","external/classnames","modules/clean/react/css","external/react","modules/core/browser","modules/core/i18n","modules/clean/static_urls","modules/constants/trademark","modules/clean/payments/skus/constants","modules/clean/account_page/widgets/plan/plan_spectrum/types"],function(e,t,a,n,i,r,l,o,s,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=[u.ProductPlanType.PROFESSIONAL,u.ProductPlanType.PROFESSIONAL_TRIAL],m=(_={},_[d.PlanType.Basic]={name:o._("Dropbox Basic"),image:"/static/images/growth/experiments/plan_spectrum/PlanIcons_Basic@2x-vflm-gFks.svg",faded:[d.PlanType.Plus,d.PlanType.Professional],caption:(g={},g[d.PlanType.Basic]={text:o._("Current plan")},g[d.PlanType.Plus]={text:o._("2 GB")},g[d.PlanType.Professional]={text:o._("2 GB")},g)},_[d.PlanType.Plus]={name:o._("Dropbox %(trademark_plus)s").format({trademark_plus:c.TRADEMARK_PLUS}),image:"/static/images/growth/experiments/plan_spectrum/PlanIcons_Plus@2x-vflCexdkY.svg",faded:[d.PlanType.Professional],caption:(f={},f[d.PlanType.Basic]={text:o._("Learn more"),link:"/plus?oqa=pspl",action:d.PlanSpectrumActions.BasicPlusClick},f[d.PlanType.Plus]={text:o._("Current plan")},f[d.PlanType.Professional]={text:o._("1 TB")},f)},_[d.PlanType.Professional]={name:o._("Dropbox Professional"),image:"/static/images/growth/experiments/plan_spectrum/PlanIcons_Professional@2x-vflUScX9j.svg",faded:[],caption:(b={},b[d.PlanType.Basic]={text:o._("Learn more"),link:"/pro?oqa=pspl",action:d.PlanSpectrumActions.BasicProClick},b[d.PlanType.Plus]={text:o._("Learn more"),link:"/pro?oqa=pspl",action:d.PlanSpectrumActions.PlusProClick},b[d.PlanType.Professional]={text:o._("Current plan")},b)},_),h=(function(e){function i(){var a=null!==e&&e.apply(this,arguments)||this;return a.logAction=function(e){return function(t){t.preventDefault(),a.tracker.track(e),l.open_tab(t.currentTarget.href)}},a.renderColumn=function(e){var i=m[e],l=a.state.planType,o=i.caption[l],c=n((u={},u[t.styles.column]=!0,u[t.styles.faded]=i.faded.indexOf(l)!==-1,u[t.styles.selected]=l===e,u));return r.createElement("div",{className:c,key:"column-"+e},r.createElement("img",{src:s.static_url(i.image),className:"illo",alt:""}),r.createElement("div",{className:t.styles.heading},i.name),o.link?r.createElement("a",{href:o.link,className:t.styles.captionLink,onClick:a.logAction(o.action)},o.text):r.createElement("div",{className:t.styles.caption},o.text));var u},a}return a.__extends(i,e),i.prototype.componentWillMount=function(){var e=this.props,t=e.subStatus,a=e.user,n=d.PlanType.Basic;t&&t.subState&&t.subState.plan&&(t.subState.plan.productFamily===u.ProductFamily.PRO?n=d.PlanType.Plus:p.indexOf(t.subState.plan.productType)!==-1&&(n=d.PlanType.Professional)),this.tracker=new d.PlanSpectrumTracker(a.id),this.setState({planType:n})},i.prototype.componentDidMount=function(){this.state.planType===d.PlanType.Basic?this.tracker.track(d.PlanSpectrumActions.BasicView):this.state.planType===d.PlanType.Plus&&this.tracker.track(d.PlanSpectrumActions.PlusView)},i.prototype.render=function(){var e=this.state.planType,a=[d.PlanType.Basic,d.PlanType.Plus,d.PlanType.Professional];return r.createElement("div",{className:t.styles.base},r.createElement("div",{className:t.styles.header},o._("Dropbox plans")),r.createElement("div",{className:t.styles.columns},a.map(this.renderColumn)),r.createElement("div",{className:t.styles.barWrapper},r.createElement("hr",{className:t.styles.bar}),r.createElement("div",{className:t.styles.barIcons},a.map(function(a){var i=n(t.styles.icon,(l={},l[t.styles.iconSelected]=a===e,l));return r.createElement("div",{className:i,key:"bar-"+a});var l}))))},i})(r.Component);t.PlanSpectrumComponent=h,t.styles={base:"plan-spectrum",header:"plan-spectrum__header",columns:"plan-spectrum__columns",column:"plan-spectrum__column",heading:"plan-spectrum__heading",caption:"plan-spectrum__caption",captionLink:"plan-spectrum__caption-link",faded:"plan-spectrum__column--faded",selected:"plan-spectrum__column--selected",plan:"plan-spectrum__plan",barWrapper:"plan-spectrum__bar-wrapper",bar:"plan-spectrum__bar",barIcons:"plan-spectrum__bar-icons",icon:"plan-spectrum__icon",iconSelected:"plan-spectrum__icon--selected"},t.PlanSpectrum=i(h,["/static/css/account/pagelet/plan_spectrum-vflhJiQUh.css"]);var _,g,f,b}),define("modules/clean/account_page/widgets/plan/views/plan_status",["require","exports","tslib","modules/core/browser","modules/clean/deprecated/dbmodal_loading","external/react","modules/clean/viewer","modules/core/uri","modules/core/i18n","modules/core/exception","modules/constants/account_page","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/billing/payment_method_constants","modules/clean/account_page/util","modules/clean/static_urls","modules/clean/payments/cash","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/account_page/widgets/plan/views/change_schedule_modal","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/constants/account_page","modules/clean/payments/skus/constants","modules/clean/analytics","modules/clean/account_page/widgets/plan/plan_spectrum/types","modules/clean/react_format","modules/constants/trademark"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I;(function(e){e[e.Cancel=0]="Cancel",e[e.Change=1]="Change",e[e.Manage=2]="Manage",e[e.Upgrade=3]="Upgrade"})(I||(I={}));var x=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOverQuota=function(){return t.usage>t.quota},t.logSeePlanDetails=function(){C.ProEventsLogger.log("de_plan_tab_details_click")},t.cancelPlanClick=function(){t.props.isPersonalUser?n.redirect("/downgrade"):n.redirect("/team/cancel")},t.onChangeBillingPeriodClick=function(e){if(e.preventDefault(),E.NO_RESET_INTERVAL_FOR_USERS&&E.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return void v.DisableStackedTransitionsModal.showInstance();var a=t.props,n=a.scheduledForDowngrade,i=a.paymentInfo;n?y.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.onUpdate,subStatus:t.props.subStatus}):(b.ChangeScheduleModalView.showInstance({transitionPerformed:t.props.onUpdate,paymentInfo:i}),C.ProEventsLogger.log("de_plan_tab_change_billing_open_modal"))},t.onUpdateBillingClick=function(e){e.preventDefault(),d.IndividualUpdateBillingModalLoader.showInstance()},t.redirectToUpgrade=function(){C.ProEventsLogger.log("de_plan_tab_upgrade_to_plus_click");var e=t.isOverQuota()?"acc_plan_upgrade_overquota_btn":"acc_plan_upgrade",a=new o.URI({path:"/upgrade",query:{oqa:e}}).toString();if("ON"===t.props.planSpectrumVariant){var i=h.getCurrentUser(),r=new w.PlanSpectrumTracker(i.id);a=new o.URI({path:"/upgrade",query:{oqa:"pspl"}}).toString(),r.track(w.PlanSpectrumActions.BasicUpgradeClick).then(function(){n.redirect(a)})}else n.redirect(a)},t.purchaseNowClick=function(){C.ProEventsLogger.log("de_plan_tab_purchase_now_click"),n.redirect("/pro/convert")},t.cancelTrialClick=function(){C.ProEventsLogger.log("de_plan_tab_cancel_trial_click"),n.redirect("/downgrade")},t.contactSupportClick=function(){C.ProEventsLogger.log("de_plan_tab_contact_support_click"),n.redirect("/support")},t.addPaymentClick=function(){C.ProEventsLogger.log("de_plan_tab_add_payment_method_click"),S.DBModalStack.push(new i({element_id:"add_billing_info",endpoint_url:"/add_billing_info_modal",html_in_error_msg:!0}))},t.openChangePlanModal=function(e){if(e&&e.preventDefault(),t.props.isLoggedInUser||(t.props.isPersonalUser?n.redirect("/account/plan"):n.redirect("/team/admin/billing/manage")),E.NO_RESET_INTERVAL_FOR_USERS&&E.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return void v.DisableStackedTransitionsModal.showInstance();var a=t.props,i=a.scheduledForDowngrade,r=a.paymentInfo,l=a.planSpectrumVariant;if(i)y.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.onUpdate,subStatus:t.props.subStatus,userIdOverride:t.getUserForModal()});else if(f.ChangePlanModalView.showInstance({transitionPerformed:t.props.onUpdate,paymentInfo:r,userIdOverride:t.getUserForModal()}),C.ProEventsLogger.log("de_plan_tab_change_plan_open_modal"),"ON"===l&&t.isPlusPlan()){var o=h.getCurrentUser(),s=new w.PlanSpectrumTracker(o.id);s.track(w.PlanSpectrumActions.PlusChangePlanClick)}},t.renderContactSupportLink=function(){return r.createElement("div",{className:"plan-status-section__contact_support_link"},r.createElement("a",{href:"#",onClick:t.contactSupportClick},s._("Contact support to change plan")))},t.renderBillingPeriod=function(){var e=t.props,a=e.paymentInfo,n=e.scheduledForDowngrade,i=e.hasUnusedLicenseKey;if(a&&t.props.showChangeBillingPeriod&&!i){var l=a.gateway_id,o=a.is_external_billing,c=a.end_date,u=a.deactivated,d=a.is_on_trial,m=a.reseller_name,h=a.reseller_link;if(!a.schedule_switchable&&!n&&!t.isProfessionalTrial()||p.shouldHideBillingChange(l,o)){var _=p.getBillingDisabledMessage({gatewayId:l,isExternalBilling:o,resellerName:m,resellerLink:h,dropboxPlan:N.TRADEMARK_PLUS,endDate:c,deactivated:u,isOnTrial:d});return r.createElement("span",{className:"plan-status-section__message"},_)}if(!t.isPlusTrial())return a.is_in_grace_period?r.createElement("a",{href:"#",className:"plan-status-section__link",onClick:t.onUpdateBillingClick},s._("Please update your billing information")):r.createElement("a",{href:"#",className:"plan-status-section__link",onClick:t.onChangeBillingPeriodClick},s._("Change billing period"))}},t.changePlanClick=function(){t.props.subStatus.subState.plan.isEnterprise?n.redirect("/team/admin/help?role=work"):n.redirect("/team/admin/billing/manage?show_switch_plan")},t.managePlanClick=function(){n.redirect("/team/admin/billing/manage")},t.createTrialCtaButtons=function(e,a){return void 0===e&&(e=!0),void 0===a&&(a=!1),a?r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"mc-button mc-button-secondary cancel-button",onClick:t.cancelTrialClick},s._("Cancel trial"))):e?r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"button-primary purchase-button",onClick:t.purchaseNowClick},s._("Purchase Now")),r.createElement("button",{className:"mc-button mc-button-secondary cancel-button",onClick:t.cancelTrialClick},s._("Cancel trial"))):r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"button-primary purchase-button",onClick:t.purchaseNowClick},s._("Purchase Now")))},t}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=n.get_href().match(/modal=([a-zA-Z_]*)/);if(e&&e.length>1){"plan"===e[1]&&this.isChangePlanSupported()&&this.openChangePlanModal()}},t.prototype.isChangePlanSupported=function(){var e=this.props,t=e.subStatus,a=e.eligibleFor1tb,n=e.isExternallyBilled,i=e.paymentInfo;return!!this.isInStandardSchedule()&&(!a&&(!!(i&&t&&t.subState.plan)&&(!p.shouldHideBillingChange(i.gateway_id,n)&&(this.isPlusPlan()||t.subState.plan.productType===P.ProductPlanType.PROFESSIONAL))))},Object.defineProperty(t.prototype,"usage",{get:function(){return this.props.usageBreakdown.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"plansURL",{get:function(){var e=this.props,t=e.isLoggedInUser,a=e.isTransactionInformationPage,n={oqa:"acc_plan_upgrade"};return a&&!t&&(n.trigger="nr"),new o.URI({path:"/plans/individual",query:n}).toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evhDisplayName",{get:function(){var e=this.props.evhInfo;return e.purchased?e.is_unlimited_evh?s._("unlimited version history"):s._("extended version history"):""},enumerable:!0,configurable:!0}),t.prototype.renderCancelPlanButton=function(){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(I.Cancel):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"mc-button-secondary",onClick:this.cancelPlanClick},s._("Cancel plan")))},t.prototype.isPlusPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===P.ProductPlanType.STANDARD||e.subState.plan.productType===P.ProductPlanType.PLUS)},t.prototype.isProfessionalPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===P.ProductPlanType.PROFESSIONAL||e.subState.plan.productType===P.ProductPlanType.PROFESSIONAL_TRIAL)},t.prototype.isFreePlusPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===P.ProductPlanType.FREE},t.prototype.isInStandardSchedule=function(){var e=this.props.subStatus;if(e&&e.subState&&e.subState.billingSchedule){var t=e.subState.billingSchedule.id;return t===P.ScheduleId.MONTHLY||t===P.ScheduleId.YEARLY}return!1},t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isTaurusPlan=function(){var e=this.props.subStatus;if(e&&e.subState.plan){var t=e.subState.plan.productType;return t===P.ProductPlanType.PLUS||t===P.ProductPlanType.PLUS_TRIAL||t===P.ProductPlanType.PROFESSIONAL||t===P.ProductPlanType.PROFESSIONAL_TRIAL||t===P.ProductPlanType.PLUS_WITH_SS||t===P.ProductPlanType.PLUS_WITH_SS_TRIAL}return!1},t.prototype.isPlanScheduledToChange=function(){var e=this.props,t=e.subStatus;return!!e.scheduledForDowngrade||!!(t&&t.subState.plan&&t.finalSubState.plan)&&t.subState.plan.productType!==t.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.shouldDisplayChangePlan=function(){var e=this.getGatewayId();return e!==m.NOT_APPLICABLE&&!p.shouldHidePaymentMethod(e)&&!this.props.hasUnusedLicenseKey},t.prototype.getGatewayId=function(){var e=this.props.paymentInfo;return e?e.gateway_id:m.NOT_APPLICABLE},t.prototype.isTrialPlan=function(){return this.isPlusTrial()||this.isProfessionalTrial()},t.prototype.isPlusTrial=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===P.ProductPlanType.TRIAL||e.subState.plan.productType===P.ProductPlanType.PLUS_TRIAL)},t.prototype.isProfessionalTrial=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===P.ProductPlanType.PROFESSIONAL_TRIAL},t.prototype.isLicensePlan=function(){var e=this.props,t=e.hasLicenseKey,a=e.paymentInfo;return!!a&&(t||p.isLicenseKey(a.gateway_id))},t.prototype.renderLoginInstructions=function(e){var t,a;return a=this.props.userEmail?this.props.userEmail:s._("the account user"),t=e===I.Cancel?T.reactFormat(s._("Please login as %(email)s<br />to cancel your plan."),{br:r.createElement("br",null),email:a}):e===I.Change?T.reactFormat(s._("Please login as %(email)s<br />to change your plan."),{br:r.createElement("br",null),email:a}):e===I.Manage?T.reactFormat(s._("Please login as %(email)s<br />to manage your plan."),{br:r.createElement("br",null),email:a}):e===I.Upgrade?T.reactFormat(s._("Please login as %(email)s<br />to upgrade your plan."),{br:r.createElement("br",null),email:a}):T.reactFormat(s._("Please login as %(email)s."),{email:a}),
r.createElement("div",{className:"plan-status-section__login-msg"},t)},t.prototype.getUserForModal=function(){var e=this.props,t=e.isPersonalUser,a=e.useSpecifiedRole,n=e.isLoggedInAsTransactionOwner,i=null;if(a&&n){var r=l.Viewer.get_viewer();i=t?r.personal_user?r.personal_user.id:null:r.work_user?r.work_user.id:null,c.assert(null!=i,"Could not find user for specified role; modal will fail")}return i},t.prototype.renderDropboxLogo=function(){return r.createElement("div",{className:"plan-status-section__icon u-mar-right-s"},r.createElement("img",{src:_.static_url("/static/images/logo_catalog/dropbox-business-icon_m1-vflczuza3.svg"),alt:""}))},t.prototype.getTeamName=function(){return this.props.isLoggedInAsTransactionOwner&&l.Viewer.get_viewer().team_name?l.Viewer.get_viewer().team_name:this.props.teamName?this.props.teamName:null},t.prototype.renderChangePlanButton=function(e){var t=this.props.paymentInfo;return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(I.Change):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-primary",onClick:e,disabled:t&&t.is_in_grace_period},s._("Change plan")))},t.prototype.renderManagePlanButton=function(){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(I.Manage):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-tertiary",onClick:this.managePlanClick},s._("Manage plan")))},t.prototype.renderBusinessPlanSection=function(){var e=this.props,t=e.subStatus,a=e.isTeamAdmin,n=e.teamScheduledForDowngrade,i=e.showCancelButton;if(t&&t.subState.isDeactivatedTeam)return this.renderBasicPlanSection();if(t&&t.subState.plan){var l=t.subState.plan.productType===P.ProductPlanType.STANDARD,o=t.subState.plan.displayName(!1,l);l||(o=s._("%(trade_mark)s %(plan_title)s").format({trade_mark:N.TRADEMARK_BUSINESS,plan_title:o}));var c="",u=this.getTeamName();u&&(a?(c=s._("You’re an admin of the %(team_name)s Dropbox account.").format({team_name:u}),this.props.isLoggedInAsTransactionOwner||(c=s._("This account is an admin of the %(team_name)s Dropbox account.").format({team_name:u}))):(c=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:u}),this.props.isLoggedInAsTransactionOwner||(c=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:u}))));var d,p;if(this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner)d=this.renderLoginInstructions(),p=null;else if(a||!this.props.isLoggedInUser){var m=t.subState.plan.productType;if(m===P.ProductPlanType.STANDARD||m===P.ProductPlanType.NEW_STANDARD||m===P.ProductPlanType.STANDARD_TRIAL?d=this.renderChangePlanButton(this.changePlanClick):m!==P.ProductPlanType.ADVANCED&&m!==P.ProductPlanType.ADVANCED_TRIAL||(d=this.renderManagePlanButton()),i&&(d=n?this.renderManagePlanButton():this.renderCancelPlanButton()),!t.subState.plan.isEnterprise){var h=s._("Manage your team in the Admin Console");this.props.isLoggedInAsTransactionOwner||(h=s._("Manage this team in the Admin Console")),p=r.createElement("p",null,r.createElement("a",{className:"plan-status-section__link",href:"/team/admin/billing/manage"},h))}}var _="";return this.props.showTeamScheduledForDowngrade&&n&&(_=s._("Any active members of your %(plan)s team will be downgraded to Dropbox Basic accounts         on %(date)s.").format({plan:o,date:t.formattedNextBillingDate}),this.props.isLoggedInAsTransactionOwner||(_=s._("Any active members of the %(plan)s team will be downgraded to Dropbox Basic accounts         on %(date)s.").format({plan:o,date:t.formattedNextBillingDate}))),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},o),r.createElement("span",null,c),r.createElement("br",null),r.createElement("span",null,_),p),d)}},t.prototype.renderUpgradePlanButton=function(e){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(I.Upgrade):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-primary",onClick:this.redirectToUpgrade},e))},t.prototype.renderBasicPlanSection=function(){var e=this.props,t=e.subStatus,a=e.isLimitedTeam,n=s._("Dropbox Basic");if(t){t.subState.plan&&(n=t.subState.plan.displayName());var i=void 0;if(a||t.subState.isDeactivatedTeam){var l=this.getTeamName(),o=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:l});this.props.isLoggedInAsTransactionOwner||(o=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:l})),i=r.createElement("p",{className:"plan-status-section__team_desc"},o)}var c=this.isOverQuota()?s._("Upgrade now"):s._("Upgrade");return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},n),i,r.createElement("a",{className:"plan-status-section__link",href:this.plansURL,target:"_blank",rel:"noopener noreferrer"},s._("See other plans"))),this.renderUpgradePlanButton(c))}},t.prototype.renderResellerPlan=function(){var e=s._("Dropbox %(plus)s 1TB").format({plus:N.TRADEMARK_PLUS});return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},e),r.createElement("p",{className:"plan-status-section__title_description"},this.renderBillingPeriod())))},t.prototype.renderPaidPlanSection=function(){var e=this.props,t=e.subStatus,a=e.evhInfo,n=e.isLimitedTeam,i=e.hasUnusedLicenseKey,l=e.paymentInfo,o=e.scheduledForDowngrade;if(t&&t.scheduledSubState&&t.subState.plan){var c,d=t.subState.plan;if(1024===d.specQuotaGb){var m=t.subState.plan.displayName(!1);c=a.purchased?s._("Dropbox %(plus)s + %(evh)s").format({plus:m,evh:this.evhDisplayName,comment:"evh = Extended Version History"}):s._("Dropbox %(plus)s").format({plus:m})}else c=t.subState.plan.displayName(!0),a.purchased&&(c=s._("%(plus)s + %(evh)s").format({plus:c,evh:this.evhDisplayName,comment:"evh = Extended Version History"}));var h,_=void 0,f=void 0;if(l&&p.shouldHideBillingSummary(l.gateway_id,t.subState.plan.productType)?h="":t.currentBillingSummary&&t.subState.billingSchedule&&(h=s._("%(total)s per %(period)s.").format({total:g.Cash.formatWithTaxLabels(t.currentBillingSummary.total,t.currentBillingSummary),period:t.subState.billingSchedule.scheduleDescriptionNoun})),i&&(h=s._("Your license key will be activated and no         charge made to your payment method on file."),this.props.isLoggedInAsTransactionOwner||(h=s._("This account’s license key will be activated and no         charge made to the payment method on file."))),l&&!p.shouldHideBillingChange(l.gateway_id,l.is_external_billing)){var b="";if(this.pendingScheduledChange()&&t.scheduledSubState&&t.scheduledSubState.plan&&t.scheduledSubState.billingSchedule){var y=t.scheduledSubState.plan,S=void 0;if(1024===y.specQuotaGb){var m=t.scheduledSubState.plan.displayName(!1);S=a.purchased&&!a.scheduled_to_remove?s._("Dropbox %(plus)s + %(evh)s").format({plus:m,evh:this.evhDisplayName,comment:"evh = Extended Version History"}):s._("Dropbox %(plus)s").format({plus:m})}else S=t.scheduledSubState.plan.displayName(!0),a.purchased&&!a.scheduled_to_remove&&(S=s._("%(plus)s + %(evh)s").format({plus:S,evh:this.evhDisplayName,comment:"evh = Extended Version History"}));b=s._("Starting on %(date)s, we’ll bill you once a %(new_period_noun)s for your           %(plan)s plan. Your new %(new_period_adj)s total will be %(new_amount)s.").format({date:t.formattedNextBillingDate,new_period_noun:t.scheduledSubState.billingSchedule.scheduleDescriptionNoun,plan:S,new_period_adj:t.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,new_amount:g.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),this.props.isLoggedInAsTransactionOwner||(b=s._("Starting on %(date)s, we’ll bill this account once a %(new_period_noun)s for           the %(plan)s plan. This account’s new %(new_period_adj)s total will be           %(new_amount)s.").format({date:t.formattedNextBillingDate,new_period_noun:t.scheduledSubState.billingSchedule.scheduleDescriptionNoun,plan:S,new_period_adj:t.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,new_amount:g.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}))}else b=s._("Your %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:c,date:t.formattedNextBillingDate,billing_summary:h}),this.props.isLoggedInAsTransactionOwner||(b=s._("This account’s %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:c,date:t.formattedNextBillingDate,billing_summary:h}));_=r.createElement("span",null,b," ")}if(o){var v=s._("Your %(plan)s will downgrade to Dropbox Basic on         %(date)s.").format({plan:c,date:t.formattedNextBillingDate});this.props.isLoggedInAsTransactionOwner||(v=s._("This account’s %(plan)s will downgrade to Dropbox         Basic on %(date)s.").format({plan:c,date:t.formattedNextBillingDate})),_=r.createElement("span",null,v," ")}if(n){var E=this.getTeamName(),P=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:E});this.props.isLoggedInAsTransactionOwner||(P=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:E})),f=r.createElement("p",{className:"plan-status-section__team_desc"},P)}var C;return!l||p.shouldHideBillingChange(l.gateway_id,l.is_external_billing)||this.isInStandardSchedule()||(C=this.renderContactSupportLink()),u.ACCOUNT_TAURUS_PLANS&&this.shouldDisplayChangePlan()&&this.isInStandardSchedule()&&(this.isPlusPlan()&&!this.isTrialPlan()&&(C=this.renderChangePlanButton(this.openChangePlanModal)),this.isProfessionalPlan()&&!this.isTrialPlan()&&(C=this.renderChangePlanButton(this.openChangePlanModal))),this.props.showCancelButton&&!o&&(C=this.renderCancelPlanButton()),(this.isFreePlusPlan()||i)&&(C=this.renderContactSupportLink()),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},c),f,r.createElement("p",{className:"plan-status-section__title_description"},_,!i&&this.renderPlanDetails(),r.createElement("br",null),this.renderBillingPeriod())),C)}},t.prototype.renderPlanDetails=function(){return r.createElement("a",{className:"plan-status-section__link",onClick:this.logSeePlanDetails,href:this.plansURL,target:"_blank",rel:"noopener noreferrer"},this.isTaurusPlan()?s._("See plan details"):s._("See available plans"))},t.prototype.renderTrialSection=function(){var e=this.props,t=e.subStatus,a=e.paymentInfo;if(t&&t.subState&&t.subState.plan&&a){var n=a.gateway_id,i=a.trial_info;if(i){var l=r.createElement("noscript",null);p.isIOS(n)||(l=this.createTrialCtaButtons(!i.is_trial_overdue,this.isProfessionalTrial()));var o=s._("Dropbox %(plus)s").format({plus:t.subState.plan.displayName(!1,!1,n)});return i.is_trial_overdue&&(o+=" "+s._("(Expired)")),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},o),r.createElement("p",{className:"plan-status-section__title_description"},this.isProfessionalTrial()?p.getProfessionalTrialPlanDescription(t):p.getTrialDescription(n,i)," ",this.isProfessionalTrial()&&r.createElement("span",null,this.renderPlanDetails(),r.createElement("br",null),this.renderBillingPeriod()))),l)}}},Object.defineProperty(t.prototype,"hasSelfServablePaymentAfterLicensekey",{get:function(){var e=this.props.paymentInfo;return e&&!p.isLicenseKey(e.gateway_id)&&!p.shouldHidePaymentMethod(e.gateway_id)},enumerable:!0,configurable:!0}),t.prototype.renderLicensePlanSection=function(){var e=this.props.subStatus;if(!e||!e.subState||!e.subState.plan)return r.createElement("noscript",null);var t=s._("Dropbox %(plus)s").format({plus:e.subState.plan.displayName()}),a=r.createElement("noscript",null);if(this.props.hasUnusedLicenseKey){var n=s._("Your Dropbox %(plus)s plan was activated with a license key.         Your next license key will be activated on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate});this.props.isLoggedInAsTransactionOwner||(n=s._("This Dropbox %(plus)s plan was activated with a license key.           The next license key will be activated on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}));var i=r.createElement("noscript",null);if(this.hasSelfServablePaymentAfterLicensekey)i=r.createElement("div",null,s._("No charge made to your payment method on file.")),this.props.isLoggedInAsTransactionOwner||(i=r.createElement("div",null,s._("No charge made to the payment method on file.")));else{var l=s._("You can add your payment information now to have            your subscription automatically renew when your keys expire.");this.props.isLoggedInAsTransactionOwner||(l=s._("The account owner can add payment information now to have               this subscription automatically renew when the keys expire.")),i=r.createElement("div",null,l,r.createElement("br",null),r.createElement("a",{href:"#",onClick:this.addPaymentClick},s._("Add payment method.")))}a=r.createElement("div",null,n,r.createElement("br",null),i)}else if(this.hasSelfServablePaymentAfterLicensekey){var o=e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,c=s._("Your Dropbox %(plus)s plan was activated with a               license key. The plan will renew on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),u=s._("%(new_total)s per %(new_period)s will be charged to your payment method on file.").format({new_total:g.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary),new_period:o});this.props.isLoggedInAsTransactionOwner||(c=s._("This Dropbox %(plus)s plan was activated with a             license key. The plan will renew on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),u=s._("%(new_total)s per %(new_period)s will be charged to the payment method on file.").format({new_total:g.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary),new_period:o})),a=r.createElement("div",null,c,r.createElement("br",null),u,r.createElement("br",null),this.renderBillingPeriod())}else{var c=s._("Your Dropbox %(plus)s plan was activated with a license key.                 The plan is active until %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),d=s._("You can add your payment information now to have               your subscription automatically renew when it expires.");this.props.isLoggedInAsTransactionOwner||(c=s._("This account’s Dropbox %(plus)s plan was activated with a license key.               The plan is active until %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),d=s._("The account owner can add payment information now to have               this subscription automatically renew when it expires.")),a=r.createElement("div",null,c,r.createElement("br",null),d,r.createElement("br",null),r.createElement("a",{href:"#",onClick:this.addPaymentClick},s._("Add payment method.")))}return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},t),r.createElement("p",{className:"plan-status-section__title_description"},a)),this.renderContactSupportLink())},t.prototype.render1TBChangeablePlan=function(){var e=this.props,t=e.subStatus,a=e.paymentInfo,n=e.scheduledForDowngrade;if(!t||!t.subState||!t.subState.plan)return r.createElement("noscript",null);var i=t.subState.plan.displayName(!0),l="";t.subState.billingSchedule&&t.subState.billingSchedule.scheduleDescriptionNoun&&t.currentBillingSummary&&t.currentBillingSummary.total&&(l=s._("%(total)s per %(period)s.").format({total:g.Cash.formatWithTaxLabels(t.currentBillingSummary.total,t.currentBillingSummary),period:t.subState.billingSchedule.scheduleDescriptionNoun}));var o=r.createElement("noscript",null);if(a&&!p.shouldHideBillingChange(a.gateway_id,a.is_external_billing)){var c=s._("Your %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l});this.props.isLoggedInAsTransactionOwner||(c=s._("This account’s %(plan)s plan will renew on %(date)s.             %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l})),o=r.createElement("span",null,c)}if(n){var u=s._("Your %(plan)s will downgrade to Dropbox Basic on %(date)s. %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l});this.props.isLoggedInAsTransactionOwner||(u=s._("This account’s %(plan)s will downgrade to Dropbox Basic on %(date)s.           %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l})),o=r.createElement("span",null,u)}var d=this.renderContactSupportLink();return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},i),r.createElement("p",{className:"plan-status-section__title_description"},o,r.createElement("br",null),this.renderBillingPeriod())),d)},t.prototype.renderPlanSection=function(){var e=this.props,t=e.subStatus,a=e.isExternallyBilled,n=e.paymentInfo,i=e.isLimitedTeam;return e.eligibleFor1tb?this.render1TBChangeablePlan():a&&void 0!==n&&null!==n.reseller_name?this.renderResellerPlan():a&&i&&void 0!==n&&n.gateway_id===m.NOT_APPLICABLE?void 0:t&&t.subState.plan&&t.subState.plan.productFamily===P.ProductFamily.PRO?this.isTrialPlan()?this.renderTrialSection():this.isLicensePlan()?this.renderLicensePlanSection():this.renderPaidPlanSection():this.renderBasicPlanSection()},t.prototype.render=function(){var e=this.props,t=e.isPersonalUser,a=e.isLimitedTeam,n=t||a?this.renderPlanSection():this.renderBusinessPlanSection(),i=null;return"ON"===this.props.planSpectrumVariant&&(i=r.createElement("div",{className:"plan-status__header"},s._("Your plan"))),r.createElement("div",{className:"plan-status"},i,n)},t})(r.Component);t.PlanStatus=x}),define("modules/clean/account_page/widgets/plan/views/pro_upsell_modal_content",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/css","modules/clean/static_urls","modules/constants/trademark","modules/clean/react/image"],function(e,t,a,n,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){switch(this.props.variant){case"V1":return this.renderV1();case"V2":return this.renderV2();case"V3":return this.renderV3();default:return null}},t.prototype.renderV1=function(){var e=this.props,t=e.price,a=e.unit,r=t?t.toString():"-",l=t?a:"";return n.createElement("section",null,n.createElement("div",{className:"pro-upsell"},n.createElement("h1",{className:"pro-upsell__headline"},i._("Do more with Dropbox %(trademark_pro)s").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),n.createElement("div",null,n.createElement("div",{className:"pro-upsell__price"},r),n.createElement("div",{className:"pro-upsell__price-schedule"},l))),n.createElement("ul",{role:"list",className:"reasons-list"},n.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),n.createElement("li",{className:"reasons-list__item"},i._("Showcase, Smart Sync, shared link controls, and more."))))},t.prototype.renderV2=function(){var e=this.props,t=e.price,a=e.unit,r=t?t.toString():"-",l=t?a:"";return n.createElement("section",null,n.createElement("div",{className:"pro-upsell"},n.createElement("h1",{className:"pro-upsell__headline"},i._("Do more with Dropbox %(trademark_pro)s").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),n.createElement("div",null,n.createElement("div",{className:"pro-upsell__price"},r),n.createElement("div",{className:"pro-upsell__price-schedule"},l))),n.createElement("div",{className:"grid__container"},n.createElement("ul",{role:"list",className:"reasons-list reasons-list--margin-right"},n.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),n.createElement("li",{className:"reasons-list__item"},i._("Showcase")),n.createElement("li",{className:"reasons-list__item"},i._("Smart Sync"))),n.createElement("ul",{className:"reasons-list"},n.createElement("li",{className:"reasons-list__item"},i._("Advanced sharing controls")),n.createElement("li",{className:"reasons-list__item"},i._("Priority chat support")),n.createElement("li",{className:"reasons-list__item"},i._("Full text search")))))},t.prototype.renderV3=function(){var e=this.props,t=e.price,a=e.unit,r=t?t.toString():"-",c=t?a:"";return n.createElement("section",null,n.createElement("div",{className:"pro-upsell__image-wrapper"},n.createElement(s.Image,{className:"pro-upsell__image",alt:"",src:l.static_url("/static/images/growth/sell-more-faster-illo@2x-vflHz-UKV.png"),srcHiRes:l.static_url("/static/images/growth/sell-more-faster-illo@2x-vflHz-UKV.png")})),n.createElement("div",{className:"pro-upsell"},n.createElement("h1",{className:"pro-upsell__headline"},i._("What’s included in Dropbox %(trademark_pro)s?").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),n.createElement("div",null,n.createElement("div",{className:"pro-upsell__price"},r),n.createElement("div",{className:"pro-upsell__price-schedule"},c))),n.createElement("div",{className:"grid__container"},n.createElement("ul",{role:"list",className:"reasons-list reasons-list--margin-right"},n.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),n.createElement("li",{className:"reasons-list__item"},i._("Showcase"))),n.createElement("ul",{className:"reasons-list"},n.createElement("li",{className:"reasons-list__item"},i._("Advanced sharing controls")),n.createElement("li",{className:"reasons-list__item"},i._("Smart Sync")))))},t})(n.Component);t.ProUpsellModalContent=r(c,["/static/css/teams/admin/widgets/change_plan_modal/pro_upsell_modal_content-vflvOZfv7.css"])}),define("modules/clean/account_page/widgets/plan/views/quota_usage",["require","exports","tslib","external/react","external/classnames","modules/core/browser","modules/clean/react/css","modules/clean/viewer","modules/core/i18n","modules/clean/display_format","modules/clean/react_format","modules/constants/trademark"],function(e,t,a,n,i,r,l,o,s,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickAdvancedUpgrade=function(e){e.preventDefault(),r.redirect("/team/admin/billing/manage")},t}return a.__extends(t,e),Object.defineProperty(t.prototype,"teamName",{get:function(){return o.Viewer.get_viewer().team_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"freeSpace",{get:function(){var e=this.props.usageBreakdown;return e.quota-e.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharedFles",{get:function(){return this.props.usageBreakdown.shared_usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"regularFles",{get:function(){return this.props.usageBreakdown.unshared_usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usage",{get:function(){return this.props.usageBreakdown.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOverQuota",{get:function(){return this.usage>this.quota},enumerable:!0,configurable:!0}),t.prototype.getQuotaUpsell=function(){var e=this.props,t=e.subStatus,a=e.isPersonalUser,i=e.isLimitedTeam,r=e.isMSLTeamMember,l=e.isTeamAdmin;if(t){var o=null,c=t.subState.plan,p=n.createElement("span",null,s._("When your team runs out of space, accounts will stop syncing         and you won’t be able to add any new files.")," ");return a||i?!c&&this.isOverQuota&&(o=n.createElement("div",{className:"quota-upsell"},s._("With %(plan)s, get 1 TB (1,000 GB) for all your photos, videos, docs and other files.               Keep everything stored safely and at your fingertips.").format({plan:d.TRADEMARK_PLUS})," ",n.createElement("a",{href:"/upgrade?oqa=acc_plan_upgrade_overquota_link"},s._("Upgrade now")))):r?this.isOverQuota&&(o=n.createElement("div",{className:"quota-upsell"},s._("Your Dropbox account is full. To continue, remove files or ask your admin for\n                more space. "),n.createElement("a",{href:"/help/business/space-limit-full"},s._("Learn more about Dropbox space")))):o=c&&c.isAdvancePlan?n.createElement("div",{className:"quota-upsell"},p,l?u.reactFormat(s._("To add more space, <a>contact support</a>."),{a:n.createElement("a",{href:"/support",target:"_blank",rel:"noopener noreferrer"})}):s._("Contact your admin to add more space.")):n.createElement("div",{className:"quota-upsell"},p,l?u.reactFormat(s._("<a>Upgrade to an Advanced plan</a> to get more space."),{a:n.createElement("a",{href:"",onClick:this.onClickAdvancedUpgrade})}):u.reactFormat(s._("Contact your admin to upgrade to an <a>Advanced plan</a> and get more space."),{a:n.createElement("a",{href:"/business/plans-comparison",target:"_blank",rel:"noopener noreferrer"})})),o}},t.prototype.render=function(){var e=this.props,t=e.isPersonalUser,a=e.isLimitedTeam,r=e.isMSLTeamMember,l="",o=u.reactFormat(s._("Using <strong>%(usage)s</strong> of %(quota)s").format({usage:c.format_bytes(this.usage),quota:c.format_bytes(this.quota)}),{strong:n.createElement("strong",{key:"quota-strong"})});l=t||a?this.isOverQuota?s._("Your Personal Dropbox account is full"):s._("Personal Dropbox space"):r?this.isOverQuota?s._("Your Dropbox account space is full"):s._("Your Dropbox account space"):this.isOverQuota?s._("Your %(team_name)s account is full").format({team_name:this.teamName}):s._("%(team_name)s — space").format({team_name:this.teamName});var d=100*this.regularFles/this.quota,p=d>100?"100":d.toFixed(20),m=p+"%",h=100*this.sharedFles/this.quota,_=h>100?"100":h.toFixed(20),g=_+"%",f={width:m},b={width:g},y=i({"account-plan-tab-quota-usage":!0,"is-within-quota":!this.isOverQuota,"is-over-quota":this.isOverQuota}),S=i({"bar-graph-part":!0,"bar-graph-normal":!0,"normal-color":!0,"is-zero":0===this.usage}),v=i({"bar-graph-part":!0,"bar-graph-shared":!0,"bar-shared-color":!0,"is-zero":0===this.sharedFles}),E=i({"bar-graph-legend":!0,"bar-graph-normal":!0,"normal-color":!0}),P=i({"bar-graph-legend":!0,"bar-graph-shared":!0,"shared-color":!0}),C=this.getQuotaUpsell(),w=this.isOverQuota?void 0:n.createElement("div",{className:"bar-graph-legend-group"},n.createElement("div",{className:"bar-graph-legend bar-graph-free"}),n.createElement("span",{className:"bar-graph-key-text"},s._("Unused space")," (",c.format_bytes(this.freeSpace),")"));return n.createElement("div",{className:y},n.createElement("div",{className:"quota-header"},n.createElement("span",{className:"quota-header quota-header__plan"},l),n.createElement("span",{className:"quota-header quota-header__usage"},o)),n.createElement("div",{className:"quota-space-bar"},n.createElement("div",{className:"bar-graph"},n.createElement("div",{className:S,style:f}),n.createElement("div",{className:v,style:b}))),n.createElement("div",{className:"quota-space-legend"},n.createElement("div",{className:"bar-graph-key"},n.createElement("div",{className:"space-key"},n.createElement("div",{className:"bar-graph-legend-group"},n.createElement("div",{className:E}),n.createElement("span",{className:"bar-graph-key-text"},s._("Regular files")," (",c.format_bytes(this.regularFles),")")),n.createElement("div",{className:"bar-graph-legend-group"},n.createElement("div",{className:P}),n.createElement("span",{className:"bar-graph-key-text"},s._("Shared files")," (",c.format_bytes(this.sharedFles),")")),w))),C)},t})(n.Component);t.QuotaUsageView=p,t.QuotaUsage=l(p,["/static/css/account/pagelet/quota_usage-vflqT1pDK.css"])}),define("modules/clean/account_page/widgets/plan/views/referral_space",["require","exports","tslib","modules/core/browser","external/react","modules/clean/react/css","modules/core/i18n","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/referral_history/api","modules/clean/static_urls","modules/clean/account_page/components/account_table","modules/clean/account_page/components/button_block","modules/clean/analytics"],function(e,t,a,n,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.buildReferralHistoryIfNecessary=function(){var e=n.state.history;if(null!==e&&null!==e.rows&&0!==e.rows.length)return i.createElement("div",{className:"referral-table-container"},i.createElement(u.Table,{className:"referral-table"},i.createElement(u.TableHead,null,i.createElement(u.HeaderRow,{className:"referral-header-row"},i.createElement(u.HeaderCell,{className:"referral-bonus-type-header"},l._("Bonus type")),i.createElement(u.HeaderCell,{className:"referral-description-header"}),i.createElement(u.HeaderCell,{className:"referral-updated-header"},l._("Updated")),i.createElement(u.HeaderCell,{className:"referral-earned-header"},l._("Space earned")))),i.createElement(u.TableFooter,{className:"referral-footer"},n.buildReferralFooter()),i.createElement(u.TableBody,null,e.rows.map(function(e,t){if(n.state.showMore||!(t>2))return n.buildReferralRow(e)}))))},n.loadMoreReferralHistory=function(e){return a.__awaiter(n,void 0,void 0,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return this.setState({isLoading:!0}),p.ProEventsLogger.log("de_earn_space_view_more_click"),e.preventDefault(),this.state.showMore?[4,s.getReferralHistory(o.getCurrentUser().id,this.state.currentPage+1)]:(this.setState({showMore:!0,isLoading:!1}),[2,!1]);case 1:return t=a.sent(),t.rows=this.state.history.rows.concat(t.rows),this.setState({currentPage:this.state.currentPage+1,history:t,isLoading:!1}),[2,!1]}})})},n.buildReferralFooter=function(){var e=n.state.history;if(n.state.isLoading)return i.createElement("tr",{className:"referral-footer-row"},i.createElement("td",{colSpan:4},i.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:l._("Loading")})));if(!(!n.state.showMore&&e.rows.length<3||n.state.showMore&&!e.has_more))return i.createElement("tr",{className:"referral-footer-row"},i.createElement("td",{colSpan:4},i.createElement("a",{onClick:n.loadMoreReferralHistory,href:"#",rel:"noopener noreferrer"},l._("View more earned space"))))},n.buildReferralRow=function(e){var t=null,a=null;return t=e.type.url?i.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:e.type.url},e.type.str):i.createElement("span",null,e.type.str),a=e.earned.completed?i.createElement("div",null,i.createElement("span",{className:"earned-space"},e.earned.str),i.createElement("img",{src:c.static_url("/static/images/icon_checkmark-vflExOh3Y.png"),alt:""})):e.earned.url?i.createElement("a",{target:"_blank",
rel:"noopener noreferrer",href:e.earned.url},e.earned.str):i.createElement("span",null,e.earned.str),i.createElement(u.BodyRow,{className:"referral-body-row",key:e.details+e.updated},i.createElement(u.BodyCell,{className:"referral-bonus-type"},t),i.createElement(u.BodyCell,{className:"referral-description"},e.details),i.createElement(u.BodyCell,{className:"referral-updated"},e.updated),i.createElement(u.BodyCell,{className:"referral-earned"},a))},n.state={history:n.props.referralHistory,showMore:!1,isLoading:!1,currentPage:0},n}return a.__extends(t,e),t.prototype.buildInvitePhrase=function(e){return l._("You can earn more space by referring your friend to Dropbox! You’ll       get a %(referral_amount)s bonus when they install Dropbox on their computer.").format({referral_amount:e})},t.prototype.isLoading=function(){return"ready"!==this.props.referralLoadingState},t.prototype.inviteFriendClick=function(){p.ProEventsLogger.log("de_earn_space_invite_click"),n.redirect("/referrals")},t.prototype.render=function(){if(this.isLoading())return i.createElement("div",{className:"loading-indicator"},i.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:l._("Loading")}));var e=this.props.referralInfo;return i.createElement("div",{className:"referral-space"},i.createElement(d.ButtonBlock,{label:l._("Earn more space (%(current_space)s earned)").format({current_space:e.currentSpace}),subtext:this.buildInvitePhrase(e.referralAmount),buttonText:l._("Invite a friend"),kind:"secondary",buttonAction:{kind:"function",handler:this.inviteFriendClick}}),this.buildReferralHistoryIfNecessary())},t})(i.Component);t.ReferralSpace=r(m,["/static/css/account/pagelet/referral_space-vflqD-0ia.css"])}),define("modules/clean/account_page/widgets/plan/views/upsell_module",["require","exports","tslib","external/react","spectrum/button","modules/clean/react/css"],function(e,t,a,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.headline,a=e.text,r=e.cta;return n.createElement("section",{className:"upsell-module"},n.createElement("div",{className:"upsell-module__content-container"},n.createElement("div",{className:"upsell-module__text-wrapper"},n.createElement("h2",{className:"upsell-module__headline"},t),n.createElement("p",{className:"upsell-module__body"},a)),n.createElement(i.Button,{className:"upsell-module__button",href:r.link},r.text)))},t})(n.Component);t.UpsellModule=r(l,["/static/css/account/pagelet/upsell_module-vflEVSZR6.css"])}),define("modules/clean/deprecated/dbmodal_loading",["require","exports","tslib","modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(e,t,a,n,i){"use strict";var r=(function(e){function t(t){return e.call(this,t)||this}return a.__extends(t,e),t.initClass=function(){this.prototype.on_confirm_button_click=null,this.prototype.on_cancel_button_click=null},t.prototype.on_show=function(){return this.fetch()},t.prototype.fetch=function(){var e=this;return new i(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:function(t,a,n){return e.hide()}})},t})(n.DBModal);return r.initClass(),r}),define("modules/clean/growth/gating",["require","exports","tslib","modules/clean/ajax"],function(e,t,a,n){"use strict";function i(e,t,i){return void 0===i&&(i={}),a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(r){return[2,n.SilentBackgroundRequest(a.__assign({url:"/growth/gating_check",subject_user:e.id,data:{experiment:t}},i)).then(function(e){return JSON.parse(e)})]})})}function r(e,n,r){return void 0===r&&(r={}),a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return"personal"!==e.role||e.paid?[2,Promise.resolve(t.inactiveGatingStatus)]:[2,i(e,n,r)]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.inactiveGatingStatus={is_active:!1,variant:"OFF"},t.growthCheckGating=i,t.growthCheckBasicUserGating=r}),define("modules/clean/growth/user_action/tracker",["require","exports","tslib","external/lodash","modules/clean/ajax"],function(e,t,a,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){this.userId=e,this.timers={},t&&t.project&&(this.project=t.project)}return e.prototype.startTimer=function(e){this.timers[e]={start:Date.now(),end:0}},e.prototype.stopTimer=function(e){this.timers[e]&&!this.timers[e].end&&(this.timers[e].end=Date.now())},e.prototype.clearTimer=function(e){delete this.timers[e]},e.prototype.getDuration=function(e){return this.timers[e]?this.timers[e].end?this.timers[e].end-this.timers[e].start:Date.now()-this.timers[e].start:0},e.prototype.track=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),i.SilentBackgroundRequest(a.__assign({url:"/growth/user_action/track",subject_user:this.userId,data:a.__assign({project:this.project,action:e,duration:this.getDuration(e)},n.pick(t,"endpoint"),{extra:JSON.stringify(t.extra||{})})},r))},e})();t.GrowthUserActionTracker=r}),define("modules/clean/payments/billing_info_base",["require","exports","jquery","modules/clean/payments/cash","modules/clean/payments/payment_form_events","modules/clean/payments/pro_util","modules/core/controller_helpers"],function(e,t,a,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t,a,n){this.listen_tax=this.listen_tax.bind(this),this._getCurrency=this._getCurrency.bind(this),this.getCurrentTransitionViewModel=this.getCurrentTransitionViewModel.bind(this),this.updateForm=this.updateForm.bind(this),this._display_tax=this._display_tax.bind(this),this._recompute_costs=this._recompute_costs.bind(this),this._recompute_costs_from_tvm=this._recompute_costs_from_tvm.bind(this),this.$container=e,this.country_to_currency_map=t,this.transition_view_models=a,this.countryToTaxNameMap=n,this.transition_info_fetcher=new r.TransitionInfoFetcher(this.transition_view_models),this.payment_form=l.get_controller(this.$container.find(".payment-form-component")),this.hasTax=null!=this.countryToTaxNameMap,this.transition_view_models&&(this.transition_view_model=this.transition_view_models[0]),this.listen_tax()}return e.prototype.listen_tax=function(){var e=this;if(this.hasTax)return this.$container.on(i.LOCATION_CHANGE_EVENT,function(t,a){if(t.stopPropagation(),r.TaxHelper.require_recompute(e.get_country_code(),e.get_zip_code()))return e.updateForm()})},e.prototype.get_zip_code=function(){return this.$container.find('input:visible[name="zip"]').val()},e.prototype.get_country_code=function(){return this.$container.find('[name="country_code"]').val()},e.prototype._getCountryTaxName=function(e){return this.countryToTaxNameMap[e]||this.countryToTaxNameMap.Other},e.prototype._getCurrency=function(){var e=this.payment_form.get_country_code();return null!=this.country_to_currency_map?this.country_to_currency_map[e]:void 0},e.prototype.getCurrentTransitionViewModel=function(){return this.transition_view_model},e.prototype.updateForm=function(){return this._recompute_costs()},e.prototype._display_tax=function(){return r.TaxHelper.display_tax(this.get_country_code())?(a(".tax-row").removeClass("hidden_elem"),a(".tax-name-wrapper").text(this._getCountryTaxName(this.get_country_code())),!0):(a(".tax-row").addClass("hidden_elem"),!1)},e.prototype._recompute_costs=function(){var e={zip:this.get_zip_code(),country_code:this.get_country_code()};return this.transition_info_fetcher.get(this._recompute_costs_from_tvm,e,!0)},e.prototype._recompute_costs_from_tvm=function(e){var t;if(e){this.transition_view_model=e;var i=this._getCurrency();this.$container.find(".currency-wrapper").text(i);var l=Array.from(r.TaxHelper.compute_tax(e.read_only_invoice,i)),o=l[0],s=l[1],c=l[2],u=n.CashUtil.formatCurrency(o.amount,o.currency);if(this.$container.find(".price-amount-wrapper").text(u),e.rebill){t=n.Cash.fromObject(e.rebill.total);var d=n.CashUtil.formatCurrency(t.amount,t.currency);this.$container.find(".rebill-amount-wrapper").text(d)}if(e.state.total_recurring_price){var p=n.Cash.fromObject(e.state.total_recurring_price),m=n.CashUtil.formatCurrency(p.amount,p.currency);this.$container.find(".rebill-price-wrapper").text(m)}var h=this._getTotalAmount(e),_=n.CashUtil.formatCurrency(h.amount,h.currency);this.$container.find(".total-amount-wrapper").text(_),a(".tax-row").toggleClass("hidden_elem",this._display_tax());var g=n.CashUtil.formatCurrency(c.amount,c.currency);return a(".tax-amount-wrapper").text(g),[o,s,c,t,i]}},e})();t.BillingInfoModalBase=o}),define("modules/clean/payments/billing_info_modal",["require","exports","tslib","jquery","modules/clean/analytics","modules/clean/dbmodal_stack","modules/clean/deprecated/uirequest","modules/clean/payments/billing_info_base","modules/clean/payments/cash","modules/clean/payments/payment_form_events","modules/core/cookies","modules/core/uri","modules/clean/payments/pro_util"],function(e,t,a,n,i,r,l,o,s,c,u,d){"use strict";var p=(function(e){function t(a,o,s,u,p){var m=e.call(this,a,u,s,p)||this;return m.payment_link_map=o,m._postRequest=m._postRequest.bind(m),m._update_disclaimer=m._update_disclaimer.bind(m),m.$container.on("click",".cancel-button",function(){return i.TeamsWebActionsLogger.log("update_billing_open_cancel"),r.DBModalStack.pop()}),m.$container.on("click",".confirm-button",function(){if(i.TeamsWebActionsLogger.log("update_billing_open_save_changes_click"),m.payment_form.validate())return m.$container.find(".confirm-button").prop("disabled",!0),m.payment_form.get_form_inputs(function(e){m.$container.find(".confirm-button").prop("disabled",!1);var a=["resubscribe"];m.$container.find("input, select").each(function(t,i){var r=n(i),l=r.attr("name");if(Array.from(a).includes(l))return e[l]=r.val()});var o=m.payment_form.get_selected_payment_method_id(),s=m.payment_link_map[o];if("extra_params"in s){var c=s.extra_params;n.extend(e,c)}return s.use_form_post?m._postRequest(new d.URI({path:s.endpoint}),e):new l(m.$container,s.endpoint,{data:e,success:function(e){if(e.data&&e.data.success)return i.TeamsWebActionsLogger.log("update_billing_open_save_changes_success"),r.DBModalStack.trigger(t.BILLING_INFO_UPDATED),r.DBModalStack.pop()}})})}),m.payment_form.$container.on(c.PAYMENT_METHOD_TYPE_CHANGE_EVENT,m._update_disclaimer),null!=m.transition_view_models&&m.updateForm(),m}return a.__extends(t,e),t.initClass=function(){this.BILLING_INFO_UPDATED="billing_info_modal:updated"},t.prototype._postRequest=function(e,t){t.t=u.Cookies.read("__Host-js_csrf");var a=document.createElement("form");a.action=e,a.method="POST",document.body.appendChild(a);for(var n=0,i=Object.keys(t||{});n<i.length;n++){var r=i[n],l=document.createElement("input");l.type="hidden",l.name=r,l.value=t[r],a.appendChild(l)}return a.submit()},t.prototype._update_disclaimer=function(e,t){return t=parseInt(t,10),this.$container.find(".payment-method-disclaimer").each(function(e,a){var i=n(a).data("payment-method-id");return n(a).toggleClass("hidden",i!==t)})},t.prototype._getTotalAmount=function(e){return s.Cash.fromObject(e.read_only_invoice.total)},t})(o.BillingInfoModalBase);return p.initClass(),p}),define("modules/clean/payments/payment_form_events",["require","exports"],function(e,t){"use strict";var a=(function(){function e(){}return e.initClass=function(){this.LOCATION_CHANGE_EVENT="db:paymentform:countrycodechanged",this.ZIP_CHANGE_EVENT="db:paymentform:zipchanged",this.PAYMENT_METHOD_TYPE_CHANGE_EVENT="db:paymentform:paymentmethodtypechanged",this.VAT_CHANGE_EVENT="db:paymentform:vatchanged",this.CPF_CHANGE_EVENT="db:paymentform:cpfchanged",this.UNVALIDATED="db:paymentform:unvalidated",this.VALIDATE_ERROR="db:paymentform:validateerror",this.VALIDATE_SUCCESS="db:paymentform:validatesuccess",this.LOADED_EVENT="db:paymentform:loaded",this.IFRAME_LOADED_EVENT="db:paymentform:iframeloaded",this.IFRAME_FIELDS_STATUS_EVENT="db:paymentform:iframefieldsstatusevent",this.EDIT_SIMPLE_COUNTRY_CLICK_EVENT="db:paymentform:editsimplecountry"},e})();return a.initClass(),a}),define("modules/clean/payments/pro_util",["require","exports","external/lodash","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(e,t,a,n,i){"use strict";function r(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(){}return e.compute_tax=function(e,t){for(var a=null,n=null,r=new i.Cash(0,t),l=0,o=Array.from(e.line_items);l<o.length;l++){var s=o[l];1===s.line_item_type?a=s:2===s.line_item_type&&(n=s),s.country_tax_amount&&(r=r.add(i.Cash.fromObject(s.country_tax_amount))),s.state_tax_amount&&(r=r.add(i.Cash.fromObject(s.state_tax_amount)))}return[null!=a?i.Cash.fromObject(a.line_item_price):new i.Cash(0,t),null!=n?i.Cash.fromObject(n.line_item_price):new i.Cash(0,t),r]},e.require_recompute=function(e,t){return"US"===e&&/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(t)},e.display_tax=function(e){return"US"===e},e})();t.TaxHelper=l;var o=(function(){function e(e){if(this._cache_key_from_transition=this._cache_key_from_transition.bind(this),this._get_state_json=this._get_state_json.bind(this),this.get=this.get.bind(this),this._has_inflight_request=this._has_inflight_request.bind(this),this._add_to_cache=this._add_to_cache.bind(this),this._get_transition_info_for=this._get_transition_info_for.bind(this),this.default_transition_view_models=e,this._requests={},this.transition_info_cache={},this.default_transition_view_models)for(var t=0,a=Array.from(this.default_transition_view_models);t<a.length;t++){var n=a[t];this._add_to_cache(n)}}return e.prototype._cache_key=function(e){return a.values(e).join(":")},e.prototype._cache_key_from_transition=function(e){var t={country_code:null!=e.read_only_invoice?e.read_only_invoice.tax_country_code:void 0,zip_code:null!=e.read_only_invoice?e.read_only_invoice.tax_zip_code:void 0};return this._cache_key(t)},e.prototype._get_state_json=function(){var e=r(null!=this.default_transition_view_models?this.default_transition_view_models[0]:void 0,function(e){return e.state});return JSON.stringify(e)},e.prototype.get=function(e,t,i){var r=this,l=this._cache_key(t),o=this._get_transition_info_for(l);if(o)return void e(o);if(!this._requests[l]){if(this._has_inflight_request()&&i)for(var s in this._requests)delete this._requests[s];else if(this._has_inflight_request())return;return this._requests[l]=!0,n.SilentBackgroundRequest({url:"/pro/ajax_transition_view_model",dataType:"json",data:a.assignIn({json_state:this._get_state_json()},t),success:function(t){if(r._add_to_cache(t),null!=r._requests[l])return delete r._requests[l],e(t)},error:function(e){if(null!=r._requests[l])return delete r._requests[l]}})}},e.prototype._has_inflight_request=function(){return Object.keys(this._requests).length},e.prototype._add_to_cache=function(e){var t=this._cache_key_from_transition(e);return this.transition_info_cache[t]=e},e.prototype._get_transition_info_for=function(e){return null!=this.transition_info_cache[e]},e})();t.TransitionInfoFetcher=o}),define("modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader",["require","exports","tslib","modules/core/notify","external/react","modules/clean/react/css","modules/clean/react/sprite","modules/core/uri","modules/core/i18n","modules/clean/react/arbor/elements/arbor_inputs","modules/clean/payments/validation","modules/clean/react/modal","modules/clean/static_urls","modules/clean/react/tooltip","modules/clean/analytics","modules/clean/ajax_as_promised"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m,h,_){"use strict";function g(e){return function(t){return null==t||t.length<=e}}function f(e,t){return i.createElement(m.Tooltip,{position:m.TooltipPosition.RIGHT,tooltip_contents:t},e,i.createElement(l.Sprite,{group:"web",name:"info",className:"info-sprite",alt:""}))}Object.defineProperty(t,"__esModule",{value:!0});var b=s._("Country and postal code must match your account’s payment information."),y=s._("Your tax rate on this invoice cannot be updated."),S={addressName:s._("Billing name"),address:s._("Billing address"),city:s._("City"),state:s._("State"),zip:f(s._("Postal code"),b),country:f(s._("Country"),b),exclusionId:s._("VAT number (optional)"),exclusionIdWithTooltip:f(s._("VAT number (optional)"),y)},v=(function(e){function r(t){var a=e.call(this,t)||this;return a.disableds={addressName:!1,address:!1,city:!1,state:!1,zip:!0,country:!0,exclusionId:!1,exclusionIdWithTooltip:!1},a.addressNameLength=100,a.addressLength=250,a.cityLength=50,a.stateLength=50,a.vatLength=25,a.undefinedLength=void 0,a.validateHandlers={addressName:g(a.addressNameLength),address:g(a.addressLength),city:g(a.cityLength),state:g(a.stateLength),zip:function(){return!0},country:function(){return!0},exclusionId:function(){return!0},exclusionIdWithTooltip:function(){return!0}},a.maxLengths={addressName:a.addressNameLength,address:a.addressLength,city:a.cityLength,state:a.stateLength,zip:a.undefinedLength,country:a.undefinedLength,exclusionId:a.vatLength,exclusionIdWithTooltip:a.vatLength},a.errorTexts={addressName:s._("Too long"),address:s._("Too long"),city:s._("Too long"),state:s._("Too long"),zip:"",country:"",exclusionId:"",exclusionIdWithTooltip:""},a.onSave=function(){var e=a.state.formState,t=a.props.invoice;if(e)if(a.logActions("edit_billing_address_started"),a.setState({submitting:!0}),a.isInputValid()){var n={address_name:e.addressName,address:e.address,city:e.city,state:e.state,exclusion_id:e.exclusionId};t&&(n.invoice_id=o.URI.parse(t.link).getQuery().id.toString()),a.makeEditBillingAddressRequest(n)}else a.setState({submitting:!1,showErrors:!0})},a.onCancel=function(){a.logActions("edit_billing_address_cancelled"),d.Modal.close()},a.state={submitting:!1,showErrors:!1},t.isTeam?(a.editUrl="/edit_billing_address",a.viewModelUrl="/edit_billing_address_view_model",a.vatClass="grid__item--1-1",a.modalClass="edit-invoice-modal"):(a.editUrl="/edit_billing_address_individual",a.viewModelUrl="/edit_billing_address_individual_view_model",a.vatClass="grid__item--1-2",a.modalClass="edit-invoice-modal professional-modal"),a}return a.__extends(r,e),r.showInstance=function(e,a){var n=i.createElement(t.EditInvoiceAddressModalLoader,{invoice:e,isTeam:a});d.Modal.showInstance(n)},r.showUpdateTaxProfileModal=function(e,a){var n=i.createElement(t.EditInvoiceAddressModalLoader,{isTeam:e,onUpdated:a});d.Modal.showInstance(n)},r.prototype.componentDidMount=function(){var e=void 0;this.props.invoice&&(e=o.URI.parse(this.props.invoice.link).getQuery().id.toString(),this.disableds.exclusionIdWithTooltip=!0),this.makeRequest(e)},r.prototype.makeRequest=function(e){return a.__awaiter(this,void 0,void 0,function(){var t,n,i;return a.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t={invoice_id:e},[4,_.WebRequest({url:this.viewModelUrl,data:t,dataType:"json"})];case 1:return n=a.sent(),u.hasVat(n.countryCode)&&(this.errorTexts.exclusionId=s._("Please enter a valid VAT number, e.g. %(examples)s.").format({examples:u.getVatExamples(n.countryCode).join(", ")}),this.validateHandlers.exclusionId=function(e){return!e||u.validateVat(n.countryCode,e)}),this.setState({formState:n}),[3,3];case 2:return i=a.sent(),d.Modal.close(),[3,3];case 3:return[2]}})})},r.prototype.render=function(){var e,t=this.state,a=t.formState,n=t.showErrors,r=t.submitting;if(a){var l=null;if(u.hasVat(a.countryCode)){var o=u.getVatPrefix(a.countryCode);l=this.props.invoice?this.renderInput("exclusionIdWithTooltip",this.vatClass):this.renderInput("exclusionId",this.vatClass,o)}e=this.props.isTeam?i.createElement("div",{className:".type--arbor grid__container grid__container--p-large  grid--x-bookend"},this.renderInstructions(a.countryCode),this.renderInput("addressName","grid__item--1-1"),this.renderInput("address","grid__item--1-1"),this.renderInput("city","grid__item--1-2"),this.renderInput("state","grid__item--11-24"),this.renderInput("zip","grid__item--7-24"),this.renderInput("country","grid__item--2-3"),l):i.createElement("div",{className:".type--arbor grid__container grid__container--p-large  grid--x-bookend"},this.renderInput("addressName","grid__item--1-1"),this.renderInput("address","grid__item--1-2"),this.renderInput("city","grid__item--1-4"),this.renderInput("state","grid__item--1-4"),this.renderInput("zip","grid__item--1-2"),this.renderInput("country","grid__item--1-2"),l,this.renderInstructions(a.countryCode))}else e=i.createElement("div",{className:"loading-spinner"},i.createElement("img",{src:p.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:s._("Loading")}));var c=i.createElement(d.ModalButtons,{className:"oq-modal__buttons"},i.createElement(d.ModalButton,{className:"cancel-button",importance:"tertiary",onClick:this.onCancel},s._("Cancel")),i.createElement(d.ModalButton,{disabled:!a||r||n&&!this.isInputValid(),importance:"primary",onClick:this.onSave},s._("Save changes")));return i.createElement(d.Modal,{className:this.modalClass,autoClose:!1,buttonComponent:c,title:s._("Edit invoice details")},i.createElement("div",{className:"dynamic-content"},e))},r.prototype.logActions=function(e){this.props.isTeam?h.TeamsWebActionsLogger.log(e):h.UserActivityLogger.log("web",e)},r.prototype.makeEditBillingAddressRequest=function(e){return a.__awaiter(this,void 0,void 0,function(){var t,i,r;return a.__generator(this,function(a){switch(a.label){case 0:t=this.props.onUpdated,a.label=1;case 1:return a.trys.push([1,3,4,5]),i=this.editUrl,[4,_.WebRequest({url:i,data:e})];case 2:return a.sent(),this.logActions("edit_billing_address_success"),n.Notify.success(s._("Invoice details updated.")),[3,5];case 3:return r=a.sent(),this.logActions("edit_billing_address_edit_failure"),[3,5];case 4:return t&&t(),d.Modal.close(),[7];case 5:return[2]}})})},r.prototype.renderInstructions=function(e){var t,a=this.props.invoice;if(t=a?s._("You are editing details for the %(date)s invoice.").format({date:a.date}):s._("You are editing details for all future invoices. To edit past         invoices, click “Edit” on the invoice item instead."),u.hasVat(e)){var n=s._("Please note that changing your VAT number could impact your           applicable tax rate.");a&&(n=s._("To add or change a VAT number or request a tax refund, contact           support.")),t=t.concat(" ",n)}return i.createElement("div",{className:"grid__item--1-1 instructions"},t)},r.prototype.renderInput=function(e,t,a){var n=this.state,r=n.formState,l=n.showErrors,o="";return r&&(o=r[e]),i.createElement(c.ArborTextInput,{name:e,containerClassName:t,isValid:l?!!this.validateHandlers[e](o)&&"":"",labelText:S[e],errorText:this.errorTexts[e],value:o,onChange:this.onChangeFactory(e),disabled:this.disableds[e],placeholderText:a,maxLength:this.maxLengths[e]})},r.prototype.onChangeFactory=function(e){var t=this;return function(a,n,i){var r=t.state.formState;r&&t.setState(function(t){return r[e]=i,t})}},r.prototype.isInputValid=function(){var e=this.state.formState;return!!e&&(this.validateHandlers.addressName(e.addressName)&&this.validateHandlers.address(e.address)&&this.validateHandlers.city(e.city)&&this.validateHandlers.state(e.state)&&this.validateHandlers.exclusionId(e.exclusionId))},r})(i.Component);t.EditInvoiceAddressModalLoader=r(v,["/static/css/payments/edit_invoice_address_modal/edit_invoice_address_modal-vfl4mD1Gs.css"])}),define("modules/clean/react/payments/pro/components/payments/ideal_form",["require","exports","tslib","external/react","modules/clean/react/payments/common/form_value_helpers","modules/clean/react/payments/pro/components/inputs/inputs","modules/core/i18n"],function(e,t,a,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onIdealBankChange=function(e){var a=e.value,n=t.props.idealBanks[a];t.props.actions.updateIdealBank({bankId:a,bankName:n})},t}return a.__extends(t,e),t.prototype.idealBankErrorString=function(){var e=this.props.formData.idealBankId;return!i.FormValueHelper.isValid(e)&&e.showError?l._("Please select your bank."):""},t.prototype.render=function(){var e=this.props,t=e.formData,a=e.idealBanks,i=l._("Note: We’ll use your bank information provided by iDEAL     for all future billing cycles. If your bank is not listed, then please select a     different payment method.");return n.createElement("div",null,n.createElement("div",{className:"ideal-fields"},n.createElement(r.LabeledSelectInput,{name:"ideal_bank",labelText:l._("Bank"),value:t.idealBankId.rawValue,onChange:this.onIdealBankChange,errorText:this.idealBankErrorString()},n.createElement("option",{value:"",key:"default","aria-selected":""===t.idealBankId.rawValue},l._("Select your bank...")),Object.keys(a).map(function(e){return n.createElement("option",{value:e,key:e,"aria-selected":t.idealBankId.rawValue===e},a[e])}))),this.props.locationFields,n.createElement("div",{className:"ideal-note"},i))},t})(n.Component);t.IdealForm=o}),define("modules/clean/react/payments/pro/components/payments/payment_info_section",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/payments/payment_form/payment_form_spec","modules/clean/payments/validation","modules/core/i18n","modules/clean/react/payments/pro/components/inputs/inputs","modules/clean/react/payments/common/form_value_helpers","modules/clean/react/payments/pro/components/payments/ideal_form","modules/clean/react/payments/pro/components/payments/payment_method_selector","modules/clean/react/payments/checkout/components/payment_method_form/credit_card_frame","modules/clean/react/payments/checkout/components/payment_method_form/direct_debit_form"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCpfChange=function(e){t.props.actions.updateCpf(e.value)},t}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.formData.countryCode.formattedValue;i.ProEventsLogger.log("uj-billing-country",{country:e}),"BR"===e&&this.props.showCpf&&i.ProEventsLogger.log("uj-cpf-viewed-field")},t.prototype.prepareForSubmission=function(){return this.props.formData.paymentMethod.formattedValue===r.PaymentMethod.CreditCard?this.creditCardFrame.tokenize():Promise.resolve(!0)},t.prototype.onCountryCodeChange=function(e){this.props.actions.updateCountryCode(e.value);var t=e.value;i.ProEventsLogger.log("uj-billing-country",{country:t}),"BR"===t&&this.props.showCpf&&i.ProEventsLogger.log("uj-cpf-viewed-field")},t.prototype.onZipCodeChange=function(e){this.props.actions.updateZipCode(e.value)},t.prototype.onVatChange=function(e){this.props.actions.updateVat(e.value)},t.prototype.zipCodeErrorString=function(){var e=this.props.formData.zipCode;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid postal code."):""},t.prototype.vatErrorString=function(){var e=this.props.formData.vat;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid VAT number (ex: %(examples)s).").format({examples:l.getVatExamples(this.props.formData.countryCode.formattedValue).join(", ")}):""},t.prototype.cpfErrorString=function(){var e=this.props.formData.cpf;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid CPF number."):""},t.prototype.renderLocationFields=function(){var e=this.props,t=e.countryList,a=e.paymentSpec,i=e.formData,r=e.isScheduledDowngradeToBasic,c=o._("Postal Code",{comment:"This is the label for the zip code field, and should be kept short."}),u="US"===i.countryCode.formattedValue?o._("Billing ZIP"):c,d=!a.allow_zip_code_for_country(i.countryCode.formattedValue),p=this.zipCodeErrorString(),m=t.map(function(e){var t=e[0],a=e[1];return n.createElement("option",{key:"location-"+t,value:t},a)}),h=null,_="grid__item";if(this.props.individualUpdateBillingModalRefactor&&(_="grid__item--medium--1-2"),a.should_show_vat_for_country(i.countryCode.formattedValue)){var g=l.getVatPrefix(i.countryCode.formattedValue);h=n.createElement(s.LabeledTextInput,{className:"payment-info__vat",containerClassName:_,name:"vat",labelText:o._("VAT number (optional)"),errorText:this.vatErrorString(),placeholder:g,value:i.vat.rawValue,onChange:this.onVatChange.bind(this)})}var f=null;this.props.showCpf&&"BR"===i.countryCode.formattedValue&&(f=n.createElement(s.LabeledTextInput,{className:"payment-info__cpf",containerClassName:"grid__item",name:"cpf",labelText:o._("CPF"),errorText:this.cpfErrorString(),placeholder:"CPF/CNPJ",value:i.cpf.rawValue,onChange:this.onCpfChange}));var b="grid__item--7-24",y="grid__item--2-3",S="grid__item--7-24",v=null,E=void 0;if(this.props.individualUpdateBillingModalRefactor){b="grid__item--1-2",y="grid__item--1-2",S="grid__item--1-2",E=this.zipCodeErrorString(),p="";var P=o._("Please note that changing your billing location        could impact your applicable tax rate.");a.should_show_vat_for_country(i.countryCode.formattedValue)&&(P=o._("Please note that changing your billing location or VAT number        could impact your applicable tax rate.")),v=n.createElement("div",{className:r?"disclaimer-message-full-width":"disclaimer-message"},P,r&&n.createElement("span",null," ",o._("Updating your billing information will cancel your scheduled               plan downgrade. If you still wish to downgrade, you will need to               schedule it again.")))}return n.createElement("div",{className:"grid__item"},n.createElement(s.LabeledInputRow,{className:"payment-info__location grid__item grid--x-bookend",errors:[{name:"zip",text:p,className:S}]},n.createElement(s.LabeledTextInput,{className:"payment-info__zip",containerClassName:b,name:"zip",labelText:u,value:i.zipCode.rawValue,hasError:Boolean(p),disabled:d,onChange:this.onZipCodeChange.bind(this),errorText:E}),n.createElement(s.LabeledSelectInput,{className:"payment-info__country",containerClassName:y,labelText:o._("Country"),name:"country_code",onChange:this.onCountryCodeChange.bind(this),value:i.countryCode.rawValue},m)),h,f,v)},t.prototype.renderPaymentMethodSelector=function(){var e=this.props,t=e.paymentSpec,a=e.formData,i=e.enableIdealReact,r=e.individualUpdateBillingModalRefactor;return n.createElement(d.PaymentMethodSelector,{paymentSpec:t,paymentMethod:a.paymentMethod.rawValue,updatePaymentMethod:this.props.actions.updatePaymentMethod,countryCode:a.countryCode.rawValue,zipCode:a.zipCode.rawValue,enableIdealReact:i,individualUpdateBillingModalRefactor:r})},t.prototype.render=function(){var e=this,t=this.props,a=t.actions,i=t.formData,l=t.idealBanks,o=t.enableIdealReact,s=this.renderLocationFields(),c=s;return i.paymentMethod.formattedValue===r.PaymentMethod.DirectDeposit?c=n.createElement(m.DirectDebitForm,{locationFields:s,formData:i,actions:a,individualUpdateBillingModalRefactor:this.props.individualUpdateBillingModalRefactor}):o&&i.paymentMethod.formattedValue===r.PaymentMethod.Ideal&&(c=n.createElement(u.IdealForm,{locationFields:s,formData:i,actions:a,idealBanks:l})),n.createElement("div",{className:"grid__item payment-info"},this.renderPaymentMethodSelector(),n.createElement(p.CreditCardFrame,{iframeUrl:this.props.iframeUrl,hidden:i.paymentMethod.formattedValue!==r.PaymentMethod.CreditCard,actions:this.props.actions,ref:function(t){return e.creditCardFrame=t},nonce:i.nonce,bin:i.bin}),c)},t})(n.Component);t.PaymentInfoSection=h}),define("modules/clean/react/payments/pro/components/payments/payment_method_input",["require","exports","tslib","external/react","modules/core/i18n","external/classnames","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/pro/components/inputs/inputs"],function(e,t,a,n,i,r,l,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0})
;var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.onChange=function(e){this.props.onSelected(this.props.paymentMethod)},t.prototype.render=function(){var e=this.props,t=e.icons,a=e.labelText,s=e.paymentMethod,c=[],u=["payment-info__option"];this.props.individualUpdateBillingModalRefactor?this.props.numberOfPaymentMethods&&3===this.props.numberOfPaymentMethods?u.push("grid__item--medium--1-4"):this.props.numberOfPaymentMethods&&4===this.props.numberOfPaymentMethods?u.push("grid__item--medium--5-24"):u.push("grid__item--medium--1-2"):(u.push("grid__item"),u.push("grid__item--medium--shrink"),u.push("grid--y-middle"));var d;if(a&&(d="payment-method-label#debit",c.push(n.createElement("span",{title:"debit",key:d,className:"debit"},this.props.labelText))),t){if(s===l.PaymentMethod.CreditCard){var p=t.join(", ").replace("_","-"),m=i._("Credit card. We accept %(payment_methods)s").format({payment_methods:p});d="payment-method-label#creditcard",c.push(n.createElement("span",{key:d,className:"ax-visually-hidden"},m))}else s===l.PaymentMethod.PayPal?(d="payment-method-label#paypal",c.push(n.createElement("span",{key:d,className:"ax-visually-hidden"},i._("Paypal")))):s===l.PaymentMethod.Ideal&&(d="payment-method-label#ideal",c.push(n.createElement("span",{key:d,className:"ax-visually-hidden"},i._("iDEAL"))));for(var h=0,_=t;h<_.length;h++){var g=_[h];d="payment-method-icon#"+g,c.push(n.createElement("span",{title:g,key:d,className:g}))}}return n.createElement("div",{className:r(u)},n.createElement(o.LabeledRadioInput,{name:"payment_method",className:"payment-info__payment",value:s.toString(),checked:this.props.selected,onClick:this.onChange.bind(this),onChange:function(){}}),n.createElement("label",{htmlFor:"payment_method_"+s,id:"payment_method_"+s,className:"payment-info__method-label",onClick:this.onChange.bind(this)},c))},t})(n.Component);t.PaymentMethodInput=s}),define("modules/clean/react/payments/pro/components/payments/payment_method_selector",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/pro/components/payments/payment_method_input"],function(e,t,a,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onPaymentMethodSelected=function(e){t.props.updatePaymentMethod(e)},t}return a.__extends(t,e),t.prototype.getLabelForMethodId=function(e){return e===r.PaymentMethod.CreditCard?n.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.CreditCard,selected:this.props.paymentMethod===r.PaymentMethod.CreditCard,onSelected:this.onPaymentMethodSelected.bind(this),icons:this.props.paymentSpec.supported_credit_cards_for_country(this.props.countryCode),numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length,individualUpdateBillingModalRefactor:this.props.individualUpdateBillingModalRefactor}):e===r.PaymentMethod.PayPal?n.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.PayPal,selected:this.props.paymentMethod===r.PaymentMethod.PayPal,onSelected:this.onPaymentMethodSelected,icons:["paypal"],numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length,individualUpdateBillingModalRefactor:this.props.individualUpdateBillingModalRefactor}):e===r.PaymentMethod.DirectDeposit?n.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.DirectDeposit,selected:this.props.paymentMethod===r.PaymentMethod.DirectDeposit,onSelected:this.onPaymentMethodSelected,labelText:i._("Direct Debit"),numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length,individualUpdateBillingModalRefactor:this.props.individualUpdateBillingModalRefactor}):this.props.enableIdealReact&&e===r.PaymentMethod.Ideal?n.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.Ideal,selected:this.props.paymentMethod===r.PaymentMethod.Ideal,onSelected:this.onPaymentMethodSelected,icons:["ideal"],numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length,individualUpdateBillingModalRefactor:this.props.individualUpdateBillingModalRefactor}):null},t.prototype.render=function(){var e=this,t=this.props,a=t.countryCode,i=t.paymentSpec,r=i.available_payment_methods_for_country(a),l=r.map(function(t){return e.getLabelForMethodId(t)});return n.createElement("div",{className:"payment-info__selector grid__item grid__container--p-small"},l)},t})(n.Component);t.PaymentMethodSelector=o}),define("modules/clean/react/payments/update_billing_individual/action_creator",["require","exports","external/redux","modules/clean/react/payments/common/form/actions/actions","modules/clean/react/payments/update_billing_individual/actions"],function(e,t,a,n,i){"use strict";function r(e){return a.bindActionCreators(l(),e.dispatch)}function l(){return{submitBillingForm:i.submitBillingForm,updatePaymentMethod:n.updatePaymentMethod,updateCountryCode:i.updateBillingCountryCode,updateZipCode:n.updateZipCode,updateVat:n.updateVat,updateCpf:n.updateCpf,updateNonce:n.updateNonce,updateBIN:n.updateBIN,updateAccountHolderName:n.updateAccountHolderName,updateIBAN:n.updateIBAN,updateMandateSigned:n.updateMandateSigned,updateIdealBank:n.updateIdealBank}}Object.defineProperty(t,"__esModule",{value:!0}),t.bindBillingActions=r}),define("modules/clean/react/payments/update_billing_individual/actions",["require","exports","modules/core/i18n","modules/core/notify","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/common/form/actions/actions"],function(e,t,a,n,i,r){"use strict";function l(e,t){return function(a,n){var l=n(),o=l.formData,s=o.countryCode.formattedValue,c=l.pageState.paymentFormSpec,u=["countryCode"];c.allow_zip_code_for_country(s)&&u.push("zipCode"),c.should_show_vat_for_country(s)&&u.push("vat"),t&&"BR"===s&&u.push("cpf");var d;l.formData.paymentMethod.formattedValue===i.PaymentMethod.CreditCard?(u.push("nonce"),u.push("bin"),d="/update_credit_card_billing_info_ajax"):l.formData.paymentMethod.formattedValue===i.PaymentMethod.DirectDeposit?(u.push("accountHolderName","iban","mandateSigned"),d="/update_direct_debit_billing_info_ajax"):l.formData.paymentMethod.formattedValue===i.PaymentMethod.Ideal?(u.push("idealBankId","idealBankName"),d="/update_ideal_billing_info_ajax"):d="/paypal_billing_info",a(r.submitForm(d,u,e,{raise_error:!0}))}}function o(e){return function(t,i){var l=i(),o=l.pageState.countryToCurrencyMap;!(e in o)&&l.formData.countryCode.formattedValue in o?n.Notify.error(a._("You can’t change to a country with a different currency. For help, contact support."),3):t(r.updateCountryCode(e))}}Object.defineProperty(t,"__esModule",{value:!0}),t.submitBillingForm=l,t.updateBillingCountryCode=o}),define("modules/clean/react/payments/update_billing_individual/individual_update_billing_modal",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/payments/update_billing_individual/store_creator","modules/clean/react/payments/update_billing_individual/action_creator","modules/clean/react/payments/update_billing_individual/reducers","modules/clean/react/payments/pro/components/payments/payment_info_section","modules/clean/payments/payment_form/payment_form_spec","modules/clean/analytics"],function(e,t,a,n,i,r,l,o,s,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var a=e.call(this,t)||this;return a.prepareForSubmission=function(){return a.paymentInfoSection.prepareForSubmission()},a.savePaymentInfoSection=function(e){a.paymentInfoSection=e},a.store=r.createBillingStore(t,o.BillingReducer),a.state=a.store.getState(),a.store.subscribe(function(){var e=a.store.getState();e.pageState.submitSuccess||a.setState(function(t){return a.props.setSubmittingStatus(e.pageState.submitting),e})}),a}return a.__extends(t,e),Object.defineProperty(t.prototype,"actions",{get:function(){return l.bindBillingActions(this.store)},enumerable:!0,configurable:!0}),t.prototype.logVatChange=function(e,t){null===e&&(e=""),null===t&&(t=""),""===e&&""!==t?u.ProEventsLogger.log("update_billing_added_vat"):""!==e&&""===t?u.ProEventsLogger.log("update_billing_removed_vat"):e!==t&&u.ProEventsLogger.log("update_billing_updated_vat")},t.prototype.onAccept=function(){u.ProEventsLogger.log("update_billing_open_save_changes_click"),this.logVatChange(this.props.vat,this.state.formData.vat.formattedValue),this.actions.submitBillingForm(this.prepareForSubmission,this.props.showCpf)},t.prototype.onDismiss=function(){u.ProEventsLogger.log("update_billing_open_cancel")},t.prototype.render=function(){var e,t=this.props,a=t.iframeUrl,r=t.countryList,l=t.idealBanks,o=t.enableIdealReact,u=t.userInfo,d=t.individualUpdateBillingModalRefactor,p=t.isScheduledDowngradeToBasic,m=this.state,h=m.formData,_=m.pageState;if(h.paymentMethod.rawValue===c.PaymentMethod.PayPal)e=n.createElement("div",{className:"payment-method-disclaimer","data-payment-method-id":"{payment_method.ID}"},i._("You’ll be redirected to PayPal to finish updating your billing information."));else if(h.paymentMethod.rawValue===c.PaymentMethod.Ideal){var g=void 0;g=this.props.idealChargeAmount,e=n.createElement("div",{className:"payment-method-disclaimer","data-payment-method-id":"{payment_method.ID}"},i._("We’ll be charging you %(ideal_charge_amt)s to validate the account when                       you update your bank account information.").format({ideal_charge_amt:g}))}else e=null;return n.createElement("div",{className:"payment-info-section"},n.createElement("div",{className:"payment-method-section grid__container"},n.createElement(s.PaymentInfoSection,{paymentSpec:_.paymentFormSpec,iframeUrl:a,countryList:r,formData:h,actions:this.actions,ref:this.savePaymentInfoSection,idealBanks:l,enableIdealReact:o,userInfo:u,individualUpdateBillingModalRefactor:d,isScheduledDowngradeToBasic:p,showCpf:this.props.showCpf}),e))},t})(n.Component);t.IndividualUpdateBillingModal=d}),define("modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader",["require","exports","tslib","external/react","spectrum/button","modules/core/notify","modules/core/i18n","modules/clean/analytics","modules/clean/ajax","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal","modules/clean/static_urls"],function(e,t,a,n,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function c(){var t=e.call(this)||this;return t.onAccept=function(){t.updateBillingModal&&t.updateBillingModal.onAccept(),o.UserActivityLogger.log("web","update_billing_modal_started")},t.onDismiss=function(){t.updateBillingModal&&t.updateBillingModal.onDismiss(),o.UserActivityLogger.log("web","update_billing_modal_cancelled"),u.Modal.close()},t.saveUpdateBillingModal=function(e){t.updateBillingModal=e},t.setSubmittingStatus=function(e){t.setState(function(t){return t.submitting=e,t})},t.state={loadingContent:!0,submitting:!1},t}return a.__extends(c,e),c.showInstance=function(){u.Modal.showInstance(n.createElement(t.IndividualUpdateBillingModalLoader,null))},c.prototype.componentDidMount=function(){var e=this;s.WebRequest({url:"/account/profile/billing_info",success:function(t){var a=JSON.parse(t);e.setState(function(e){return e.loadedProps={countryList:a.countryList,iframeUrl:a.iframeUrl,countryToCurrencyMap:a.countryToCurrencyMap,userInfo:a.userInfo,idealBanks:a.idealBanks,enableIdealReact:a.enableIdealReact,countryCode:a.countryCode,serializedPaymentFormSpec:a.serializedPaymentFormSpec,individualUpdateBillingModalRefactor:a.individualUpdateBillingModalRefactor,idealChargeAmount:a.idealChargeAmount,isScheduledDowngradeToBasic:a.isScheduledDowngradeToBasic,vat:a.vat,showCpf:a.showCpf},e.loadingContent=!1,e}),o.UserActivityLogger.log("web","update_billing_modal_success")},error:function(){r.Notify.error(l._("Failed to load modal.")),o.UserActivityLogger.log("web","update_billing_modal_failure"),u.Modal.close()}})},c.prototype.renderButtons=function(){var e=this.state,t=e.loadingContent,a=e.submitting;return n.createElement(u.ModalButtons,{className:"oq-modal__buttons"},n.createElement(i.Button,{className:"cancel-button",variant:"secondary",onClick:this.onDismiss},l._("Cancel")),n.createElement(i.Button,{disabled:t||a,variant:"primary",onClick:this.onAccept},l._("Save changes")))},c.prototype.renderContent=function(){var e=this.state,t=e.loadingContent,a=e.loadedProps;if(t)return n.createElement("div",{className:"loading-spinner"},n.createElement("img",{src:p.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:l._("Loading")}));var i=a,r=i.countryList,o=i.iframeUrl,s=i.countryToCurrencyMap,c=i.countryCode,u=i.serializedPaymentFormSpec,m=i.userInfo,h=i.idealBanks,_=i.enableIdealReact,g=i.individualUpdateBillingModalRefactor,f=i.idealChargeAmount,b=i.isScheduledDowngradeToBasic,y=i.vat,S=i.showCpf;return n.createElement(d.IndividualUpdateBillingModal,{iframeUrl:o,countryList:r,countryToCurrencyMap:s,countryCode:c,serializedPaymentFormSpec:u,userInfo:m,idealBanks:h,enableIdealReact:_,setSubmittingStatus:this.setSubmittingStatus,ref:this.saveUpdateBillingModal,individualUpdateBillingModalRefactor:g,idealChargeAmount:f,isScheduledDowngradeToBasic:b,vat:y,showCpf:S})},c.prototype.render=function(){return n.createElement(u.Modal,{className:"update-billing-modal",autoClose:!1,buttonComponent:this.renderButtons(),title:l._("Update billing information")},n.createElement("div",{className:"dynamic-content"},this.renderContent()))},c})(n.Component);t.UpdateBillingModalLoaderView=m,t.IndividualUpdateBillingModalLoader=c(m,["/static/css/pro/components/update_billing_modal_individual-vflp6B0N7.css"])}),define("modules/clean/react/payments/update_billing_individual/reducers",["require","exports","external/lodash","modules/clean/dbmodal_stack","modules/core/i18n","modules/core/notify","modules/clean/payments/billing_info_modal","modules/clean/react/modal","modules/clean/react/payments/common/form/reducers/reducers","modules/clean/react/payments/common/payments/reducers/reducers","modules/clean/react/payments/common/pricing/reducers/reducers","modules/clean/analytics"],function(e,t,a,n,i,r,l,o,s,c,u,d){"use strict";function p(e,t){for(var a=0,n=g;a<n.length;a++){var i=n[a];i instanceof p?e=i(e,t):void 0!==i&&(e=i(e,t))}return e}function m(e,t){if("SubmitFormSuccess"!==t.type)return e;var s=a.assignIn({},e.pageState,{submitSuccess:!0});return e=a.assignIn({},e,{pageState:s}),r.Notify.success(i._("We’ve successfully updated your account’s billing information.")),d.ProEventsLogger.log("update_billing_open_save_changes_success"),o.Modal.close(),n.DBModalStack.trigger(l.BILLING_INFO_UPDATED,null),e}Object.defineProperty(t,"__esModule",{value:!0});var h=c.PaymentMethodReducers.map(function(e){return function(t,n){var i=e(t,n),r=a.assignIn(t.pageState,i.pageState),l=a.assignIn(t.pricingState,i.pricingState),o=a.assignIn(t.formData,i.formData);return a.assignIn(t,{pageState:r,pricingState:l,formData:o})}}),_=s.FormManagementReducers.filter(function(e){return e!==s.submitFormSuccess}),g=(new Array).concat([m],_,h,u.TransitionManagementReducers);t.BillingReducer=p}),define("modules/clean/react/payments/update_billing_individual/store_creator",["require","exports","external/redux","external/redux-thunk","modules/clean/react/payments/common/payments/state/store_creator","modules/clean/react/payments/common/form_value_factory"],function(e,t,a,n,i,r){"use strict";function l(e,t){var i=o(e),r=a.applyMiddleware(n);return a.createStore(t,i,r)}function o(e){var t=c(e),a=s(e);return{pricingState:a,pageState:t,formData:u(e,t,a)}}function s(e){var t=i.createPaymentPricingState(e);return{countryCode:t.countryCode,countryCodeLoading:t.countryCodeLoading,hasCurrencyChanged:t.hasCurrencyChanged,hasTaxChangedWithinCountry:t.hasTaxChangedWithinCountry,loadingPrices:t.loadingPrices,requestToken:t.requestToken,recentLoadEvent:t.recentLoadEvent}}function c(e){var t=i.createPaymentPageState(e).paymentFormSpec;return{countryToCurrencyMap:e.countryToCurrencyMap,submitSuccess:!1,submitState:null,submitting:!1,paymentFormSpec:t}}function u(e,t,a){var n=e.vat,l=e.cpf,o=e.countryCode,s=i.createPaymentFormData(e,t,a),c=s.paymentMethod,u=s.countryCode,d=s.zipCode,p=s.vat,m=s.cpf,h=s.nonce,_=s.bin,g=s.accountHolderName,f=s.iban,b=s.mandateSigned,y=s.termsAndService,S=s.idealBankId,v=s.idealBankName;return{paymentMethod:c,countryCode:u,zipCode:d,vat:n?r.FormValueFactory.createVat(n,o):p,cpf:l?r.FormValueFactory.createCpf(l,o):m,nonce:h,bin:_,accountHolderName:g,iban:f,mandateSigned:b,termsAndService:y,idealBankId:S,idealBankName:v}}Object.defineProperty(t,"__esModule",{value:!0}),t.createBillingStore=l,t.createFormData=u}),define("modules/clean/teams/admin/lib/billing_history",["require","exports","modules/clean/teams/admin/types/billing_history"],function(e,t,a){"use strict";function n(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(n<e.length-1){var l=e[n+1],o=r(l)||r(i);if(i.type===a.BillingRowType.Payment&&l.type===a.BillingRowType.Invoice&&(l.billed===i.paid||l.billed==="("+i.paid+")"||o)&&l.date===i.date){var s={id:n,invoice:l,payment:i,isMobile:o};t.push(s),n++;continue}}i.type===a.BillingRowType.Payment?t.push({id:n,payment:i}):t.push({id:n,invoice:i})}return t}function i(e,a){void 0===a&&(a=t.SelectedYearTypes.ALL_TIME);var i=n(e),r=(new Date).getFullYear().toString();return a===t.SelectedYearTypes.ALL_TIME||(i=a===t.SelectedYearTypes.YEAR_TO_DATE?i.filter(function(e){return e.payment?e.payment.date.indexOf(r)!==-1:!!e.invoice&&e.invoice.date.indexOf(r)!==-1}):i.filter(function(e){return e.payment?e.payment.date.indexOf(a)!==-1:!!e.invoice&&e.invoice.date.indexOf(a)!==-1})),i=i.filter(function(e){return e.invoice&&null!==e.invoice.description||e.payment&&null!==e.payment.description})}function r(e){var t=e.description;return!!t&&(t.indexOf("Google")!==-1||t.indexOf("Apple")!==-1)}Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedYearTypes={ALL_TIME:"all-time",YEAR_TO_DATE:"year-to-date"},t.getHistoryData=i}),define("modules/clean/teams/admin/types/billing_history",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Invoice=0]="Invoice",e[e.Payment=1]="Payment",e[e.Legacy=2]="Legacy"})(t.BillingRowType||(t.BillingRowType={}))}),define("modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list",["require","exports","tslib","external/react","modules/clean/react/css"],function(e,t,a,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return n.createElement("div",{className:"admin-priced-list"},n.createElement("div",null,this.props.children))},t})(n.Component);t.AdminPricedList=i(r,["/static/css/teams/admin/widgets/admin_priced_list/admin_priced_list-vflMAA6ZU.css"])}),define("modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item",["require","exports","tslib","external/react","external/classnames"],function(e,t,a,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(){},t}return a.__extends(t,e),t.prototype.renderTitleWarningText=function(){var e=this.props.titleWarningText;if(e)return n.createElement("span",{className:"admin-priced-list-item__content_title_warning"}," ",e)},t.prototype.renderTitleSecondaryText=function(){var e=this.props.titleSecondaryText;if(e)return n.createElement("span",{className:"admin-priced-list-item__content_title_secondary"}," ",e)},t.prototype.getClickHandler=function(){if(!this.props.disableItem)return this.props.onClick},t.prototype.render=function(){var e=this.props,t=e.description,a=e.price,r=e.title,l=e.unit,o=e.detailsLink,s=e.disableItem,c=this.props.className?this.props.className:"",u=a?a.toString():"-",d=a?l:"",p=i((m={"admin-priced-list-item":!0,active:this.props.isSelected===!0},m[c]=!0,m.disabled=s,m));return n.createElement("div",{className:p,onClick:this.getClickHandler()},n.createElement("div",{className:"admin-priced-list-item__content"},n.createElement("div",{className:"admin-priced-list-item__content_title"},n.createElement("input",{type:"radio",checked:this.props.isSelected,onChange:this.onChange,disabled:this.props.disableItem}),n.createElement("h1",{className:"f1"},r,this.renderTitleWarningText(),this.renderTitleSecondaryText())),n.createElement("div",{className:"admin-priced-list-item__content_description u-font-meta"},t,o)),n.createElement("div",{className:"admin-priced-list-item__pricing"},n.createElement("div",{className:"admin-priced-list-item__pricing_price"},u),n.createElement("div",{className:"admin-priced-list-item__pricing_unit"},d)));var m},t})(n.Component);t.AdminPricedListItem=r}),define("modules/clean/teams/admin/widgets/billing_history/billing_history_row",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader","modules/clean/analytics","modules/clean/react/tooltip","modules/clean/react/sprite"],function(e,t,a,n,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c;(function(e){e[e.invoice=0]="invoice",e[e.receipt=1]="receipt"})(c||(c={}));var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onEdit=function(){var e=t.props,a=e.row,n=e.isTeam;a.invoice&&r.EditInvoiceAddressModalLoader.showInstance(a.invoice,n)},t.logReceiptLinkClick=function(){t.props.logAccountBillingTabEvents&&l.ProEventsLogger.log("de_billing_tab_receipt_link_click")},t.logInvoiceLinkClick=function(){t.props.logAccountBillingTabEvents&&l.ProEventsLogger.log("de_billing_tab_invoice_link_click")},t}return a.__extends(t,e),t.prototype.renderCombinedRecords=function(e,t){return n.createElement("tr",{className:"row-content"},n.createElement("td",{className:"row-content__date"},this.renderDate()),n.createElement("td",{className:"row-content__description"},this.renderDescription()),n.createElement("td",{className:"row-content__links"},this.renderLinks()),n.createElement("td",{className:"row-content__price"},this.renderPrice()))},t.prototype.renderSingleRecord=function(e,t){var a=null;e.isVoided&&(a=n.createElement("span",null," (",i._("Voided"),")"));var r=null;if(e.link){var l=i._("Receipt"),u=this.logReceiptLinkClick;t===c.invoice&&(l=i._("Invoice"),u=this.logInvoiceLinkClick),r=n.createElement("td",{className:"row-content__links"},n.createElement("span",null,n.createElement("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",onClick:u},l)))}else if(e.infoTooltip){var d=n.createElement(o.Tooltip,{position:o.TooltipPosition.TOP,tooltip_contents:e.infoTooltip},n.createElement(s.Sprite,{group:"teams",name:"info_active",alt:"",className:"info-sprite"}));r=n.createElement("td",{className:"row-content__links"},d)}else r=n.createElement("td",{className:"row-content__links"});var p=n.createElement("div",null,n.createElement("p",{className:"description-line"},n.createElement("span",null,e.description),a)),m=t===c.receipt?e.paid:e.billed;return n.createElement("tr",{className:"row-content"},n.createElement("td",{className:"row-content__date"},e.date),n.createElement("td",{className:"row-content__description"},p),r,n.createElement("td",{className:"row-content__price"},m))},t.prototype.renderWithoutSingleRowEdit=function(){var e=this.props.row;return e.payment&&e.invoice?this.renderCombinedRecords(e.invoice,e.payment):e.payment?this.renderSingleRecord(e.payment,c.receipt):e.invoice?this.renderSingleRecord(e.invoice,c.invoice):n.createElement("noscript",null)},t.prototype.renderDate=function(){var e=this.props.row,t=e.invoice,a=e.payment;return t&&t.date?t.date:a&&a.date?a.date:null},t.prototype.renderDescription=function(){var e=this.props.row,t=e.invoice,a=e.payment,r=e.isMobile,l=null,o=null;return t&&t.description?l=t.description:a&&a.description&&(l=a.description),r&&t&&t.description&&a&&a.description&&(l=a.description+" | "+t.description),(t&&t.isVoided||a&&a.isVoided)&&(o=n.createElement("span",null," (",i._("Voided"),")")),n.createElement("div",null,n.createElement("p",{className:"description-line"},n.createElement("span",null,l),o))},t.prototype.renderLinks=function(){if(this.props.renderLinks!==!1){var e=this.props,t=e.row,a=e.showEditInvoiceModal,r=t.invoice,l=t.payment,o=[];return r&&r.link&&o.push(n.createElement("a",{key:"invoice-link",href:r.link,target:"_blank",rel:"noopener noreferrer",onClick:this.logInvoiceLinkClick},i._("Invoice"))),!t.isMobile&&l&&l.link&&o.push(n.createElement("a",{key:"payment-link",href:l.link,target:"_blank",rel:"noopener noreferrer",onClick:this.logReceiptLinkClick},i._("Receipt"))),a&&r&&!r.isOpen&&r.isEditable&&o.push(n.createElement("button",{key:"edit-link",className:"button-as-link",onClick:this.onEdit},i._("Edit"))),o.length||(r&&r.infoTooltip?o.push(this.renderInfoTooltip(r)):l&&l.infoTooltip&&o.push(this.renderInfoTooltip(l))),o.length?n.createElement("span",null,o):null}},t.prototype.renderInfoTooltip=function(e){return n.createElement(o.Tooltip,{position:o.TooltipPosition.TOP,tooltip_contents:e.infoTooltip},n.createElement(s.Sprite,{group:"teams",name:"info_active",alt:"",className:"info-sprite"}))},t.prototype.renderPrice=function(){var e=this.props.row,t=e.invoice,a=e.payment;if(e.isMobile)return null;var i=null;return t&&a?i=t.isVoided||a.isVoided?n.createElement("span",{className:"row-content__price--line-through"},t.billed):t.billed:a?i=a.paid:t&&(i=t.billed),i},t.prototype.renderWithSingleRowEdit=function(){var e=this.props.row;return e.invoice||e.payment?n.createElement("tr",{className:"row-content","data-variant":!0},n.createElement("td",{className:"row-content__date"},this.renderDate()),n.createElement("td",{className:"row-content__description"},this.renderDescription()),n.createElement("td",{className:"row-content__links"},this.renderLinks()),n.createElement("td",{className:"row-content__price"},this.renderPrice())):null},t.prototype.render=function(){return this.props.showSingleRowEdit?this.renderWithSingleRowEdit():this.renderWithoutSingleRowEdit()},t})(n.Component);t.BillingHistoryTableRow=u}),define("modules/clean/teams/admin/widgets/billing_history/billing_history_table",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/teams/admin/widgets/billing_history/billing_history_row"],function(e,t,a,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.buildFooterIfNecessary=function(){if(null!==this.props.footer)return n.createElement("tfoot",{className:"row-footer"},this.props.footer)},t.prototype.render=function(){var e,t=this.props,a=t.amountLabel,l=t.displayNoTransactionsOnEmptyRecords,o=t.showEditInvoiceModal,s=t.showSingleRowEdit,c=t.logAccountBillingTabEvents,u=t.isTeam,d=t.renderLinks,p=this.props.billingHistoryRecords,m=a?a:i._("Price");if(l&&0===p.length){var h=this.props.noTransactionLabel?this.props.noTransactionLabel:i._("No transactions");e=n.createElement("tr",{className:"row-content"},n.createElement("td",{className:"row-content__date"}),n.createElement("td",{className:"row-content__description"},h),n.createElement("td",{className:"row-content__links"}),n.createElement("td",{className:"row-content__price"}))}return n.createElement("div",null,n.createElement("table",{className:"billing-history-table",cellSpacing:"0"},n.createElement("thead",null,n.createElement("tr",null,n.createElement("th",{className:"row-header date-row u-font-meta"},i._("Date")),n.createElement("th",{className:"row-header desc-row u-font-meta",colSpan:2},i._("Description")),n.createElement("th",{className:"row-header price-row u-font-meta"},m))),this.buildFooterIfNecessary(),n.createElement("tbody",null,e,p.map(function(e,t){return n.createElement(r.BillingHistoryTableRow,{row:e,key:e.id,showEditInvoiceModal:o,showSingleRowEdit:s,logAccountBillingTabEvents:c,isTeam:u,renderLinks:d})}))))},t})(n.Component);t.BillingHistoryTable=l}),define("modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal",["require","exports","tslib","modules/core/i18n","modules/clean/react/modal","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_diff","modules/clean/payments/skus/subscription_service","modules/constants/trademark","modules/clean/ajax","modules/clean/dbmodal_stack","modules/core/notify","external/react","modules/clean/teams/admin/widgets/change_plan_modal/change_plan_constants"],function(e,t,a,n,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h;(function(e){e[e.ALL=1]="ALL",e[e.PLAN=2]="PLAN",e[e.SCHEDULE=3]="SCHEDULE",e[e.LICENSES=4]="LICENSES",e[e.EVH_ADDON=5]="EVH_ADDON",e[e.IND_SUBSCRIPTION=6]="IND_SUBSCRIPTION"})(h=t.CancellationType||(t.CancellationType={}));var _=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){switch(a.props.cancellationType){case h.PLAN:a.cancelPlanOrBillingScheduledChange(h.PLAN);break;case h.SCHEDULE:a.cancelPlanOrBillingScheduledChange(h.SCHEDULE);break;case h.LICENSES:a.cancelLicensesScheduledChanges();break;case h.ALL:a.cancelAll()}},a.subService=new o.SubscriptionService,a.state={submitting:!1},a}return a.__extends(t,e),t.showInstance=function(e){i.Modal.showInstance(p.createElement(t,a.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelAll=function(){var e=this,t=this.props,a=t.transitionPerformed,r=t.subStatus;this.submittingRequest();var o=l.SubscriptionDiff.fromSubscriptionState(r.subState);this.subService.validateAndPerformTransition(o).then(function(t){d.Notify.success(n._("Your scheduled changes have been cancelled!")),a&&a(t),i.Modal.close(),e.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}).finally(function(){e.doneSubmittingRequest()})},t.prototype.cancelLicensesScheduledChanges=function(){var e=this,t=this.props.subStatus,a=l.SubscriptionDiff.fromSubscriptionStatus(t);this.submittingRequest(),a.setTotalLicenses(t.subState.totalLicenses),this.subService.price(a).then(function(t){e.subService.performTransition(t).then(function(t){e.props.transitionPerformed&&e.props.transitionPerformed(t),d.Notify.success(n._("You’ve cancelled your change!")),e.doneSubmittingRequest(),i.Modal.close(),e.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}).catch(function(){e.errorUpdatingChanges()})}).catch(function(){e.errorUpdatingChanges()})},t.prototype.errorUpdatingChanges=function(){d.Notify.error(n._("Failed to revert changes.")),this.doneSubmittingRequest(),i.Modal.close()},t.prototype.cancelPlanOrBillingScheduledChange=function(e){var t,a,l=this,o=this.props,s=o.transitionPerformed,p=o.subStatus;this.submittingRequest(),c.WebRequest({url:"/account/team/change_plan_modal_view_model",success:function(o){if(t=JSON.parse(o).serializedSubChangePlans.map(function(e){return r.SubscriptionChangePlan.deserialize(e)}),a=t.filter(function(t){
return!!(t.finalSubState&&t.finalSubState.plan&&t.finalSubState.billingSchedule&&p.subState&&p.subState.plan&&p.finalSubState&&p.finalSubState.billingSchedule&&p.finalSubState.plan&&p.subState.billingSchedule)&&(e===h.PLAN?p.subState.plan.productType===t.finalSubState.plan.productType&&p.finalSubState.billingSchedule.id===t.finalSubState.billingSchedule.id:e===h.SCHEDULE&&p.finalSubState.plan.productType===t.finalSubState.plan.productType&&p.subState.billingSchedule.id===t.finalSubState.billingSchedule.id)}),a.length>0){var c=a[0];l.subService.performTransition(c).then(function(e){d.Notify.success(n._("You’ve cancelled your change!")),s&&s(e),l.doneSubmittingRequest(),i.Modal.close(),l.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)})}else d.Notify.error(n._("Failed to revert changes."))},error:function(){d.Notify.error(n._("Failed to load modal.")),l.doneSubmittingRequest(),i.Modal.close(),l.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}})},t.prototype.render=function(){var e=this.props,t=e.cancellationType,a=e.subStatus;if(!a.subState.plan||!a.subState.billingSchedule)return p.createElement("noscript",null);var r,l=n._("Confirm cancelled change");switch(t){case h.PLAN:r=n._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:a.subState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.subState.billingSchedule.scheduleDescriptionAdjective});break;case h.SCHEDULE:r=n._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:a.subState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.subState.billingSchedule.scheduleDescriptionAdjective});break;case h.LICENSES:r=n._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:a.subState.plan.displayName(),date:a.subState.formattedNextBillingDate,schedule:a.subState.billingSchedule.scheduleDescriptionAdjective});break;case h.ALL:l=n._("Confirmation"),r=n._("By confirming, all existing scheduled changes will be cancelled.");break;default:l=n._("Confirmation"),r=n._("By confirming, all existing scheduled changes will be cancelled.")}return p.createElement(i.Modal,{acceptButtonDisabled:this.state.submitting,acceptButtonText:n._("Confirm"),autoClose:!1,dismissButtonText:n._("Don’t cancel"),onAccept:this.onAccept,title:l,submitting:this.state.submitting},p.createElement("p",null,r))},t})(p.Component);t.CancelBillingChangesConfirmationView=_}),define("modules/clean/teams/admin/widgets/billing_notifications/cancellable_item",["require","exports","tslib","external/react","modules/core/i18n","external/classnames"],function(e,t,a,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.description,l=e.handleAction,o=e.useSingleCancelLink,s=e.editInsteadOfCancel,c=this.props.className?this.props.className:"",u=r((p={"cancellable-item__button":!0,"link-button":!0},p[c]=!0,p)),d=n.createElement("button",{className:u,onClick:l},i._("Cancel change"));return o&&(d=void 0),s&&(d=n.createElement("button",{className:u,onClick:l},i._("Edit change"))),n.createElement("div",{className:"cancellable-item"},n.createElement("span",{className:"cancellable-item__title"},t)," ",n.createElement("span",{className:"cancellable-item__desc"},a),d);var p},t})(n.Component);t.CancellableItemView=l}),define("modules/clean/teams/admin/widgets/change_plan_modal/change_plan_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_PLAN_DUAL_MODAL_UPDATED="change_plan_dual_modal:updated";(function(e){e[e.PLAN_CHANGE=1]="PLAN_CHANGE",e[e.SCHEDULE_CHANGE=2]="SCHEDULE_CHANGE"})(t.DualPlanModalMode||(t.DualPlanModalMode={}))});
//# sourceMappingURL=pkg-account_subscription.min.js-vflbtr1Bv.map