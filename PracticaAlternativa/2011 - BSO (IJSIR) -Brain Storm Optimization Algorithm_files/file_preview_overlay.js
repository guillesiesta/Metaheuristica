define(["require","exports","tslib","external/create-react-class","external/react","external/react-dom-factories","external/prop-types","external/react-addons-pure-render-mixin","external/lodash","modules/clean/comments/annotation_utils","modules/clean/comments/constants","modules/clean/comments/flux","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/react/file_comments/annotation_bubble","modules/clean/react/file_comments/annotation_comments_list_ui_bubble","modules/constants/comments_panel","modules/core/exception"],function(n,t,e,o,i,a,r,s,u,c,l,v,d,m,p,b,A){"use strict";var y=o({displayName:"FilePreviewOverlay",mixins:[s],propTypes:{previewContainer:r.instanceOf(HTMLElement).isRequired,activity:r.object,actorId:r.number,context:r.number.isRequired,useAnnotationCreationExpand:r.bool.isRequired,showCreateBubble:r.bool.isRequired,draftAnnotation:r.object,viewingAnnotation:r.object,viewingAnnotationHover:r.bool.isRequired,viewingCommentActivity:r.object,viewingAnnotationReplyDraft:r.string,actionCreators:r.object.isRequired},getInitialState:function(){return{isExpanded:!1}},onConversationExpand:function(){return this.setState({isExpanded:!0})},onMouseEnterAnnotationConversationBubble:function(){return this.props.actionCreators.updateAnnotationConversationHover(!0)},onMouseLeaveAnnotationConversationBubble:function(){var n=this;if(this.props.actionCreators.updateAnnotationConversationHover(!1),null==this.props.draftAnnotation&&!this.state.isExpanded){var t=function(){if(n.isMounted()&&!n.props.viewingAnnotationHover)return n.props.actionCreators.hideAnnotationConversation()};return window.setTimeout(t,50)}},maybeRenderAnnotationInputBubble:function(){var n=this.props,t=n.activity,o=n.actorId,a=n.context,r=n.previewContainer,s=n.draftAnnotation,l=n.draftAnnotationText,v=n.showCreateBubble,d=n.useAnnotationCreationExpand;if(null!=s){var b={context:a,activity:t,user:m.getActivityUser(o),shouldShowExpandBubble:d,commentText:l,position:"top",x:0,y:0,showBubble:!1,actionCreators:this.props.actionCreators};if(v){if(!c.isAnnotationOffscreen(s,r)){var A=Array.from(c.getBubblePosition(s,r)),y=A[0],f=A[1],x=f.x,C=f.y,h=A[2];if(null!=y&&null!=x&&null!=C)return u.assignIn(b,{showBubble:!0,position:y,x:x,y:C,maxHeight:h}),i.createElement(p,e.__assign({},b))}}return i.createElement(p,e.__assign({},b))}},maybeRenderAnnotationConversationBubble:function(){var n=this.props,t=n.actorId,e=n.context,o=n.activity,a=n.previewContainer,r=n.viewingAnnotationReplyDraft,s=n.viewingCommentActivity,u=n.viewingAnnotation;if(s&&u&&!c.isAnnotationOffscreen(u,a)){var l=Array.from(c.getBubblePosition(u,a)),v=l[0],d=l[1],p=d.x,A=d.y,y=l[2];if(null!=v&&null!=p&&null!=A&&null!=y)return i.createElement(b,{context:e,activity:o,commentActivity:s,user:m.getActivityUser(t),position:v,replyText:r,x:p,y:A,maxHeight:y,onMouseEnter:this.onMouseEnterAnnotationConversationBubble,onMouseLeave:this.onMouseLeaveAnnotationConversationBubble,onConversationExpand:this.onConversationExpand,actionCreators:this.props.actionCreators})}},render:function(){return a.div({},this.maybeRenderAnnotationInputBubble(),this.maybeRenderAnnotationConversationBubble())}}),f=function(n){return A.ALLOW_VIEW_ANNOTATE_MODES&&(null!=n?n.annotation.type:void 0)===l.AnnotationTypes.HIGHLIGHT},x=function(n){var t,e,o,i=n.activity,a=n.viewAnnotation,r=n.createAnnotation;return a&&(o=u.find(i.comment_activities,{activity_key:a.activityKey}),o&&(e=n.annotationReplyTextByKey[o.activity_key])),r&&(t=r.showBubble),{activity:i,actorId:n.actorId,context:n.viewing.context,useAnnotationCreationExpand:f(r),showCreateBubble:!!t,draftAnnotation:null!=r?r.annotation:void 0,draftAnnotationText:n.annotationText,viewingAnnotation:null!=a?a.annotation:void 0,viewingAnnotationHover:!!(null!=a?a.annotationHover:void 0),viewingCommentActivity:o,viewingAnnotationReplyDraft:e}};return v.connect(d,x)(y)});
//# sourceMappingURL=file_preview_overlay.min.js-vflaF1QVy.map