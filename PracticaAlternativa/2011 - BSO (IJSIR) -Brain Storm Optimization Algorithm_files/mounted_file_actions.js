define(["require","exports","tslib","external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/file_viewer/share_helpers","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/react/size_class/constants","modules/core/i18n","modules/core/browser","modules/clean/react/paper/utils","modules/clean/react/paper/open_in_paper_button","modules/clean/web_timing_logger","modules/clean/react/partner_file_actions/partner_file_action_button","modules/clean/api_v2/client","modules/clean/react/file_viewer/file_utils","modules/core/exception"],function(e,t,n,r,i,a,o,s,l,c,p,u,h,d,f,_,m,g,S,v,C,k,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={linkMetadata:null,expHelloSignVariant:"OFF",expHasLoggedHelloSignExposure:!1},t.cancelGetSharedLinkInfo=function(){},t.apiClient=new C.ApiV2Client,t.logHelloSignExposure=function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:if(this.state.expHasLoggedHelloSignExposure)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.apiClient.ns("stormcrow").rpc("log_exposure",{feature:"pp_hellosign_experiment",variant:this.state.expHelloSignVariant},{subjectUserId:this.props.user.id})];case 2:return t.sent(),this.setState({expHasLoggedHelloSignExposure:!0}),[3,4];case 3:return e=t.sent(),w.reportException({err:e,tags:["partner_platform"],severity:w.SEVERITY.NONCRITICAL}),[3,4];case 4:return[2]}})})},t.handleShareClick=function(){l.share(t.props.file,t.props.user,null,"PREVIEW_PAGE"),i.logUserAction(a.UserAction.Share,a.UserActionContext.TitleBarMain)},t.removeShareLink=function(){var e=new u.ShareApiClient({userId:t.props.user.id}),n=t.state.linkMetadata,r=n.name,i=n.url;h.deleteLinkWithConfirm({client:e,contentName:r,onCancel:null,onDeleteLink:function(){return t.setState({linkMetadata:null})},url:i})},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;S.waitForTTI().then(function(){return n.__awaiter(e,void 0,void 0,function(){var e,t;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.apiClient.ns("stormcrow").rpc("get_variant",{feature:"pp_hellosign_experiment",log_exposure:!1},{subjectUserId:this.props.user.id})];case 1:return e=n.sent(),this.setState({expHelloSignVariant:e.variant}),[3,3];case 2:return t=n.sent(),w.reportException({err:t,tags:["partner_platform"],severity:w.SEVERITY.NONCRITICAL}),[3,3];case 3:return[2]}})})})},t.prototype.showHelloSignExp=function(e){return"pdf"===k.getExtension(e)&&"OFF"!==this.state.expHelloSignVariant},t.prototype.componentDidMount=function(){this.setupShare(this.props),this.setState({openInPaperButtonVariant:m.getOpenInPaperButtonVariant({file:this.props.file,user:this.props.user})})},t.prototype.componentWillUnmount=function(){this.cancelGetSharedLinkInfo()},t.prototype.componentWillReceiveProps=function(e){e.file!==this.props.file&&(this.cancelGetSharedLinkInfo(),this.setState({linkMetadata:null}),this.setupShare(e))},t.prototype.setupShare=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,i;return n.__generator(this,function(n){switch(n.label){case 0:return t=!1,this.cancelGetSharedLinkInfo=function(){t=!0},r=new u.ShareApiClient({userId:e.user.id}),[4,r.sharedLinkInfo({fileIdOrPath:e.file.fq_path})];case 1:return i=n.sent(),t||this.setState({linkMetadata:i}),this.cancelGetSharedLinkInfo=function(){},[2]}})})},t.prototype.logUserActionInTitleBarFactory=function(e){return function(){return i.logUserAction(e,a.UserActionContext.TitleBarMain)}},t.prototype.render=function(){var e=!!this.state.linkMetadata&&this.state.linkMetadata.link_permissions.can_revoke,t=this.props,i=t.file,l=t.sizeClass,u=t.shouldDisplayActionButtons,h=t.user,S={allowRemoveLink:e,isPrivate:!0,file:i,onClickShareLink:this.handleShareClick,onRemoveShareLink:this.removeShareLink,sizeClass:l,user:h,showOpenInPaper:this.state.openInPaperButtonVariant===m.OpenInPaperButtonVariant.Ellipsis};if(l!==d.SizeClass.Large)return r.createElement(c.TitleBarControlsContainer,null,!u||_.is_mobile_or_tablet()||l===d.SizeClass.Small?null:r.createElement(s.OpenButton,{file:i,location:a.FileViewerPane.TitleBar,user:h}),r.createElement(o.MoreDropdown,n.__assign({},S)));var C;return u&&(C=[r.createElement("button",{className:"share-button button-primary control__button",onClick:this.handleShareClick,key:0},f._("Share"))],this.state.openInPaperButtonVariant===m.OpenInPaperButtonVariant.Button&&C.push(r.createElement(g.OpenInPaperButton,{key:"openinpaper",file:i,user:h,hideCallout:!1})),C.push(r.createElement(s.OpenButton,{file:i,location:a.FileViewerPane.TitleBar,user:h,key:2,sizeClass:this.props.sizeClass,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===m.OpenInPaperButtonVariant.Dropdown})),this.showHelloSignExp(i)&&C.push(r.createElement(v.PartnerFileActionButton,{file:i,user:h,text:f._("Open for signature"),actionContext:"file_view",variant:this.state.expHelloSignVariant,logExposure:this.logHelloSignExposure}))),r.createElement(c.TitleBarControlsContainer,null,C,r.createElement(o.MoreDropdown,n.__assign({},S)),r.createElement("div",{className:"react-title-bar__divider"}),r.createElement(p.UserNotificationsDropdown,{isPagelet:!1,onClick:this.logUserActionInTitleBarFactory(a.UserAction.ClickNotifications)}))},t})(r.Component);t.MountedFileActions=I});
//# sourceMappingURL=mounted_file_actions.min.js-vflqzSK4f.map